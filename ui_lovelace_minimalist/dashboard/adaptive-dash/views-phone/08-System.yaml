---
type: "custom:layout-card"
layout_type: "custom:grid-layout"
layout:
  # Tablet portrait
  grid-template-columns: "1fr 1fr 1fr 1fr 1fr 1fr"
  grid-template-areas: |
        "topbar topbar topbar topbar topbar topbar"
        "card1 card1 card1 card1 card1 card1"
        "card2 card2 card2 card2 card2 card2"

  mediaquery:
    # Mobile
    "(max-width: 800px)":
      grid-template-columns: "1fr 1fr"
      grid-template-areas: |
        "topbar topbar"
        "card1 card1"
        "card2 card2"

view_layout:
  grid-area: "popup"
cards:
  - view_layout: ### TOP BAR ###
      grid-area: "topbar"
    type: horizontal-stack
    cards:
    - type: 'custom:button-card'
      template: chip_back
      variables:
        ulm_chip_back_path: /lovelace-minimalist-2/home
    - type: "custom:button-card"
      template: "card_title"
      name: "System Overview"

  - view_layout: ### CARDS ###
      grid-area: "card1"
    type: entities
    title: Issue Tracker
    entities:
      - entity: input_text.issue_description
        name: Description
      - type: custom:config-template-card
        entities:
          - counter.issue_number
          - input_text.issue_description
        row:
          type: button
          entity: script.open_issue
          name: ' '
          icon: ' '
          action_name: Submit
          tap_action:
            action: call-service
            service: script.open_issue
            service_data:
              user: ${ user.name }
              issue_number: ${ states['counter.issue_number'].state }
              issue_description: ${ states['input_text.issue_description'].state }
      - type: divider
      - type: custom:auto-entities
        card:
          type: entities
          show_header_toggle: false
        show_empty: false
        entities:
          - input_select.filter_issues
        filter:
          template: >
            {% if is_state('input_select.filter_issues', 'Open') %}
              {% set issue_state = ['on'] %}
            {% elif is_state('input_select.filter_issues', 'Closed') %}
              {% set issue_state = ['off'] %}
            {% elif is_state('input_select.filter_issues', 'All') %}
              {% set issue_state = ['on', 'off'] %}
            {% endif %}
            {% set issues = states.binary_sensor | selectattr('entity_id', 'match',
            'binary_sensor.issue_*') | selectattr('state', 'in', issue_state) |
            map(attribute='entity_id') | list %}
            {% set issues = issues | map('regex_replace', '^.+_(\\d+)$', '\\1') |
            map('int') | sort | map('string') | map('regex_replace', '^(\\d+)$',
            'binary_sensor.issue_\\1') | list %}
            [ {% for issue in (issues | reverse) %}
              {
                "type": "custom:config-template-card",
                "entities": "[{{ issue }}]",
                "row": {
                  "type": "custom:template-entity-row",
                  "entity": "{{ issue }}",
                  "name": "{{ state_attr(issue, 'description') }}",
                  "active": {{ is_state(issue, 'on') }},
                  "icon": "{{ "mdi:alert-circle-outline" if is_state(issue, 'on') else "mdi:close-circle-outline" }}",
                  "state": "{{ state_attr(issue, 'user') }}",
                  "secondary": "{{ '#' + state_attr(issue, 'number') + ' - ' + (state_attr(issue, 'status').replace('ed', '') | title) + 'ed on' }} {{
                                    float(state_attr(issue, 'time') | as_timestamp) |
                                    timestamp_custom('%m/%d/%y at %-0I:%M %p') }}",
                  "tap_action": {% if is_state(issue, 'on') %}
                                      {
                                        "action": "call-service",
                                        "service": "script.close_issue",
                                        "service_data": {
                                          "issue_number": {{ state_attr(issue, "number") }},
                                          "user": "${ user.name }",
                                        },
                                        "confirmation": {
                                          "text": "Close issue #{{ state_attr(issue, 'number') }}?",
                                        }
                                      }
                                    {% else %}
                                      {
                                        "action": "call-service",
                                        "service": "script.open_issue",
                                        "service_data": {
                                          "issue_number": {{ state_attr(issue, "number") }},
                                          "issue_description": "{{ state_attr(issue, "description") }}",
                                          "user": "${ user.name }",
                                        },
                                        "confirmation": {
                                          "text": "Reopen issue #{{ state_attr(issue, 'number') }}?",
                                        }
                                      }
                                    {% endif %}
                }
              },
            {% endfor %} ]

  - view_layout: ### CARDS ###
      grid-area: "card2"
    type: custom:swipe-card
    cards:
      - type: vertical-stack
        cards:
          - type: "custom:button-card"
            template: "card_title"
            name: "System Status"
          - type: 'custom:button-card'
            template: card_generic
            entity: sensor.date_last_boot
            variables:
              ulm_card_generic_name: System Last Boot
              ulm_card_generic_icon: mdi:DesktopClassic
          - type: 'custom:button-card'
            template: card_generic
            entity: sensor.backup_state
            variables:
              ulm_card_generic_name: Backup Status
              ulm_card_generic_icon: mdi:folder-download

      - type: vertical-stack
        cards:
          - type: "custom:button-card"
            template: "card_title"
            name: "Network"
          - type: custom:button-card
            template: custom_card_irmajavi_speedtest
            variables:
              ulm_custom_card_irmajavi_speedtest_download_speed_entity: sensor.speed_test_download
              ulm_custom_card_irmajavi_speedtest_upload_speed_entity: sensor.speed_test_upload
              ulm_custom_card_irmajavi_speedtest_color: blue
              ulm_custom_card_irmajavi_speedtest_router_name: Nokia
              ulm_custom_card_irmajavi_speedtest_router_model: G-2426G-A

      - type: vertical-stack
        cards:
          - type: "custom:button-card"
            template: "card_title"
            name: "Tablet"
          - type: "custom:button-card"
            template: "custom_card_nik_tablet"
            variables:
              ulm_custom_card_nik_tablet_main: binary_sensor.dashboard_tablet_kiosk_mode
              ulm_custom_card_nik_tablet_name: "Lenovo M10 Tablet"
              ulm_custom_card_nik_tablet_battery: sensor.dashboard_tablet_battery
              ulm_custom_card_nik_tablet_battery_name: "Battery"
              ulm_custom_card_nik_tablet_button1: switch.tablet_charger
              ulm_custom_card_nik_tablet_button2: switch.dashboard_tablet_motion_detection
              ulm_custom_card_nik_tablet_button3: light.dashboard_tablet_screen
              ulm_custom_card_nik_tablet_restart: button.dashboard_tablet_restart_browser
              ulm_custom_card_nik_tablet_reload: button.dashboard_tablet_load_start_url
              ulm_custom_card_nik_tablet_maintenance: switch.dashboard_tablet_maintenance_mode
              ulm_custom_card_nik_tablet_par1: sensor.dashboard_tablet_free_memory
              ulm_custom_card_nik_tablet_par1_name: "Free Memory"
              ulm_custom_card_nik_tablet_par2: sensor.dashboard_tablet_internal_storage_free_space
              ulm_custom_card_nik_tablet_par2_name: "Disk"
              ulm_custom_card_nik_tablet_par3: binary_sensor.dashboard_tablet_plugged_in
              ulm_custom_card_nik_tablet_par3_name: "Power"

      - type: vertical-stack
        cards:
          - type: "custom:button-card"
            template: "card_title"
            name: "Disk Statistics"
          - type: "custom:button-card"
            template: "custom_card_apexcharts"
            variables:
              chart_type: "radialBar"
              graph_span: "1d"
              entity_1:
                entity_id: "sensor.disk_free"
                icon: ""
                name: "Disk Free"
                color: "blue"
                max_value: 300
              entity_2:
                entity_id: "sensor.disk_use_percent"
                icon: ""
                name: "Disk Use %"
                color: "yellow"
                max_value: 50
              entity_3:
                entity_id: "sensor.processor_temperature"
                icon: ""
                name: "CPU Temperature"
                color: "green"
                max_value: 50
          - type: "custom:button-card"
            template: "card_title"
            name: "Processor Statistics"
          - type: "custom:button-card"
            template: "custom_card_apexcharts"
            variables:
              chart_type: "radialBar"
              graph_span: "1d"
              entity_1:
                entity_id: "sensor.memory_use_percent"
                icon: ""
                name: "Memory %"
                color: "blue"
                max_value: 100
              entity_2:
                entity_id: "sensor.processor_use"
                icon: ""
                name: "Processor Use %"
                color: "yellow"
                max_value: 100
              entity_3:
                entity_id: "sensor.processor_temperature"
                icon: ""
                name: "Processor Temp"
                color: "green"
                max_value: 50
      - type: vertical-stack
        cards:
          - type: "custom:button-card"
            template: "card_title"
            name: "Network Statistics"
          - type: "custom:button-card"
            template: "custom_card_apexcharts"
            variables:
              chart_type: "radialBar"
              graph_span: "1d"
              entity_1:
                entity_id: "sensor.network_in_eth0"
                icon: ""
                name: "Network IN"
                color: "blue"
                max_value: 50
              entity_2:
                entity_id: "sensor.network_out_eth0"
                icon: ""
                name: "Network OUT"
                color: "yellow"
                max_value: 50
              entity_3:
                entity_id: "sensor.network_throughput_in_eth0"
                icon: ""
                name: "Network THR"
                color: "green"
                max_value: 50
          - type: "custom:button-card"
            template: "card_title"
            name: "Frigate Statistics"
          - type: "custom:button-card"
            template: "custom_card_apexcharts"
            variables:
              chart_type: "radialBar"
              graph_span: "1d"
              entity_1:
                entity_id: "sensor.coral_inference_speed"
                icon: ""
                name: "Coral Inf"
                color: "blue"
                max_value: 50
              entity_2:
                entity_id: "sensor.detection_fps"
                icon: ""
                name: "Det FPS"
                color: "yellow"
                max_value: 50
              entity_3:
                entity_id: "sensor.living_room_camera_process_fps"
                icon: ""
                name: "Proc FPS"
                color: "green"
                max_value: 50