<!-- TOP ROW OF BADGES -->

[![Contributors][contributors-shield]][contributors-url]
[![Forks][forks-shield]][forks-url]
[![Stargazers][stars-shield]][stars-url]
[![Issues][issues-shield]][issues-url]
[![MIT License][license-shield]][license-url]
[![Kofi][kofi-badge]][kofi-url]
<a name="readme-top"></a>

<!-- PROJECT HEADING -->
<div align="center">
<a href="https://github.com/smcnab1/op-question-mark">
<img src="https://i.imgur.com/U4zDHO8.png" alt="Logo" width="150" height="150"></a>

## **Op Question Mark**

#### Be sure to ‚≠ê my configuration repo so you can keep up to date on any daily progress!

</div>

---

<!-- ABOUT THE PROJECT -->

## About The Project

This is my **first** repo on GitHub and first time utilising Home Assistant to it's fullest potential. I began with a few sensors and just playing but got bitten by the HA bug and have created a full smart home system.

This repo will be updated regularly and I am keen to make it an open & learning venture. Looking for feature suggestions and advice to increase the **wife-approval level**üòé.

<!-- CONTENTS -->

## Contents

<div align="center">
<a href="https://github.com/smcnab1/op-question-mark/blob/master/SCREENSHOT.md">

**View Demo**
</a>
**¬∑**
<a href="https://github.com/smcnab1/op-question-mark/issues/new?assignees=smcnab1&labels=Priority%3A+High%2C+Type%3A+Bug&template=bug_report.md&title=%5BBUG%5D">
**Report Bug**
</a>
**¬∑**
<a href="https://github.com/smcnab1/op-question-mark/issues/new?assignees=smcnab1&labels=Priority%3A+Low%2C+Type%3A+Feature&template=feature_request.md&title=%5BFR%5D">
**Request Feature**
</a>
**¬∑**
<a href="https://github.com/smcnab1/op-question-mark/issues/new?assignees=smcnab1&labels=&template=to-do-list.md&title=%5BTDL%5D">
**ToDo List**
</a>

</div>

<div align="center">
<a href="#devices">Devices</a>
|
<a href="#addon">Add-Ons</a>
|
<a href="#automations">Automations</a>
|
<a href="#contributing">Contributing</a>
|
<a href="#license">License</a>
|
<a href="#contact">Contact</a>
</div>
&nbsp;
<div align="center">
<a href="https://github.com/smcnab1/op-question-mark/blob/master/SCREENSHOT.md">Click the image to see more screenshots of my current Dashboard
<img src="https://i.imgur.com/z3pnxzt.png" alt="Screenshot Desktop"></a>
</div>

<!-- DEVICES -->

<a name="devices"></a>

## All Devices _(as at Sept 22)_

This is a list of the devices I **currently** use as part of my Home Assistant setup. Any suggestions drop them as a <a href="https://github.com/smcnab1/op-question-mark/issues/new?assignees=smcnab1&labels=Priority%3A+Low%2C+Type%3A+Feature&template=feature_request.md&title=%5BFR%5D">feature request.</a>
<br />

<!-- start-table -->
<details><summary><b>View all Devices</i></b></summary>
<table>
    <thead>
        <tr>
            <th>Switches üéö</th>
            <th>Qty (#)</th>
            <th>Price per unit (¬£)</th>
            <th>Price (¬£)</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>TP-Link Tapo P100</td>
            <td>7</td>
            <td>9.49</td>
            <td>66.43</td>
        </tr>
        <tr>
            <td>Xiaomi Aqara Single Button</td>
            <td>1</td>
            <td>17.99</td>
            <td>17.99</td>
        </tr>
        <tr>
            <td>SONOFF Micro USB Smart Adapter</td>
            <td>2</td>
            <td>11.99</td>
            <td>23.98</td>
        </tr>
        <tr>
            <td>SwitchBot Smart Switch</td>
            <td>2</td>
            <td>29.99</td>
            <td>59.98</td>
        </tr>
        <tr>
            <td><i><b>Total</b></i></td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td><b>168.38</b></td>
        </tr>
        <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
        </tr>
    </tbody>
    <thead>
        <tr>
            <th>Sensors üå°</th>
            <th>Units (#)</th>
            <th>Price per unit (¬£)</th>
            <th>Price (¬£)</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Xiaomi Aqara Door Sensor</td>
            <td>2</td>
            <td>16.99</td>
            <td>33.98</td>
        </tr>
        <tr>
            <td>Xiaomi Aqara Temperature Sensor</td>
            <td>5</td>
            <td>19.99</td>
            <td>99.95</td>
        </tr>
        <tr>
            <td>Xiaomi Aqara Motion Sensor</td>
            <td>5</td>
            <td>19.99</td>
            <td>99.95</td>
        </tr>
        <tr>
            <td>Xiaomi Aqara Vibration Sensor</td>
            <td>1</td>
            <td>19.99</td>
            <td>19.99</td>
        </tr>
        <tr>
            <td>ESP32 for Presense</td>
            <td>3</td>
            <td>7.29</td>
            <td>21.87</td>
        </tr>
        <tr>
            <td>ESP32 for Bed Sensor</td>
            <td>1</td>
            <td>7.29</td>
            <td>7.29</td>
        </tr>
        <tr>
            <td>Bed Pressure Mats</td>
            <td>2</td>
            <td>11.79</td>
            <td>23.58</td>
        </tr>
        <tr>
            <td><i><b>Total</b></i></td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td><b>306.61</b></td>
        </tr>
        <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
        </tr>
    </tbody>
    <thead>
        <tr>
            <th>Media player üì∫üîà</th>
            <th>Units (#)</th>
            <th>Price per unit (¬£)</th>
            <th>Price (¬£)</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Samsung Q60AA</td>
            <td>1</td>
            <td>559.00</td>
            <td>559.00</td>
        </tr>
        <tr>
            <td>BLAUPUNKT 32"</td>
            <td>1</td>
            <td>139.95</td>
            <td>139.95</td>
        </tr>
        <tr>
            <td>SONOS Play 1</td>
            <td>1</td>
            <td>164.99</td>
            <td>164.99</td>
        </tr>
        <tr>
            <td>Google Nest Hub Mini</td>
            <td>2</td>
            <td>27.99</td>
            <td>55.98</td>
        </tr>
        <tr>
            <td>Lenovo M10 Tablet with Ethernet Connection</td>
            <td>1</td>
            <td>79.99</td>
            <td>79.99</td>
        </tr>
        <tr>
            <td>XBOX One Console</td>
            <td>1</td>
            <td>164.97</td>
            <td>164.97</td>
        </tr>
        <tr>
            <td>Apple Mac Mini</td>
            <td>1</td>
            <td>629.97</td>
            <td>629.97</td>
        </tr>
        <tr>
            <td>MacBook Air</td>
            <td>2</td>
            <td>949.00</td>
            <td>1898.00</td>
        </tr>
        <tr>
            <td><i><b>Total</b></i></td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td><b>3,692.85</b></td>
        </tr>
        <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
        </tr>
    </tbody>
    <thead>
        <tr>
            <th>Lights üí°</th>
            <th>Units (#)</th>
            <th>Price per unit (¬£)</th>
            <th>Price (¬£)</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Lepro GU10 LED RGB Bulb</td>
            <td>10</td>
            <td>9.00</td>
            <td>90.00</td>
        </tr>
        <tr>
            <td>Lepro E14 LED Dimmable Bulb</td>
            <td>2</td>
            <td>8.50</td>
            <td>17.00</td>
        </tr>
        <tr>
            <td>Lepro LED Strip RGB 5m</td>
            <td>10</td>
            <td>15.99</td>
            <td>159.90</td>
        </tr>
        <tr>
            <td>Govee DreamView T1 Immersion LED Kit</td>
            <td>1</td>
            <td>56.09</td>
            <td>56.09</td>
        </tr>
        <tr>
            <td>Mathmos Astro Lava Lamp</td>
            <td>1</td>
            <td>82.00</td>
            <td>82.00</td>
        </tr>
        <tr>
            <td><i><b>Total</b></i></td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td><b>404.99</b></td>
        </tr>
        <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
        </tr>
    </tbody>
    <thead>
        <tr>
            <th>Hubs üåé</th>
            <th>Units (#)</th>
            <th>Price per unit (¬£)</th>
            <th>Price (¬£)</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>ConBee II</td>
            <td>1</td>
            <td>37.42</td>
            <td>37.42</td>
        </tr>
        <tr>
            <td>Aqara M2 Hub</td>
            <td>1</td>
            <td>54.99</td>
            <td>54.99</td>
        </tr>
        <tr>
            <td>SwitchBot Hub</td>
            <td>1</td>
            <td>35.00</td>
            <td>35.00</td>
        </tr>
        <tr>
            <td><i><b>Total</b></i></td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td><b>127.41</b></td>
        </tr>
        <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
        </tr>
    </tbody>
    <thead>
        <tr>
            <th>Server & Network üñ•</th>
            <th>Units (#)</th>
            <th>Price per unit (¬£)</th>
            <th>Price (¬£)</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Raspberry Pi 4 Model B, 8GB RAM</td>
            <td>2</td>
            <td>75.50</td>
            <td>151.00</td>
        </tr>
        <tr>
            <td>Raspberry Pi 4 IceBerry Cooling Case</td>
            <td>2</td>
            <td>16.00</td>
            <td>32.00</td>
        </tr>
        <tr>
            <td>250GB SSD in Case</td>
            <td>2</td>
            <td>35.00</td>
            <td>70.00</td>
        </tr>
        <tr>
            <td>TP-Link TL-SG1005D, 5 Port Gigabit Ethernet Network Switch</td>
            <td>1</td>
            <td>10.49</td>
            <td>10.49</td>
        </tr>
        <tr>
            <td>Coral USB Accelerator</td>
            <td>1</td>
            <td>120.00</td>
            <td>120.00</td>
        </tr>
        <tr>
            <td>TP-Link TL-PA4010KIT Nano AV600 Powerline Adapter</td>
            <td>3</td>
            <td>23.41</td>
            <td>70.23</td>
        </tr>
        <tr>
            <td><i><b>Total</b></i></td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td><b>453.72</b></td>
        </tr>
        <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
        </tr>
    </tbody>
    <thead>
        <tr>
            <th>Device tracker üîç</th>
            <th>Units (#)</th>
            <th>Price per unit (¬£)</th>
            <th>Price (¬£)</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>iPhone 13 Pro Max with Companion App & Life360</td>
            <td>1</td>
            <td>1049.00</td>
            <td>1049.00</td>
        </tr>
        <tr>
            <td>iPhone 11 with Companion App & Life360</td>
            <td>1</td>
            <td>429.00</td>
            <td>429.00</td>
        </tr>
        <tr>
            <td><i><b>Total</b></i></td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td><b>1,478.78</b></td>
        </tr>
        <tr>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
        </tr>
    </tbody>
    <thead>
        <tr>
            <th>Total of Smart Home Devices (excl Media/Device Tracker) <br /> [as at Sept 22 (UK)]</th>
            <th></th>
            <th></th>
            <th><b>¬£1,461.11</b></th>
        </tr>
    </thead>
    <thead>
        <tr>
            <th>Total of All Devices (incl Media/Device Tracker) <br /> [as at Sept 22 (UK)]</th>
            <th></th>
            <th></th>
            <th><b>üò≥¬£6,632.74üò≥</b></th>
        </tr>
    </thead>
</table>
<!-- end-table -->
<p align="right">(<a href="#readme-top">back to top</a>)</p>

</details>
&nbsp;
<!-- ADD-ONS -->

<a name="addon"></a>

## Add-Ons _(as at Sept 22)_

This is a list of all of my add-ons within my setup. These also include the HACS integrations I currently use.

<!-- start-addons -->
<details><summary><b>Standard Add-Ons</b></summary>

- [ESPHome](https://github.com/esphome/esphome) version 2022.8.1 by @esphome
- [Frigate NVR](https://github.com/blakeblackshear/frigate) version 0.10.1 by @blakeblackshear
- [Git Pull](https://github.com/home-assistant/addons/tree/master/git_pull) version 7.13.1 by @hassio-addons
- [Home Assistant Google Drive Backup](https://github.com/sabeechen/hassio-google-drive-backup) version 0.106.1 by @sabeechen
- [MariaDB](https://github.com/home-assistant/addons/tree/master/mariadb) version 2.5.1 by @hassio-addons
- [Mosquitto Broker](https://github.com/home-assistant/addons/tree/master/mosquitto) version 6.1.3 by @hassio-addons
- [Nginx Proxy Manager](https://github.com/hassio-addons/addon-nginx-proxy-manager) version 0.12.2 by @hassio-addons
- [Node-RED](https://github.com/hassio-addons/addon-node-red) version 13.3.2 by @hassio-addons
- [Samba Share](https://github.com/home-assistant/addons/tree/master/samba) version 10.0.0 by @hassio-addons
- [Studio Code Server](https://github.com/hassio-addons/addon-vscode) version 5.3.0 by @hassio-addons
- [Terminal & SSH](https://github.com/hassio-addons/addon-ssh) version 12.0.2 by @hassio-addons
<p align="right">(<a href="#readme-top">back to top</a>)</p>
</details>
<!-- end-addons -->

<!-- start-hacs-integrations -->
<details><summary><b>HACS Integrations <i>(as at Sept 22)</i></b></summary>

- [HACS](https://github.com/hacs) version 1.27.1 by @ludeeus
- [Spotcast](https://github.com/fondberg/spotcast) version 3.6.30 by @fondberg
- [MeteoAlarm](https://github.com/kodi1/meteoalarm) version 294bc3a by @kodi1
- [Car Wash](https://github.com/Limych/ha-car_wash) version 1.5.4 by @Limych
- [SamsungTV Smart Component](https://github.com/ollo69/ha-samsungtv-smart) version 0.7.6 by @jaruba
- [Browser Mod](https://github.com/thomasloven/hass-browser_mod) version 2.1.2 by @thomasloven
- [Node-RED Companion](https://github.com/zachowj/hass-node-red) version 1.0.9 by @zachowj
- [Sonoff LAN](https://github.com/AlexxIT/SonoffLAN) version 3.2.0 by @AlexxIT
- [Google Home](https://github.com/leikoilja/ha-google-home) version 1.9.15 by @leikoilja
- [GOVEE](https://github.com/LaggAt/hacs-govee) version 0.2.2 by @LaggAt
- [Frigate](https://github.com/blakeblackshear/frigate-hass-integration) version 2.3 by @blakeblackshear
- [Tapo Controller](https://github.com/petretiandrea/home-assistant-tapo-p100) version 1.2.15 by @petretinandrea
- [UI Lovelace Minimalist](https://github.com/UI-Lovelace-Minimalist/UI) version 1.1.2 by @stokkie90
- [Watchman](https://github.com/dummylabs/thewatchman#configuration) version 0.6.0 by @dummylabs
- [LondonTfL](https://github.com/morosanmihail/HA-LondonTfL) version 0.3.1 by @morosanmihail
- [Music Assistant](https://github.com/music-assistant/hass-music-assistant) version 2022.8.4 by @marcelveldt
<p align="right">(<a href="#readme-top">back to top</a>)</p>
</details>
<!-- end-hacs-integrations -->

<!-- start-hacs-frontend -->
<details><summary><b>HACS Frontend <i>(as at Sept 22)</i></b></summary>

- [Swipe Card](https://github.com/bramkragten/swipe-card) version 4.0.0 by @bramkragten
- [Button Card](https://github.com/custom-cards/button-card) version 3.5.0 by @RomRider
- [Decluttering Card](https://github.com/custom-cards/decluttering-card) version 0.6.3 @RomRider
- [HASL Departure Card](https://github.com/hasl-sensor/lovelace-hasl-departure-card) version 2.5.0 by @hasl-sensor
- [Restriction Card](https://github.com/iantrich/restriction-card) version 1.2.7 by @iantrich
- [Mini Media Player](https://github.com/kalkih/mini-media-player) version 1.16.4 by @kalkih
- [Light Entity Card](https://github.com/ljmerza/light-entity-card) version 5.0.0 by @ljmerza
- [TV Remote Card](https://github.com/marrobHD/tv-card) version 0.2.0 by @marrobHD
- [Card Mod](https://github.com/thomasloven/lovelace-card-mod) version 3.1.5 by @thomasloven
- [Layout Card](https://github.com/thomasloven/lovelace-layout-card) version 2.4.2 by @thomasloven
- [Apex Charts Card](https://github.com/RomRider/apexcharts-card) version 2.0.1 by @RomRider
- [Notify Card](https://github.com/bernikr/lovelace-notify-card) version f0b8b1f
- [Mini Graph Card](https://github.com/kalkih/mini-graph-card) version 0.11.0 by @kalkih
- [Frigate Card](https://github.com/dermotduffy/frigate-hass-card) version 3.0.0 by @dermotduffy
- [Atomic Calendar Revive](https://github.com/totaldebug/atomic-calendar-revive) version 7.0.1 by @totaldebug
- [Mushroom UI](https://github.com/piitaya/lovelace-mushroom) version 2.1.3 by @piitaya
- [Mushroom Themes](https://github.com/piitaya/lovelace-mushroom-themes) version 0.0.2 by @piitaya
- [Weather Radar Card](https://github.com/Makin-Things/weather-radar-card) version 2.0.6 by @Makin-Things
- [Slider Button Card](https://github.com/custom-cards/slider-button-card) version 1.10.9 by @mattieha
- [Kiosk Mode](https://github.com/NemesisRE/kiosk-mode) version 1.7.3 by @NemesisRE
- [My Cards Bundle](https://github.com/AnthonMS/my-cards) version 1.0.2 by @AnthonMS
- [Auto Entities](https://github.com/thomasloven/lovelace-auto-entities) version 1.11.0 by @thomasloven
<p align="right">(<a href="#readme-top">back to top</a>)</p>
</details>
<!-- end-hacs-frontend -->
&nbsp;

<!-- AUTOMATIONS TOC -->

<a name="automations"></a>

## Automations _(as at Sept 22)_

There is a full list of all of my automations <a href="allautomations">here</a>. Below is the table of contents of all of the automations.
<br />

<!-- start-automations -->

**Table of Contents**

1.  [Security üëÆüö®](#security) (10 automations)
2.  [Lighting üåÑüåá](#lighting) (37 automations)
3.  [Transport üöåüöù](#transport) (7 automations)
4.  [HA-System ‚è∞üñ•Ô∏è](#hasystem) (6 automations)
5.  [Media üîäüì∫](#media) (5 automations)
6.  [TTS üîäüì±](#tts) (5 automations)
7.  [Sleeping üõèÔ∏èüì°](#sleep) (1 automations)

‚ö†Ô∏è Total number of automations: **71** ‚ö†Ô∏è

<p align="right">(<a href="#readme-top">back to top</a>)</p>

<!-- CONTRIBUTING -->

<a name="contributing"></a>

## Contributing

Contributions are what make the open source community such an amazing place to learn, inspire, and create. Any contributions you make are **greatly appreciated**.

If you have a suggestion that would make this better, please fork the repo and create a pull request. You can also simply open an issue with the tag "enhancement" or "feature-request".
Don't forget to give the project a star! Thanks again!

1. Fork the Project.
2. Create your Feature Branch (`git checkout -b feature/AmazingFeature`)
3. Commit your Changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to the Branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request

<p align="right">(<a href="#readme-top">back to top</a>)</p>

<!-- LICENSE -->

<a name="license"></a>

## License

Distributed under the MIT License. See <a href="https://github.com/smcnab1/op-question-mark/blob/master/LICENSE.md">`LICENSE.md`</a> for more information.

<p align="right">(<a href="#readme-top">back to top</a>)</p>

<!-- CONTACT -->

<a name="contact"></a>

## Contact

[![Email][email-badge]][email-url]
[![LinkedIn][linkedin-shield]][linkedin-url]
[![GitHub][git-badge]][git-url]
[![Kofi][kofi-badge]][kofi-url]
[![Signal][signal-badge]][signal-url]
[![Telegram][telegram-badge]][telegram-url]
<br />

<p align="right">(<a href="#readme-top">back to top</a>)</p>

<!-- ALL AUTOMATIONS -->

<a name="allautomations"></a>

## All Automations _(as at Sept 22)_

<!-- SECURITY AUTOMATIONS -->
<a name="security"></a>
<details><summary><b><a href="https://github.com/smcnab1/op-question-mark/tree/master/automations/alarm">Security üëÆüö® Automations (10 automations)</a></b></summary><blockquote>
    
<!-- 1 -->
    
<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/alarm/arm_notify_reminder.yaml">Alarm Arm Notifiction Reminder</a></b></summary>
<b><i>Remind everyone to arm the alarm when leaving the house. Only if alarm hasn't already been set.</b></i>

&nbsp;&nbsp;_which uses:_

- [alarm_control_panel.home_alarm](https://github.com/smcnab1/op-question-mark/blob/master/entities/alarm.yaml)
- [zone.home](https://github.com/smcnab1/op-question-mark/blob/master/entities/zone.yaml)
- [HA Actionable Notifications](https://companion.home-assistant.io/docs/notifications/actionable-notifications/) </details>
  
<!-- 2 -->
 
<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/alarm/arm_notify_actions.yaml">Alarm Arm Notifiction Actions</a></b></summary>
<b><i>This automation arms the alarm and sends notifications to everyone to confirm it is now armed.</b></i>

&nbsp;&nbsp;_which uses:_

- [alarm_control_panel.home_alarm](https://github.com/smcnab1/op-question-mark/blob/master/automations/alarm/arm_notify_reminder.yaml)
- [zone.home](https://github.com/smcnab1/op-question-mark/blob/master/entities/zone.yaml)
- [HA Actionable Notifications](https://companion.home-assistant.io/docs/notifications/actionable-notifications/) </details>
    
<!-- 3 -->
    
<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/alarm/disarm_notify.yaml">Alarm Disarm Nofification</a></b></summary>
<b><i>Automation to disarm the alarm and notify everyone that it has been disarmed following the alarm triggering.</b></i>

&nbsp;&nbsp;_which uses:_

- [alarm_control_panel.home_alarm](https://github.com/smcnab1/op-question-mark/blob/master/automations/alarm/arm_notify_reminder.yaml)
- [HA Actionable Notifications](https://companion.home-assistant.io/docs/notifications/actionable-notifications/) </details>

<!-- 4 -->
    
<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/alarm/overnight_living_room.yaml">Alarm Overnight Living Room</a></b></summary>
<b><i>Automation to send notification and camera screenshot to bedroom TV if motion detected in Living Room when everyone is asleep.</b></i>

&nbsp;&nbsp;_which uses:_

- [input_boolean.sleeping](https://github.com/smcnab1/op-question-mark/blob/master/entities/input_boolean/all_sleeping.yaml)
- [MQTT Add-On](https://github.com/home-assistant/addons/tree/master/mosquitto)
- [Frigate Add-On](https://github.com/blakeblackshear/frigate)
- [Android TV Notifications Integration](https://www.home-assistant.io/integrations/nfandroidtv/)
- [Android TV Integration](https://www.home-assistant.io/integrations/androidtv/)</details>

<!-- 5 -->
    
<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/alarm/trigger.yaml">Alarm Trigger</a></b></summary>
<b><i>Automation to trigger the alarm if motion is detected within the house when set to armed away and nobody home.</b></i>

&nbsp;&nbsp;_which uses:_

- [alarm_control_panel.home_alarm](https://github.com/smcnab1/op-question-mark/blob/master/automations/alarm/arm_notify_reminder.yaml) </details>

<!-- 6 -->
  
<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/alarm/trigger_lighting.yaml">Alarm Trigger Lighting</a></b></summary>
<b><i>Automation to trigger the lighting sequence if alarm is triggered when set to armed away and nobody home.</b></i>

&nbsp;&nbsp;_which uses:_

- [alarm_control_panel.home_alarm](https://github.com/smcnab1/op-question-mark/blob/master/automations/alarm/arm_notify_reminder.yaml) </details>

<!-- 7 -->
  
<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/alarm/trigger_sound.yaml">Alarm Trigger Sound</a></b></summary>
<b><i>Automation to trigger the sound sequence if alarm is triggered when set to armed away and nobody home. Includes audible siren and TTS.</b></i>

&nbsp;&nbsp;_which uses:_

- [alarm_control_panel.home_alarm](https://github.com/smcnab1/op-question-mark/blob/master/automations/alarm/arm_notify_reminder.yaml)
- [Nabu-Casa TTS Cloud](https://www.nabucasa.com/config/tts/) </details>

<!-- 8 -->
  
<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/alarm/trigger_notify.yaml">Alarm Trigger Notify</a></b></summary>
<b><i>Automation to notify everyone when the alarm is triggered when set to armed away and nobody home.</b></i>

&nbsp;&nbsp;_which uses:_

- [alarm_control_panel.home_alarm](https://github.com/smcnab1/op-question-mark/blob/master/automations/alarm/arm_notify_reminder.yaml)
- [HA Actionable Notifications](https://companion.home-assistant.io/docs/notifications/actionable-notifications/) </details>

<!-- 9 -->
  
<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/alarm/disarm_tag.yaml">Alarm Disarm Tag</a></b></summary>
<b><i>NFC Tag used to easily disarm the alarm system</b></i>

&nbsp;&nbsp;_which uses:_

- [alarm_control_panel.home_alarm](https://github.com/smcnab1/op-question-mark/blob/master/automations/alarm/arm_notify_reminder.yaml)
- [HA NFC Tag Integration](https://www.home-assistant.io/blog/2020/09/15/home-assistant-tags/) </details>

<!-- 10 -->
  
<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/alarm/arm_tag.yaml">Alarm Arm Tag</a></b></summary>
<b><i>NFC Tag used to easily arm the alarm system</b></i>

&nbsp;&nbsp;_which uses:_

- [alarm_control_panel.home_alarm](https://github.com/smcnab1/op-question-mark/blob/master/automations/alarm/arm_notify_reminder.yaml)
- [HA NFC Tag Integration](https://www.home-assistant.io/blog/2020/09/15/home-assistant-tags/) </details>

</blockquote></details>

<!-- LIGHTING AUTOMATIONS -->
<a name="lighting"></a>
<details><summary><b><a href="https://github.com/smcnab1/op-question-mark/tree/master/automations/lighting">Lighting üåÑüåá Automations (37 automations)</a></b></summary><blockquote>

<!-- BATHROOM LIGHTING AUTOMATIONS -->
<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/tree/master/automations/lighting/bathroom">Bathroom üõÄ Lighting</a></b></summary><blockquote>

<details><summary><b>Bathroom Motion Automation</b></summary><blockquote>
<b><i>Automation which works with motion sensors to activate and de-activate lighting. Also depends on time of day.</b></i>

![Node-Red Flow](https://i.imgur.com/EY4Z9MB.png)

<details><summary>Node-Red Code</summary><blockquote>
[{"id":"68862836.29c7a8","type":"subflow","name":"Lights Motion Control","info":"","category":"home_assistant","in":[{"x":57,"y":162,"wires":[{"id":"92cf1e14.7068"}]}],"out":[{"x":470,"y":375,"wires":[{"id":"38649522.99f89a","port":0}]},{"x":560,"y":390,"wires":[{"id":"38649522.99f89a","port":1}]},{"x":650,"y":75,"wires":[{"id":"2a0d169a.91782a","port":0}]},{"x":890,"y":105,"wires":[{"id":"d5248d86.f7096","port":0}]}],"env":[{"name":"timeOffAfter","type":"num","value":"120"},{"name":"manualCooldown","type":"num","value":"30"},{"name":"brightness","type":"num","value":"100","ui":{"type":"input","opts":{"types":["num","bool","json","bin"]}}},{"name":"transitionOn","type":"num","value":"2"},{"name":"transitionOff","type":"num","value":"2"},{"name":"pause","type":"str","value":"5"},{"name":"controlLights","type":"str","value":""},{"name":"manualLight","type":"bool","value":"false"}],"meta":{},"color":"#52C0F2","icon":"font-awesome/fa-lightbulb-o","status":{"x":1027,"y":157,"wires":[{"id":"effe188b.5340f8","port":0}]}},{"id":"cf76e785.ab1978","type":"change","z":"68862836.29c7a8","name":"motion","rules":[{"t":"set","p":"payload","pt":"msg","to":"motion","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":544,"y":178,"wires":[["d5248d86.f7096"]]},{"id":"d5248d86.f7096","type":"state-machine","z":"68862836.29c7a8","name":"","triggerProperty":"payload","triggerPropertyType":"msg","stateProperty":"payload","statePropertyType":"msg","initialDelay":"","persistOnReload":true,"outputStateChangeOnly":true,"throwException":false,"states":["switch","motion-detected","motion-on","motion-off","off","on"],"transitions":[{"name":"motion","from":"off","to":"motion-detected"},{"name":"motion","from":"motion-off","to":"motion-detected"},{"name":"motion","from":"motion-on","to":"motion-on"},{"name":"off","from":"*","to":"off"},{"name":"on","from":"*","to":"on"},{"name":"switch","from":"off","to":"switch"},{"name":"switch","from":"on","to":"switch"},{"name":"switch","from":"switch","to":"switch"},{"name":"switch","from":"motion-on","to":"switch"},{"name":"motion-on","from":"motion-detected","to":"motion-on"},{"name":"motion-off","from":"motion-on","to":"motion-off"}],"x":741,"y":157,"wires":[["38649522.99f89a","effe188b.5340f8"]]},{"id":"d2742f90.7a1ce","type":"change","z":"68862836.29c7a8","name":"switch","rules":[{"t":"set","p":"payload","pt":"msg","to":"switch","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":541,"y":223,"wires":[["d5248d86.f7096"]]},{"id":"cab8f6da.31e818","type":"change","z":"68862836.29c7a8","name":"stop","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":630,"wires":[["380a05c00a74bf5f"]]},{"id":"ca0b865c.9f9898","type":"inject","z":"68862836.29c7a8","name":"Initial State","props":[{"p":"reset","v":"true","vt":"bool"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"10","topic":"","x":665,"y":570,"wires":[["6210bc08.905bc4","3044ab1b0964f72a"]]},{"id":"faa9cc31.66ec7","type":"link in","z":"68862836.29c7a8","name":"","links":["801822a5.c6d75","e8072572.fffa18"],"x":592,"y":120,"wires":[["d5248d86.f7096"]]},{"id":"801822a5.c6d75","type":"link out","z":"68862836.29c7a8","name":"living room state","links":["faa9cc31.66ec7"],"x":1020,"y":570,"wires":[]},{"id":"38649522.99f89a","type":"switch","z":"68862836.29c7a8","name":"State Action","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"motion-detected","vt":"str"},{"t":"eq","v":"motion-off","vt":"str"},{"t":"eq","v":"motion-on","vt":"str"},{"t":"eq","v":"switch","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":230,"y":465,"wires":[["4c844b6f.159114","a26b8394.bcc5c"],["3dda34d6.1dd5bc"],["7f31ef6f068e5b93"],["cab8f6da.31e818","ba847a7ca44c07c3"]]},{"id":"82902d91.d0dbf","type":"rbe","z":"68862836.29c7a8","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":369,"y":223,"wires":[["d2742f90.7a1ce"]]},{"id":"92cf1e14.7068","type":"switch","z":"68862836.29c7a8","name":"Topic Route","property":"topic","propertyType":"msg","rules":[{"t":"regex","v":"^config\\b","vt":"str","case":false},{"t":"regex","v":"^reset\\b","vt":"str","case":false},{"t":"eq","v":"light_state","vt":"str"},{"t":"cont","v":"sensor.","vt":"str"},{"t":"regex","v":"^(light|switch)\\.","vt":"str","case":false}],"checkall":"true","repair":false,"outputs":5,"x":175,"y":162,"wires":[["2a0d169a.91782a"],["ba8e1c42c48890af"],["d5248d86.f7096"],["d1f38468.a6c768"],["82902d91.d0dbf","4a9e28b2.6d3bf8"]]},{"id":"2a0d169a.91782a","type":"function","z":"68862836.29c7a8","name":"Update Configuration","func":"// Init our Lights state while we're here\nlet lights = flow.get('lights')\n// Is this our start-up initialisation? (If so, reset config!)\nlet init = msg.init || false\nif (!lights)\n  flow.set('lights', { state: { }, ids: [], ids_csv: '' })\n\n// Merge new Payload with existing config and defaults\nlet cfg = Object.assign(\n  // Existing Config\n  init?flow.get('cfg')||{}:{},  // 'cfg.'+id\n  // Updated Config\n  msg.payload)\n\n// Make sure Light IDs are initted.\n// if (!cfg.lights) cfg.lights = []\nif (!cfg.brightness)\n  cfg.brightness = env.get('brightness') || 100\n\nif (!cfg.transitionOn && cfg.transitionOn !== 0)\n  cfg.transitionOn = env.get('transitionOn') || 2\n  \nif (!cfg.transitionOff && cfg.transitionOff !== 0)\n  cfg.transitionOff = env.get('transitionOff') || 2\n\nif (!cfg.lights && env.get('controlLights') && env.get('controlLights').length>0)\n    cfg.lights = env.get('controlLights').split(/\\s*,\\s*/)\n\nflow.set('cfg', cfg)\n\nreturn { topic: 'config', payload: cfg, lights }","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":505,"y":75,"wires":[[]]},{"id":"d1f38468.a6c768","type":"switch","z":"68862836.29c7a8","name":"motion on","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":375,"y":178,"wires":[["cf76e785.ab1978"]]},{"id":"4a9e28b2.6d3bf8","type":"function","z":"68862836.29c7a8","name":"Track Lights","func":"// Keep a record of all the light entity_ids coming in, for later switching\n\nlet lights = flow.get('lights') || { state: { }, ids: [], ids_csv: '' }\n\nlet [all, id] = msg.topic.match(/^light\\.(.*)/)\nlet update = false\n\nif (id) {\n  lights.state[id] = msg.data.new_state\n  if (!lights.ids.includes(id)) {\n    lights.ids.push(id)\n    update = true\n  }\n  lights.ids_csv = lights.ids.join(',')\n}\n\nflow.set('lights', lights)\n\nreturn {update}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":389,"y":268,"wires":[["daf678d0db2af786"]]},{"id":"4c844b6f.159114","type":"function","z":"68862836.29c7a8","name":"Light Cfg","func":"let cfg = flow.get('cfg')|| {}\nlet lights = flow.get('lights') || {}\n// Use Light IDs from Config if defined - otherwise use detected\nlet light_ids = cfg.lights || lights.ids\nlet delay = env.get('pause')*1000\n\n// Prepare config paramters for Light On. This is\n// an Array of Payload Data, one for each light\nlet payload = light_ids.map(id => { return {\n  data: {\n    brightness: Math.floor(cfg.brightness/100*255),\n    transition: cfg.transitionOn,\n    entity_id: 'light.'+id\n  }\n}})\n\nreturn {\n    topic: 'light.'+light_ids.join(','),\n    payload,\n    delay\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":525,"y":330,"wires":[["3cbac613.622432","e49dfffe0583db4e"]]},{"id":"3dda34d6.1dd5bc","type":"function","z":"68862836.29c7a8","name":"Light Cfg","func":"let cfg = flow.get('cfg')|| {}\nlet lights = flow.get('lights') || {}\n// Use Light IDs from Config if defined - otherwise use detected\nlet light_ids = cfg.lights || lights.ids\nlet delay = env.get('pause')*1000\n\n// Prepare config paramters for Light Off. This is\n// an Array of Payload Data, one for each light\nlet payload = light_ids.map(id => { return {\n  data: {\n    transition: cfg.transitionOff,\n    entity_id: 'light.'+id\n  }\n}})\n\nreturn {\n    topic: 'light.'+light_ids.join(','),\n    payload,\n    delay\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":525,"y":435,"wires":[["35ad226.a497bde","b1d245649953149b"]]},{"id":"35088d77.068da2","type":"inject","z":"68862836.29c7a8","name":"Default Configuration","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"init","v":"true","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"config","payload":"{}","payloadType":"json","x":235,"y":75,"wires":[["2a0d169a.91782a"]]},{"id":"949bf90b.fc19e8","type":"api-call-service","z":"68862836.29c7a8","name":"Turn on light","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1045,"y":285,"wires":[[]]},{"id":"a68e2b6.6b0c1d8","type":"api-call-service","z":"68862836.29c7a8","name":"Turn off light","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1045,"y":435,"wires":[[]]},{"id":"6210bc08.905bc4","type":"function","z":"68862836.29c7a8","name":"Check State","func":"// Fetch light state from our \"Track Lights\" data\n// - no need for a HA State node\n\nlet lights = flow.get('lights') || { state: { }, ids: [], ids_csv: '' }\nlet cfg = flow.get('cfg')|| {}\n\n// Return \"on\" if any one light is \"on\"\nreturn {\n    topic: 'light.'+lights.ids_csv,\n    payload: lights.ids.map(id => lights.state[id].state).includes('on') ? 'on' : 'off'\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":910,"y":525,"wires":[["801822a5.c6d75"]]},{"id":"3c89b834.84d1a8","type":"split","z":"68862836.29c7a8","name":"Each Light","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":880,"y":285,"wires":[["949bf90b.fc19e8"]]},{"id":"389eef7d.ef9a","type":"split","z":"68862836.29c7a8","name":"Each Light","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":875,"y":435,"wires":[["a68e2b6.6b0c1d8"]]},{"id":"39541c73.33d464","type":"function","z":"68862836.29c7a8","name":"motion-on","func":"// We use a function here to generate a new clean message\n\nreturn {\n    topic: 'state',\n    payload: 'motion-on'\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":885,"y":330,"wires":[["e8072572.fffa18"]]},{"id":"2368d65a.ed031a","type":"function","z":"68862836.29c7a8","name":"motion-off","func":"// We use a function here to generate a new clean message\n\nreturn {\n    topic: 'state',\n    payload: 'motion-off'\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":900,"y":615,"wires":[["801822a5.c6d75"]]},{"id":"a26b8394.bcc5c","type":"change","z":"68862836.29c7a8","name":"stop","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":480,"wires":[["b1d245649953149b"]]},{"id":"effe188b.5340f8","type":"function","z":"68862836.29c7a8","name":"status","func":"\nmsg.payload = {\n    text: msg.payload, \n    shape: msg.payload.match(/on/) ? 'ring' : 'dot',\n    fill: msg.payload == 'switch' ? 'red' : 'green'\n}\nreturn msg;","outputs":1,"noerr":0,"x":928,"y":157,"wires":[[]]},{"id":"3cbac613.622432","type":"switch","z":"68862836.29c7a8","name":"Manual?","property":"manualLight","propertyType":"env","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":705,"y":285,"wires":[[],["3c89b834.84d1a8"]]},{"id":"35ad226.a497bde","type":"switch","z":"68862836.29c7a8","name":"Manual?","property":"manualLight","propertyType":"env","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":705,"y":435,"wires":[[],["389eef7d.ef9a"]]},{"id":"e8072572.fffa18","type":"link out","z":"68862836.29c7a8","name":"living room state","links":["faa9cc31.66ec7"],"x":990,"y":330,"wires":[]},{"id":"ba8e1c42c48890af","type":"function","z":"68862836.29c7a8","name":"Reset","func":"flow.set('lights', null)\nflow.set('cfg', null)\n\nreturn msg","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":365,"y":135,"wires":[["2a0d169a.91782a"]]},{"id":"daf678d0db2af786","type":"switch","z":"68862836.29c7a8","name":"Updated?","property":"update","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":540,"y":270,"wires":[["2a0d169a.91782a"]]},{"id":"e49dfffe0583db4e","type":"trigger","z":"68862836.29c7a8","name":"pause","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":true,"units":"s","reset":"stop","bytopic":"all","topic":"topic","outputs":1,"x":695,"y":330,"wires":[["39541c73.33d464"]]},{"id":"b1d245649953149b","type":"trigger","z":"68862836.29c7a8","name":"pause","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":true,"units":"s","reset":"stop","bytopic":"all","topic":"topic","outputs":1,"x":695,"y":480,"wires":[["6210bc08.905bc4"]]},{"id":"3044ab1b0964f72a","type":"trigger","z":"68862836.29c7a8","name":"Back to Auto","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":true,"units":"s","reset":"stop","bytopic":"all","topic":"topic","outputs":1,"x":715,"y":525,"wires":[["6210bc08.905bc4"]]},{"id":"ba847a7ca44c07c3","type":"change","z":"68862836.29c7a8","name":"cooldown","rules":[{"t":"set","p":"delay","pt":"msg","to":"$env('manualCooldown')*1000","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":525,"y":525,"wires":[["3044ab1b0964f72a"]]},{"id":"7f31ef6f068e5b93","type":"change","z":"68862836.29c7a8","name":"timeOffAfter","rules":[{"t":"set","p":"delay","pt":"msg","to":"$env('timeOffAfter')*1000","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":455,"y":585,"wires":[["380a05c00a74bf5f"]]},{"id":"380a05c00a74bf5f","type":"trigger","z":"68862836.29c7a8","name":"Turn Off after motion ends","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":true,"units":"s","reset":"stop","bytopic":"all","topic":"topic","outputs":1,"x":685,"y":615,"wires":[["2368d65a.ed031a"]]},{"id":"c46ec6da75a29ac3","type":"tab","label":"Bathroom","disabled":false,"info":"","env":[]},{"id":"f62a5fe922bbfc46","type":"group","z":"c46ec6da75a29ac3","name":"Bathroom Lighting - Motion Control","style":{"label":true},"nodes":["8507bbf2b43edb42","320a5239e659a925","5de7c99b23116528","e32d0d9f4c16c828","3dc06a21f17a8a5f","a354ab4fe46b4009","786c57f14537f62a","27bf483d8e1ad89d","a19d428692b659d3"],"x":14,"y":19,"w":892,"h":262},{"id":"8507bbf2b43edb42","type":"server-state-changed","z":"c46ec6da75a29ac3","g":"f62a5fe922bbfc46","name":"Light Changed - Bathroom","server":"f43d015e.4b29","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"light.bathroom_main_lights","entityidfiltertype":"regex","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":150,"y":100,"wires":[["e32d0d9f4c16c828"]]},{"id":"320a5239e659a925","type":"server-state-changed","z":"c46ec6da75a29ac3","g":"f62a5fe922bbfc46","name":"Presence - Bathroom","server":"f43d015e.4b29","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.bathroom_motion_sensor","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":140,"y":165,"wires":[["e32d0d9f4c16c828"],[]]},{"id":"5de7c99b23116528","type":"subflow:68862836.29c7a8","z":"c46ec6da75a29ac3","g":"f62a5fe922bbfc46","name":"","env":[{"name":"timeOffAfter","value":"500","type":"num"},{"name":"brightness","value":"","type":"num"},{"name":"manualLight","value":"true","type":"bool"}],"x":540,"y":100,"wires":[["a354ab4fe46b4009"],["a19d428692b659d3"],[],[]]},{"id":"e32d0d9f4c16c828","type":"time-range-switch","z":"c46ec6da75a29ac3","g":"f62a5fe922bbfc46","name":"Day?","lat":"","lon":"","startTime":"10:00","endTime":"23:00","startOffset":0,"endOffset":0,"x":350,"y":140,"wires":[["5de7c99b23116528"],["3dc06a21f17a8a5f"]]},{"id":"3dc06a21f17a8a5f","type":"subflow:68862836.29c7a8","z":"c46ec6da75a29ac3","g":"f62a5fe922bbfc46","name":"","env":[{"name":"timeOffAfter","value":"500","type":"num"},{"name":"brightness","value":"","type":"num"},{"name":"manualLight","value":"true","type":"bool"}],"x":540,"y":180,"wires":[["786c57f14537f62a"],["27bf483d8e1ad89d"],[],[]]},{"id":"a354ab4fe46b4009","type":"api-call-service","z":"c46ec6da75a29ac3","g":"f62a5fe922bbfc46","name":"Day Scene ON","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"scene","service":"turn_on","areaId":[],"deviceId":[],"entityId":["scene.bathroom_day"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":760,"y":60,"wires":[[]]},{"id":"786c57f14537f62a","type":"api-call-service","z":"c46ec6da75a29ac3","g":"f62a5fe922bbfc46","name":"Night Scene ON","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"scene","service":"turn_on","areaId":[],"deviceId":[],"entityId":["scene.bathroom_morning"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":760,"y":180,"wires":[[]]},{"id":"27bf483d8e1ad89d","type":"api-call-service","z":"c46ec6da75a29ac3","g":"f62a5fe922bbfc46","name":"Bathroom Lights OFF","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.bathroom_main_lights"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":780,"y":240,"wires":[[]]},{"id":"a19d428692b659d3","type":"api-call-service","z":"c46ec6da75a29ac3","g":"f62a5fe922bbfc46","name":"Bathroom Lights OFF","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.bathroom_main_lights"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":780,"y":120,"wires":[[]]},{"id":"f43d015e.4b29","type":"server","name":"Home Assistant","version":4,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true,"cacheJson":true,"heartbeat":false,"heartbeatInterval":30,"areaSelector":"friendlyName","deviceSelector":"friendlyName","entitySelector":"friendlyName","statusSeparator":"at: ","statusYear":"hidden","statusMonth":"short","statusDay":"numeric","statusHourCycle":"h23","statusTimeFormat":"h:m"}]
</details>

&nbsp;&nbsp;_which uses:_

- [Node-RED Add-On](https://github.com/hassio-addons/addon-node-red)
- [@dortamur's Node-Red Motion Lighting Flow Template](https://github.com/dortamur/ha-node-red-flows) </details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/lighting/bathroom/bath.yaml">Bath Time</a></b></summary><blockquote>
<b><i>Automation to activate bath time scene.</b></i>

</details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/lighting/bathroom/morning.yaml">Morning</a></b></summary><blockquote>
<b><i>Automation to activate morning bathroom scene.</b></i>

&nbsp;&nbsp;_which uses:_

- [scene.bathroom_morning](https://github.com/smcnab1/op-question-mark/blob/master/entities/scenes/bathroom/morning.yaml) </details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/lighting/bathroom/normal.yaml">Normal</a></b></summary><blockquote>
<b><i>Automation to activate normal bathroom scene.</b></i>

&nbsp;&nbsp;_which uses:_

- [scene.bathroom_day](https://github.com/smcnab1/op-question-mark/blob/master/entities/scenes/bathroom/day.yaml) </details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/lighting/bathroom/off.yaml">Off</a></b></summary><blockquote>
<b><i>Automation to turn off all bathroom lights.</b></i>
</details>

</blockquote></details>

<!-- BEDROOM LIGHTING AUTOMATIONS -->
<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/tree/master/automations/lighting/bedroom">Bedroom üõèÔ∏è Lighting</a></b></summary><blockquote>

<details><summary><b>Bedroom Motion Automation</b></summary><blockquote>
<b><i>Automation which works with motion sensors to activate and de-activate lighting. Also depends on current sleeping status through Bed Sensors.</b></i>

![Node-Red Flow](https://i.imgur.com/rRnmC3Y.png)

<details><summary>Node-Red Code</summary><blockquote>
[{"id":"68862836.29c7a8","type":"subflow","name":"Lights Motion Control","info":"","category":"home_assistant","in":[{"x":57,"y":162,"wires":[{"id":"92cf1e14.7068"}]}],"out":[{"x":470,"y":375,"wires":[{"id":"38649522.99f89a","port":0}]},{"x":560,"y":390,"wires":[{"id":"38649522.99f89a","port":1}]},{"x":650,"y":75,"wires":[{"id":"2a0d169a.91782a","port":0}]},{"x":890,"y":105,"wires":[{"id":"d5248d86.f7096","port":0}]}],"env":[{"name":"timeOffAfter","type":"num","value":"120"},{"name":"manualCooldown","type":"num","value":"30"},{"name":"brightness","type":"num","value":"100","ui":{"type":"input","opts":{"types":["num","bool","json","bin"]}}},{"name":"transitionOn","type":"num","value":"2"},{"name":"transitionOff","type":"num","value":"2"},{"name":"pause","type":"str","value":"5"},{"name":"controlLights","type":"str","value":""},{"name":"manualLight","type":"bool","value":"false"}],"meta":{},"color":"#52C0F2","icon":"font-awesome/fa-lightbulb-o","status":{"x":1027,"y":157,"wires":[{"id":"effe188b.5340f8","port":0}]}},{"id":"cf76e785.ab1978","type":"change","z":"68862836.29c7a8","name":"motion","rules":[{"t":"set","p":"payload","pt":"msg","to":"motion","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":544,"y":178,"wires":[["d5248d86.f7096"]]},{"id":"d5248d86.f7096","type":"state-machine","z":"68862836.29c7a8","name":"","triggerProperty":"payload","triggerPropertyType":"msg","stateProperty":"payload","statePropertyType":"msg","initialDelay":"","persistOnReload":true,"outputStateChangeOnly":true,"throwException":false,"states":["switch","motion-detected","motion-on","motion-off","off","on"],"transitions":[{"name":"motion","from":"off","to":"motion-detected"},{"name":"motion","from":"motion-off","to":"motion-detected"},{"name":"motion","from":"motion-on","to":"motion-on"},{"name":"off","from":"*","to":"off"},{"name":"on","from":"*","to":"on"},{"name":"switch","from":"off","to":"switch"},{"name":"switch","from":"on","to":"switch"},{"name":"switch","from":"switch","to":"switch"},{"name":"switch","from":"motion-on","to":"switch"},{"name":"motion-on","from":"motion-detected","to":"motion-on"},{"name":"motion-off","from":"motion-on","to":"motion-off"}],"x":741,"y":157,"wires":[["38649522.99f89a","effe188b.5340f8"]]},{"id":"d2742f90.7a1ce","type":"change","z":"68862836.29c7a8","name":"switch","rules":[{"t":"set","p":"payload","pt":"msg","to":"switch","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":541,"y":223,"wires":[["d5248d86.f7096"]]},{"id":"cab8f6da.31e818","type":"change","z":"68862836.29c7a8","name":"stop","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":630,"wires":[["380a05c00a74bf5f"]]},{"id":"ca0b865c.9f9898","type":"inject","z":"68862836.29c7a8","name":"Initial State","props":[{"p":"reset","v":"true","vt":"bool"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"10","topic":"","x":665,"y":570,"wires":[["6210bc08.905bc4","3044ab1b0964f72a"]]},{"id":"faa9cc31.66ec7","type":"link in","z":"68862836.29c7a8","name":"","links":["801822a5.c6d75","e8072572.fffa18"],"x":592,"y":120,"wires":[["d5248d86.f7096"]]},{"id":"801822a5.c6d75","type":"link out","z":"68862836.29c7a8","name":"living room state","links":["faa9cc31.66ec7"],"x":1020,"y":570,"wires":[]},{"id":"38649522.99f89a","type":"switch","z":"68862836.29c7a8","name":"State Action","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"motion-detected","vt":"str"},{"t":"eq","v":"motion-off","vt":"str"},{"t":"eq","v":"motion-on","vt":"str"},{"t":"eq","v":"switch","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":230,"y":465,"wires":[["4c844b6f.159114","a26b8394.bcc5c"],["3dda34d6.1dd5bc"],["7f31ef6f068e5b93"],["cab8f6da.31e818","ba847a7ca44c07c3"]]},{"id":"82902d91.d0dbf","type":"rbe","z":"68862836.29c7a8","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":369,"y":223,"wires":[["d2742f90.7a1ce"]]},{"id":"92cf1e14.7068","type":"switch","z":"68862836.29c7a8","name":"Topic Route","property":"topic","propertyType":"msg","rules":[{"t":"regex","v":"^config\\b","vt":"str","case":false},{"t":"regex","v":"^reset\\b","vt":"str","case":false},{"t":"eq","v":"light_state","vt":"str"},{"t":"cont","v":"sensor.","vt":"str"},{"t":"regex","v":"^(light|switch)\\.","vt":"str","case":false}],"checkall":"true","repair":false,"outputs":5,"x":175,"y":162,"wires":[["2a0d169a.91782a"],["ba8e1c42c48890af"],["d5248d86.f7096"],["d1f38468.a6c768"],["82902d91.d0dbf","4a9e28b2.6d3bf8"]]},{"id":"2a0d169a.91782a","type":"function","z":"68862836.29c7a8","name":"Update Configuration","func":"// Init our Lights state while we're here\nlet lights = flow.get('lights')\n// Is this our start-up initialisation? (If so, reset config!)\nlet init = msg.init || false\nif (!lights)\n  flow.set('lights', { state: { }, ids: [], ids_csv: '' })\n\n// Merge new Payload with existing config and defaults\nlet cfg = Object.assign(\n  // Existing Config\n  init?flow.get('cfg')||{}:{},  // 'cfg.'+id\n  // Updated Config\n  msg.payload)\n\n// Make sure Light IDs are initted.\n// if (!cfg.lights) cfg.lights = []\nif (!cfg.brightness)\n  cfg.brightness = env.get('brightness') || 100\n\nif (!cfg.transitionOn && cfg.transitionOn !== 0)\n  cfg.transitionOn = env.get('transitionOn') || 2\n  \nif (!cfg.transitionOff && cfg.transitionOff !== 0)\n  cfg.transitionOff = env.get('transitionOff') || 2\n\nif (!cfg.lights && env.get('controlLights') && env.get('controlLights').length>0)\n    cfg.lights = env.get('controlLights').split(/\\s*,\\s*/)\n\nflow.set('cfg', cfg)\n\nreturn { topic: 'config', payload: cfg, lights }","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":505,"y":75,"wires":[[]]},{"id":"d1f38468.a6c768","type":"switch","z":"68862836.29c7a8","name":"motion on","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":375,"y":178,"wires":[["cf76e785.ab1978"]]},{"id":"4a9e28b2.6d3bf8","type":"function","z":"68862836.29c7a8","name":"Track Lights","func":"// Keep a record of all the light entity_ids coming in, for later switching\n\nlet lights = flow.get('lights') || { state: { }, ids: [], ids_csv: '' }\n\nlet [all, id] = msg.topic.match(/^light\\.(.*)/)\nlet update = false\n\nif (id) {\n  lights.state[id] = msg.data.new_state\n  if (!lights.ids.includes(id)) {\n    lights.ids.push(id)\n    update = true\n  }\n  lights.ids_csv = lights.ids.join(',')\n}\n\nflow.set('lights', lights)\n\nreturn {update}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":389,"y":268,"wires":[["daf678d0db2af786"]]},{"id":"4c844b6f.159114","type":"function","z":"68862836.29c7a8","name":"Light Cfg","func":"let cfg = flow.get('cfg')|| {}\nlet lights = flow.get('lights') || {}\n// Use Light IDs from Config if defined - otherwise use detected\nlet light_ids = cfg.lights || lights.ids\nlet delay = env.get('pause')*1000\n\n// Prepare config paramters for Light On. This is\n// an Array of Payload Data, one for each light\nlet payload = light_ids.map(id => { return {\n  data: {\n    brightness: Math.floor(cfg.brightness/100*255),\n    transition: cfg.transitionOn,\n    entity_id: 'light.'+id\n  }\n}})\n\nreturn {\n    topic: 'light.'+light_ids.join(','),\n    payload,\n    delay\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":525,"y":330,"wires":[["3cbac613.622432","e49dfffe0583db4e"]]},{"id":"3dda34d6.1dd5bc","type":"function","z":"68862836.29c7a8","name":"Light Cfg","func":"let cfg = flow.get('cfg')|| {}\nlet lights = flow.get('lights') || {}\n// Use Light IDs from Config if defined - otherwise use detected\nlet light_ids = cfg.lights || lights.ids\nlet delay = env.get('pause')*1000\n\n// Prepare config paramters for Light Off. This is\n// an Array of Payload Data, one for each light\nlet payload = light_ids.map(id => { return {\n  data: {\n    transition: cfg.transitionOff,\n    entity_id: 'light.'+id\n  }\n}})\n\nreturn {\n    topic: 'light.'+light_ids.join(','),\n    payload,\n    delay\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":525,"y":435,"wires":[["35ad226.a497bde","b1d245649953149b"]]},{"id":"35088d77.068da2","type":"inject","z":"68862836.29c7a8","name":"Default Configuration","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"init","v":"true","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"config","payload":"{}","payloadType":"json","x":235,"y":75,"wires":[["2a0d169a.91782a"]]},{"id":"949bf90b.fc19e8","type":"api-call-service","z":"68862836.29c7a8","name":"Turn on light","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1045,"y":285,"wires":[[]]},{"id":"a68e2b6.6b0c1d8","type":"api-call-service","z":"68862836.29c7a8","name":"Turn off light","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1045,"y":435,"wires":[[]]},{"id":"6210bc08.905bc4","type":"function","z":"68862836.29c7a8","name":"Check State","func":"// Fetch light state from our \"Track Lights\" data\n// - no need for a HA State node\n\nlet lights = flow.get('lights') || { state: { }, ids: [], ids_csv: '' }\nlet cfg = flow.get('cfg')|| {}\n\n// Return \"on\" if any one light is \"on\"\nreturn {\n    topic: 'light.'+lights.ids_csv,\n    payload: lights.ids.map(id => lights.state[id].state).includes('on') ? 'on' : 'off'\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":910,"y":525,"wires":[["801822a5.c6d75"]]},{"id":"3c89b834.84d1a8","type":"split","z":"68862836.29c7a8","name":"Each Light","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":880,"y":285,"wires":[["949bf90b.fc19e8"]]},{"id":"389eef7d.ef9a","type":"split","z":"68862836.29c7a8","name":"Each Light","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":875,"y":435,"wires":[["a68e2b6.6b0c1d8"]]},{"id":"39541c73.33d464","type":"function","z":"68862836.29c7a8","name":"motion-on","func":"// We use a function here to generate a new clean message\n\nreturn {\n    topic: 'state',\n    payload: 'motion-on'\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":885,"y":330,"wires":[["e8072572.fffa18"]]},{"id":"2368d65a.ed031a","type":"function","z":"68862836.29c7a8","name":"motion-off","func":"// We use a function here to generate a new clean message\n\nreturn {\n    topic: 'state',\n    payload: 'motion-off'\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":900,"y":615,"wires":[["801822a5.c6d75"]]},{"id":"a26b8394.bcc5c","type":"change","z":"68862836.29c7a8","name":"stop","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":480,"wires":[["b1d245649953149b"]]},{"id":"effe188b.5340f8","type":"function","z":"68862836.29c7a8","name":"status","func":"\nmsg.payload = {\n    text: msg.payload, \n    shape: msg.payload.match(/on/) ? 'ring' : 'dot',\n    fill: msg.payload == 'switch' ? 'red' : 'green'\n}\nreturn msg;","outputs":1,"noerr":0,"x":928,"y":157,"wires":[[]]},{"id":"3cbac613.622432","type":"switch","z":"68862836.29c7a8","name":"Manual?","property":"manualLight","propertyType":"env","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":705,"y":285,"wires":[[],["3c89b834.84d1a8"]]},{"id":"35ad226.a497bde","type":"switch","z":"68862836.29c7a8","name":"Manual?","property":"manualLight","propertyType":"env","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":705,"y":435,"wires":[[],["389eef7d.ef9a"]]},{"id":"e8072572.fffa18","type":"link out","z":"68862836.29c7a8","name":"living room state","links":["faa9cc31.66ec7"],"x":990,"y":330,"wires":[]},{"id":"ba8e1c42c48890af","type":"function","z":"68862836.29c7a8","name":"Reset","func":"flow.set('lights', null)\nflow.set('cfg', null)\n\nreturn msg","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":365,"y":135,"wires":[["2a0d169a.91782a"]]},{"id":"daf678d0db2af786","type":"switch","z":"68862836.29c7a8","name":"Updated?","property":"update","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":540,"y":270,"wires":[["2a0d169a.91782a"]]},{"id":"e49dfffe0583db4e","type":"trigger","z":"68862836.29c7a8","name":"pause","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":true,"units":"s","reset":"stop","bytopic":"all","topic":"topic","outputs":1,"x":695,"y":330,"wires":[["39541c73.33d464"]]},{"id":"b1d245649953149b","type":"trigger","z":"68862836.29c7a8","name":"pause","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":true,"units":"s","reset":"stop","bytopic":"all","topic":"topic","outputs":1,"x":695,"y":480,"wires":[["6210bc08.905bc4"]]},{"id":"3044ab1b0964f72a","type":"trigger","z":"68862836.29c7a8","name":"Back to Auto","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":true,"units":"s","reset":"stop","bytopic":"all","topic":"topic","outputs":1,"x":715,"y":525,"wires":[["6210bc08.905bc4"]]},{"id":"ba847a7ca44c07c3","type":"change","z":"68862836.29c7a8","name":"cooldown","rules":[{"t":"set","p":"delay","pt":"msg","to":"$env('manualCooldown')*1000","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":525,"y":525,"wires":[["3044ab1b0964f72a"]]},{"id":"7f31ef6f068e5b93","type":"change","z":"68862836.29c7a8","name":"timeOffAfter","rules":[{"t":"set","p":"delay","pt":"msg","to":"$env('timeOffAfter')*1000","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":455,"y":585,"wires":[["380a05c00a74bf5f"]]},{"id":"380a05c00a74bf5f","type":"trigger","z":"68862836.29c7a8","name":"Turn Off after motion ends","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":true,"units":"s","reset":"stop","bytopic":"all","topic":"topic","outputs":1,"x":685,"y":615,"wires":[["2368d65a.ed031a"]]},{"id":"c2ba449f446e667c","type":"tab","label":"Bedroom","disabled":false,"info":"","env":[]},{"id":"a9ed94a8c0885970","type":"group","z":"c2ba449f446e667c","name":"Bedroom Lighting - Motion Control","style":{"label":true},"nodes":["a6d4405666584127","e159fb0e6c4fdbf2","8de12ee17d89f7fb","c0bb8748fcb2cb13","19b4e894794049a7","627907943fe7ca2c","2b4aabe62a2daa1a","5886ac45d9e31869","5fff236b6952929a","e79bef5d13a253c9","3299822ae2316393","b5110810dc1aeb62","711ad1a37ac1cfe5"],"x":14,"y":19,"w":1452,"h":262},{"id":"e79bef5d13a253c9","type":"time-range-switch","z":"c2ba449f446e667c","g":"a9ed94a8c0885970","name":"10-23","lat":"","lon":"","startTime":"23:00","endTime":"10:00","startOffset":0,"endOffset":0,"x":810,"y":80,"wires":[[],[]]},{"id":"a6d4405666584127","type":"server-state-changed","z":"c2ba449f446e667c","g":"a9ed94a8c0885970","name":"Light Changed - Bedroom","server":"f43d015e.4b29","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":["light.bedroom_fairy_lights","light.bedroom_leds","light.bedroom_main_light","light.bedside_lamps"],"entityidfiltertype":"list","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":150,"y":120,"wires":[["5fff236b6952929a"]]},{"id":"e159fb0e6c4fdbf2","type":"server-state-changed","z":"c2ba449f446e667c","g":"a9ed94a8c0885970","name":"Presence - Bedroom","server":"f43d015e.4b29","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.bedroom_motion_sensor","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":130,"y":185,"wires":[["5fff236b6952929a"],[]]},{"id":"8de12ee17d89f7fb","type":"subflow:68862836.29c7a8","z":"c2ba449f446e667c","g":"a9ed94a8c0885970","name":"","env":[{"name":"timeOffAfter","value":"400","type":"num"},{"name":"brightness","value":"","type":"num"},{"name":"manualLight","value":"true","type":"bool"}],"x":560,"y":120,"wires":[["3299822ae2316393"],["5886ac45d9e31869"],[],[]]},{"id":"c0bb8748fcb2cb13","type":"subflow:68862836.29c7a8","z":"c2ba449f446e667c","g":"a9ed94a8c0885970","name":"","env":[{"name":"timeOffAfter","value":"300","type":"num"},{"name":"brightness","value":"","type":"num"},{"name":"manualLight","value":"true","type":"bool"}],"x":560,"y":200,"wires":[["a3ad11667466f55b"],["2b4aabe62a2daa1a"],[],[]]},{"id":"19b4e894794049a7","type":"api-call-service","z":"c2ba449f446e667c","g":"a9ed94a8c0885970","name":"Day Scene ON","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"scene","service":"turn_on","areaId":[],"deviceId":[],"entityId":["scene.bedroom_day"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1360,"y":60,"wires":[[]]},{"id":"627907943fe7ca2c","type":"api-call-service","z":"c2ba449f446e667c","g":"a9ed94a8c0885970","name":"Night Scene ON","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"scene","service":"turn_on","areaId":[],"deviceId":[],"entityId":["scene.bedroom_night"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1360,"y":180,"wires":[[]]},{"id":"2b4aabe62a2daa1a","type":"api-call-service","z":"c2ba449f446e667c","g":"a9ed94a8c0885970","name":"Bedroom Lights OFF","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.bedroom_fairy_lights","light.bedroom_leds","light.bedroom_main_light","light.bedside_lamps"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":840,"y":240,"wires":[[]]},{"id":"5886ac45d9e31869","type":"api-call-service","z":"c2ba449f446e667c","g":"a9ed94a8c0885970","name":"Bedroom Lights OFF","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.bedroom_fairy_lights","light.bedroom_leds","light.bedroom_main_light","light.bedside_lamps"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":840,"y":120,"wires":[[]]},{"id":"5fff236b6952929a","type":"time-range-switch","z":"c2ba449f446e667c","g":"a9ed94a8c0885970","name":"Day?","lat":"","lon":"","startTime":"08:00","endTime":"18:00","startOffset":0,"endOffset":0,"x":370,"y":160,"wires":[["8de12ee17d89f7fb"],["c0bb8748fcb2cb13"]]},{"id":"3299822ae2316393","type":"api-current-state","z":"c2ba449f446e667c","g":"a9ed94a8c0885970","name":"Leah in Bed?","server":"f43d015e.4b29","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.bed_sensor_leah","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":810,"y":60,"wires":[[],["b5110810dc1aeb62"]]},{"id":"b5110810dc1aeb62","type":"api-current-state","z":"c2ba449f446e667c","g":"a9ed94a8c0885970","name":"Sam in Bed?","server":"f43d015e.4b29","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.bed_sensor_sam","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":990,"y":60,"wires":[[],["711ad1a37ac1cfe5"]]},{"id":"711ad1a37ac1cfe5","type":"api-current-state","z":"c2ba449f446e667c","g":"a9ed94a8c0885970","name":"Both in Bed?","server":"f43d015e.4b29","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.all_sleeping","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1170,"y":60,"wires":[[],["19b4e894794049a7"]]},{"id":"a3ad11667466f55b","type":"api-current-state","z":"c2ba449f446e667c","name":"Leah in Bed?","server":"f43d015e.4b29","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.bed_sensor_leah","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":810,"y":180,"wires":[[],["9c79de8faa4f7e84"]]},{"id":"9c79de8faa4f7e84","type":"api-current-state","z":"c2ba449f446e667c","name":"Sam in Bed?","server":"f43d015e.4b29","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.bed_sensor_sam","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":990,"y":180,"wires":[[],["914e207b35930fe2"]]},{"id":"914e207b35930fe2","type":"api-current-state","z":"c2ba449f446e667c","name":"Both in Bed?","server":"f43d015e.4b29","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.all_sleeping","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1170,"y":180,"wires":[[],["627907943fe7ca2c"]]},{"id":"f43d015e.4b29","type":"server","name":"Home Assistant","version":4,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true,"cacheJson":true,"heartbeat":false,"heartbeatInterval":30,"areaSelector":"friendlyName","deviceSelector":"friendlyName","entitySelector":"friendlyName","statusSeparator":"at: ","statusYear":"hidden","statusMonth":"short","statusDay":"numeric","statusHourCycle":"h23","statusTimeFormat":"h:m"}]
</details>

&nbsp;&nbsp;_which uses:_

- [Node-RED Add-On](https://github.com/hassio-addons/addon-node-red)
- [@dortamur's Node-Red Motion Lighting Flow Template](https://github.com/dortamur/ha-node-red-flows)
- [Sleep Sensor Control](#sleep) </details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/lighting/bedroom/day.yaml">Day</a></b></summary><blockquote>
<b><i>Automation to activate bedroom day time scene.</b></i>

&nbsp;&nbsp;_which uses:_

- [scene.bedroom_day](https://github.com/smcnab1/op-question-mark/blob/master/entities/scenes/bedroom/day.yaml) </details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/lighting/bedroom/night.yaml">Night</a></b></summary><blockquote>
<b><i>Automation to activate bedroom night time scene.</b></i>

&nbsp;&nbsp;_which uses:_

- [scene.bedroom_night](https://github.com/smcnab1/op-question-mark/blob/master/entities/scenes/bedroom/night.yaml) </details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/lighting/bedroom/movie.yaml">Movie Scene</a></b></summary><blockquote>
<b><i>Automation to activate bedroom movie scene.</b></i>

&nbsp;&nbsp;_which uses:_

- [scene.bedroom_movie](https://github.com/smcnab1/op-question-mark/blob/master/entities/scenes/bedroom/movie.yaml) </details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/lighting/bedroom/movie_time.yaml">Movie Time</a></b></summary><blockquote>
<b><i>Automation automatically turn on <a name="https://github.com/smcnab1/op-question-mark/blob/master/entities/scenes/bedroom/movie.yaml">Movie Scene</a> when TV is turned on to certain apps/channels.</b></i>

&nbsp;&nbsp;_which uses:_

- [scene.bedroom_movie](https://github.com/smcnab1/op-question-mark/blob/master/entities/scenes/bedroom/movie.yaml)
- [Android TV Integration](https://www.home-assistant.io/integrations/androidtv/) </details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/lighting/bedroom/off.yaml">Off</a></b></summary><blockquote>
<b><i>Automation to turn off all bedroom lights.</b></i>
</details>

</blockquote></details>

<!-- HALL LIGHTING AUTOMATIONS -->
<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/tree/master/automations/lighting/hall">Hall üö™ Lighting</a></b></summary><blockquote>

<details><summary><b>Hall Motion Automations</b></summary><blockquote>
<b><i>Automation which works with motion and door sensors to activate and de-activate lighting. Also depends on time of day.</b></i>

![Node-Red Flow](https://i.imgur.com/JwBNkYo.png)

<details><summary>Node-Red Code</summary><blockquote>
[{"id":"68862836.29c7a8","type":"subflow","name":"Lights Motion Control","info":"","category":"home_assistant","in":[{"x":57,"y":162,"wires":[{"id":"92cf1e14.7068"}]}],"out":[{"x":470,"y":375,"wires":[{"id":"38649522.99f89a","port":0}]},{"x":560,"y":390,"wires":[{"id":"38649522.99f89a","port":1}]},{"x":650,"y":75,"wires":[{"id":"2a0d169a.91782a","port":0}]},{"x":890,"y":105,"wires":[{"id":"d5248d86.f7096","port":0}]}],"env":[{"name":"timeOffAfter","type":"num","value":"120"},{"name":"manualCooldown","type":"num","value":"30"},{"name":"brightness","type":"num","value":"100","ui":{"type":"input","opts":{"types":["num","bool","json","bin"]}}},{"name":"transitionOn","type":"num","value":"2"},{"name":"transitionOff","type":"num","value":"2"},{"name":"pause","type":"str","value":"5"},{"name":"controlLights","type":"str","value":""},{"name":"manualLight","type":"bool","value":"false"}],"meta":{},"color":"#52C0F2","icon":"font-awesome/fa-lightbulb-o","status":{"x":1027,"y":157,"wires":[{"id":"effe188b.5340f8","port":0}]}},{"id":"cf76e785.ab1978","type":"change","z":"68862836.29c7a8","name":"motion","rules":[{"t":"set","p":"payload","pt":"msg","to":"motion","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":544,"y":178,"wires":[["d5248d86.f7096"]]},{"id":"d5248d86.f7096","type":"state-machine","z":"68862836.29c7a8","name":"","triggerProperty":"payload","triggerPropertyType":"msg","stateProperty":"payload","statePropertyType":"msg","initialDelay":"","persistOnReload":true,"outputStateChangeOnly":true,"throwException":false,"states":["switch","motion-detected","motion-on","motion-off","off","on"],"transitions":[{"name":"motion","from":"off","to":"motion-detected"},{"name":"motion","from":"motion-off","to":"motion-detected"},{"name":"motion","from":"motion-on","to":"motion-on"},{"name":"off","from":"*","to":"off"},{"name":"on","from":"*","to":"on"},{"name":"switch","from":"off","to":"switch"},{"name":"switch","from":"on","to":"switch"},{"name":"switch","from":"switch","to":"switch"},{"name":"switch","from":"motion-on","to":"switch"},{"name":"motion-on","from":"motion-detected","to":"motion-on"},{"name":"motion-off","from":"motion-on","to":"motion-off"}],"x":741,"y":157,"wires":[["38649522.99f89a","effe188b.5340f8"]]},{"id":"d2742f90.7a1ce","type":"change","z":"68862836.29c7a8","name":"switch","rules":[{"t":"set","p":"payload","pt":"msg","to":"switch","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":541,"y":223,"wires":[["d5248d86.f7096"]]},{"id":"cab8f6da.31e818","type":"change","z":"68862836.29c7a8","name":"stop","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":630,"wires":[["380a05c00a74bf5f"]]},{"id":"ca0b865c.9f9898","type":"inject","z":"68862836.29c7a8","name":"Initial State","props":[{"p":"reset","v":"true","vt":"bool"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"10","topic":"","x":665,"y":570,"wires":[["6210bc08.905bc4","3044ab1b0964f72a"]]},{"id":"faa9cc31.66ec7","type":"link in","z":"68862836.29c7a8","name":"","links":["801822a5.c6d75","e8072572.fffa18"],"x":592,"y":120,"wires":[["d5248d86.f7096"]]},{"id":"801822a5.c6d75","type":"link out","z":"68862836.29c7a8","name":"living room state","links":["faa9cc31.66ec7"],"x":1020,"y":570,"wires":[]},{"id":"38649522.99f89a","type":"switch","z":"68862836.29c7a8","name":"State Action","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"motion-detected","vt":"str"},{"t":"eq","v":"motion-off","vt":"str"},{"t":"eq","v":"motion-on","vt":"str"},{"t":"eq","v":"switch","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":230,"y":465,"wires":[["4c844b6f.159114","a26b8394.bcc5c"],["3dda34d6.1dd5bc"],["7f31ef6f068e5b93"],["cab8f6da.31e818","ba847a7ca44c07c3"]]},{"id":"82902d91.d0dbf","type":"rbe","z":"68862836.29c7a8","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":369,"y":223,"wires":[["d2742f90.7a1ce"]]},{"id":"92cf1e14.7068","type":"switch","z":"68862836.29c7a8","name":"Topic Route","property":"topic","propertyType":"msg","rules":[{"t":"regex","v":"^config\\b","vt":"str","case":false},{"t":"regex","v":"^reset\\b","vt":"str","case":false},{"t":"eq","v":"light_state","vt":"str"},{"t":"cont","v":"sensor.","vt":"str"},{"t":"regex","v":"^(light|switch)\\.","vt":"str","case":false}],"checkall":"true","repair":false,"outputs":5,"x":175,"y":162,"wires":[["2a0d169a.91782a"],["ba8e1c42c48890af"],["d5248d86.f7096"],["d1f38468.a6c768"],["82902d91.d0dbf","4a9e28b2.6d3bf8"]]},{"id":"2a0d169a.91782a","type":"function","z":"68862836.29c7a8","name":"Update Configuration","func":"// Init our Lights state while we're here\nlet lights = flow.get('lights')\n// Is this our start-up initialisation? (If so, reset config!)\nlet init = msg.init || false\nif (!lights)\n  flow.set('lights', { state: { }, ids: [], ids_csv: '' })\n\n// Merge new Payload with existing config and defaults\nlet cfg = Object.assign(\n  // Existing Config\n  init?flow.get('cfg')||{}:{},  // 'cfg.'+id\n  // Updated Config\n  msg.payload)\n\n// Make sure Light IDs are initted.\n// if (!cfg.lights) cfg.lights = []\nif (!cfg.brightness)\n  cfg.brightness = env.get('brightness') || 100\n\nif (!cfg.transitionOn && cfg.transitionOn !== 0)\n  cfg.transitionOn = env.get('transitionOn') || 2\n  \nif (!cfg.transitionOff && cfg.transitionOff !== 0)\n  cfg.transitionOff = env.get('transitionOff') || 2\n\nif (!cfg.lights && env.get('controlLights') && env.get('controlLights').length>0)\n    cfg.lights = env.get('controlLights').split(/\\s*,\\s*/)\n\nflow.set('cfg', cfg)\n\nreturn { topic: 'config', payload: cfg, lights }","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":505,"y":75,"wires":[[]]},{"id":"d1f38468.a6c768","type":"switch","z":"68862836.29c7a8","name":"motion on","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":375,"y":178,"wires":[["cf76e785.ab1978"]]},{"id":"4a9e28b2.6d3bf8","type":"function","z":"68862836.29c7a8","name":"Track Lights","func":"// Keep a record of all the light entity_ids coming in, for later switching\n\nlet lights = flow.get('lights') || { state: { }, ids: [], ids_csv: '' }\n\nlet [all, id] = msg.topic.match(/^light\\.(.*)/)\nlet update = false\n\nif (id) {\n  lights.state[id] = msg.data.new_state\n  if (!lights.ids.includes(id)) {\n    lights.ids.push(id)\n    update = true\n  }\n  lights.ids_csv = lights.ids.join(',')\n}\n\nflow.set('lights', lights)\n\nreturn {update}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":389,"y":268,"wires":[["daf678d0db2af786"]]},{"id":"4c844b6f.159114","type":"function","z":"68862836.29c7a8","name":"Light Cfg","func":"let cfg = flow.get('cfg')|| {}\nlet lights = flow.get('lights') || {}\n// Use Light IDs from Config if defined - otherwise use detected\nlet light_ids = cfg.lights || lights.ids\nlet delay = env.get('pause')*1000\n\n// Prepare config paramters for Light On. This is\n// an Array of Payload Data, one for each light\nlet payload = light_ids.map(id => { return {\n  data: {\n    brightness: Math.floor(cfg.brightness/100*255),\n    transition: cfg.transitionOn,\n    entity_id: 'light.'+id\n  }\n}})\n\nreturn {\n    topic: 'light.'+light_ids.join(','),\n    payload,\n    delay\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":525,"y":330,"wires":[["3cbac613.622432","e49dfffe0583db4e"]]},{"id":"3dda34d6.1dd5bc","type":"function","z":"68862836.29c7a8","name":"Light Cfg","func":"let cfg = flow.get('cfg')|| {}\nlet lights = flow.get('lights') || {}\n// Use Light IDs from Config if defined - otherwise use detected\nlet light_ids = cfg.lights || lights.ids\nlet delay = env.get('pause')*1000\n\n// Prepare config paramters for Light Off. This is\n// an Array of Payload Data, one for each light\nlet payload = light_ids.map(id => { return {\n  data: {\n    transition: cfg.transitionOff,\n    entity_id: 'light.'+id\n  }\n}})\n\nreturn {\n    topic: 'light.'+light_ids.join(','),\n    payload,\n    delay\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":525,"y":435,"wires":[["35ad226.a497bde","b1d245649953149b"]]},{"id":"35088d77.068da2","type":"inject","z":"68862836.29c7a8","name":"Default Configuration","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"init","v":"true","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"config","payload":"{}","payloadType":"json","x":235,"y":75,"wires":[["2a0d169a.91782a"]]},{"id":"949bf90b.fc19e8","type":"api-call-service","z":"68862836.29c7a8","name":"Turn on light","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1045,"y":285,"wires":[[]]},{"id":"a68e2b6.6b0c1d8","type":"api-call-service","z":"68862836.29c7a8","name":"Turn off light","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1045,"y":435,"wires":[[]]},{"id":"6210bc08.905bc4","type":"function","z":"68862836.29c7a8","name":"Check State","func":"// Fetch light state from our \"Track Lights\" data\n// - no need for a HA State node\n\nlet lights = flow.get('lights') || { state: { }, ids: [], ids_csv: '' }\nlet cfg = flow.get('cfg')|| {}\n\n// Return \"on\" if any one light is \"on\"\nreturn {\n    topic: 'light.'+lights.ids_csv,\n    payload: lights.ids.map(id => lights.state[id].state).includes('on') ? 'on' : 'off'\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":910,"y":525,"wires":[["801822a5.c6d75"]]},{"id":"3c89b834.84d1a8","type":"split","z":"68862836.29c7a8","name":"Each Light","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":880,"y":285,"wires":[["949bf90b.fc19e8"]]},{"id":"389eef7d.ef9a","type":"split","z":"68862836.29c7a8","name":"Each Light","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":875,"y":435,"wires":[["a68e2b6.6b0c1d8"]]},{"id":"39541c73.33d464","type":"function","z":"68862836.29c7a8","name":"motion-on","func":"// We use a function here to generate a new clean message\n\nreturn {\n    topic: 'state',\n    payload: 'motion-on'\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":885,"y":330,"wires":[["e8072572.fffa18"]]},{"id":"2368d65a.ed031a","type":"function","z":"68862836.29c7a8","name":"motion-off","func":"// We use a function here to generate a new clean message\n\nreturn {\n    topic: 'state',\n    payload: 'motion-off'\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":900,"y":615,"wires":[["801822a5.c6d75"]]},{"id":"a26b8394.bcc5c","type":"change","z":"68862836.29c7a8","name":"stop","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":480,"wires":[["b1d245649953149b"]]},{"id":"effe188b.5340f8","type":"function","z":"68862836.29c7a8","name":"status","func":"\nmsg.payload = {\n    text: msg.payload, \n    shape: msg.payload.match(/on/) ? 'ring' : 'dot',\n    fill: msg.payload == 'switch' ? 'red' : 'green'\n}\nreturn msg;","outputs":1,"noerr":0,"x":928,"y":157,"wires":[[]]},{"id":"3cbac613.622432","type":"switch","z":"68862836.29c7a8","name":"Manual?","property":"manualLight","propertyType":"env","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":705,"y":285,"wires":[[],["3c89b834.84d1a8"]]},{"id":"35ad226.a497bde","type":"switch","z":"68862836.29c7a8","name":"Manual?","property":"manualLight","propertyType":"env","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":705,"y":435,"wires":[[],["389eef7d.ef9a"]]},{"id":"e8072572.fffa18","type":"link out","z":"68862836.29c7a8","name":"living room state","links":["faa9cc31.66ec7"],"x":990,"y":330,"wires":[]},{"id":"ba8e1c42c48890af","type":"function","z":"68862836.29c7a8","name":"Reset","func":"flow.set('lights', null)\nflow.set('cfg', null)\n\nreturn msg","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":365,"y":135,"wires":[["2a0d169a.91782a"]]},{"id":"daf678d0db2af786","type":"switch","z":"68862836.29c7a8","name":"Updated?","property":"update","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":540,"y":270,"wires":[["2a0d169a.91782a"]]},{"id":"e49dfffe0583db4e","type":"trigger","z":"68862836.29c7a8","name":"pause","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":true,"units":"s","reset":"stop","bytopic":"all","topic":"topic","outputs":1,"x":695,"y":330,"wires":[["39541c73.33d464"]]},{"id":"b1d245649953149b","type":"trigger","z":"68862836.29c7a8","name":"pause","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":true,"units":"s","reset":"stop","bytopic":"all","topic":"topic","outputs":1,"x":695,"y":480,"wires":[["6210bc08.905bc4"]]},{"id":"3044ab1b0964f72a","type":"trigger","z":"68862836.29c7a8","name":"Back to Auto","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":true,"units":"s","reset":"stop","bytopic":"all","topic":"topic","outputs":1,"x":715,"y":525,"wires":[["6210bc08.905bc4"]]},{"id":"ba847a7ca44c07c3","type":"change","z":"68862836.29c7a8","name":"cooldown","rules":[{"t":"set","p":"delay","pt":"msg","to":"$env('manualCooldown')*1000","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":525,"y":525,"wires":[["3044ab1b0964f72a"]]},{"id":"7f31ef6f068e5b93","type":"change","z":"68862836.29c7a8","name":"timeOffAfter","rules":[{"t":"set","p":"delay","pt":"msg","to":"$env('timeOffAfter')*1000","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":455,"y":585,"wires":[["380a05c00a74bf5f"]]},{"id":"380a05c00a74bf5f","type":"trigger","z":"68862836.29c7a8","name":"Turn Off after motion ends","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":true,"units":"s","reset":"stop","bytopic":"all","topic":"topic","outputs":1,"x":685,"y":615,"wires":[["2368d65a.ed031a"]]},{"id":"7c547859912b407f","type":"tab","label":"Hall","disabled":false,"info":"","env":[]},{"id":"d7c147689bbe4353","type":"group","z":"7c547859912b407f","name":"Hall Lighting - Motion Control","style":{"label":true},"nodes":["62efa5699f57d51f","de1df19184f06c83","68906fa59ab52bf4","a94a530f88e5f4f9","98dd8f5eb34caff1","7fbeaa9f8e7c04ee","2632c616d1300e99","245d1471ec1e228e","bad02d499148ab35"],"x":14,"y":19,"w":812,"h":262},{"id":"e47d3124ce86e5cf","type":"group","z":"7c547859912b407f","name":"Hall Lighting - Door Control","style":{"label":true},"nodes":["0d31b91fa456ef0a","34ed0ea27e507b41","1160707e1d5f6745","e067aa5a9a5ad390"],"x":14,"y":299,"w":612,"h":122},{"id":"464bc9ab39de8545","type":"group","z":"7c547859912b407f","name":"Hall Lighting - Laundry Door Control","style":{"label":true},"nodes":["d195ee04f84b7928","69ebe74c270b5bb1","ee688e398b26730a"],"x":14,"y":439,"w":432,"h":122},{"id":"62efa5699f57d51f","type":"server-state-changed","z":"7c547859912b407f","g":"d7c147689bbe4353","name":"Light Changed - Hall","server":"f43d015e.4b29","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":["light.hall_lamp","light.hall_leds"],"entityidfiltertype":"list","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":130,"y":80,"wires":[["a94a530f88e5f4f9"]]},{"id":"de1df19184f06c83","type":"server-state-changed","z":"7c547859912b407f","g":"d7c147689bbe4353","name":"Presence - Hall","server":"f43d015e.4b29","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.hall_motion_sensor","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":120,"y":145,"wires":[["a94a530f88e5f4f9"],[]]},{"id":"68906fa59ab52bf4","type":"subflow:68862836.29c7a8","z":"7c547859912b407f","g":"d7c147689bbe4353","name":"","env":[{"name":"timeOffAfter","value":"300","type":"num"},{"name":"brightness","value":"","type":"num"},{"name":"manualLight","value":"true","type":"bool"}],"x":500,"y":80,"wires":[["7fbeaa9f8e7c04ee"],["bad02d499148ab35"],[],[]]},{"id":"a94a530f88e5f4f9","type":"time-range-switch","z":"7c547859912b407f","g":"d7c147689bbe4353","name":"Day?","lat":"","lon":"","startTime":"08:00","endTime":"18:00","startOffset":0,"endOffset":0,"x":310,"y":120,"wires":[["68906fa59ab52bf4"],["98dd8f5eb34caff1"]]},{"id":"98dd8f5eb34caff1","type":"subflow:68862836.29c7a8","z":"7c547859912b407f","g":"d7c147689bbe4353","name":"","env":[{"name":"timeOffAfter","value":"300","type":"num"},{"name":"brightness","value":"","type":"num"},{"name":"manualLight","value":"true","type":"bool"}],"x":500,"y":160,"wires":[["2632c616d1300e99"],["245d1471ec1e228e"],[],[]]},{"id":"7fbeaa9f8e7c04ee","type":"api-call-service","z":"7c547859912b407f","g":"d7c147689bbe4353","name":"Day Scene ON","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"scene","service":"turn_on","areaId":[],"deviceId":[],"entityId":["scene.hall_day"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":720,"y":60,"wires":[[]]},{"id":"2632c616d1300e99","type":"api-call-service","z":"7c547859912b407f","g":"d7c147689bbe4353","name":"Night Scene ON","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"scene","service":"turn_on","areaId":[],"deviceId":[],"entityId":["scene.hall_night"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":720,"y":180,"wires":[[]]},{"id":"245d1471ec1e228e","type":"api-call-service","z":"7c547859912b407f","g":"d7c147689bbe4353","name":"Hall Lights OFF","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.hall_lamp","light.hall_leds"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":720,"y":240,"wires":[[]]},{"id":"0d31b91fa456ef0a","type":"server-state-changed","z":"7c547859912b407f","g":"e47d3124ce86e5cf","name":"Hall Door Open","server":"f43d015e.4b29","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.hall_door_sensor","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":120,"y":360,"wires":[["34ed0ea27e507b41"],["1160707e1d5f6745"]]},{"id":"34ed0ea27e507b41","type":"api-call-service","z":"7c547859912b407f","g":"e47d3124ce86e5cf","name":"Main Lights ON","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.hall_main_lights"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":320,"y":340,"wires":[["1160707e1d5f6745"]]},{"id":"1160707e1d5f6745","type":"delay","z":"7c547859912b407f","g":"e47d3124ce86e5cf","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":300,"y":380,"wires":[["e067aa5a9a5ad390"]]},{"id":"e067aa5a9a5ad390","type":"api-call-service","z":"7c547859912b407f","g":"e47d3124ce86e5cf","name":"Main Lights OFF","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.hall_main_lights"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":520,"y":360,"wires":[[]]},{"id":"d195ee04f84b7928","type":"server-state-changed","z":"7c547859912b407f","g":"464bc9ab39de8545","name":"Laundry Door Open","server":"f43d015e.4b29","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.hall_washing_room","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":130,"y":500,"wires":[["69ebe74c270b5bb1"],["ee688e398b26730a"]]},{"id":"69ebe74c270b5bb1","type":"api-call-service","z":"7c547859912b407f","g":"464bc9ab39de8545","name":"Main Light ON","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.hall_main_light_1"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":340,"y":480,"wires":[[]]},{"id":"ee688e398b26730a","type":"api-call-service","z":"7c547859912b407f","g":"464bc9ab39de8545","name":"Main Light OFF","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.hall_main_light_1"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":340,"y":520,"wires":[[]]},{"id":"bad02d499148ab35","type":"api-call-service","z":"7c547859912b407f","g":"d7c147689bbe4353","name":"Hall Lights OFF","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.hall_lamp","light.hall_leds"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":720,"y":120,"wires":[[]]},{"id":"f43d015e.4b29","type":"server","name":"Home Assistant","version":4,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true,"cacheJson":true,"heartbeat":false,"heartbeatInterval":30,"areaSelector":"friendlyName","deviceSelector":"friendlyName","entitySelector":"friendlyName","statusSeparator":"at: ","statusYear":"hidden","statusMonth":"short","statusDay":"numeric","statusHourCycle":"h23","statusTimeFormat":"h:m"}]
</details>

&nbsp;&nbsp;_which uses:_

- [Node-RED Add-On](https://github.com/hassio-addons/addon-node-red)
- [@dortamur's Node-Red Motion Lighting Flow Template](https://github.com/dortamur/ha-node-red-flows) </details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/lighting/hall/day.yaml">Day</a></b></summary><blockquote>
<b><i>Automation to activate hallway day time scene.</b></i>

&nbsp;&nbsp;_which uses:_

- [scene.hall_day](https://github.com/smcnab1/op-question-mark/blob/master/entities/scenes/hall/day.yaml) </details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/lighting/hall/night.yaml">Night</a></b></summary><blockquote>
<b><i>Automation to activate hallway night time scene.</b></i>

&nbsp;&nbsp;_which uses:_

- [scene.hall_night](https://github.com/smcnab1/op-question-mark/blob/master/entities/scenes/hall/night.yaml) </details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/lighting/hall/sleep.yaml">Sleep Scene</a></b></summary><blockquote>
<b><i>Automation to activate hallway sleeping scene when going for a pee at night.</b></i>

&nbsp;&nbsp;_which uses:_

- [scene.hall_sleep](https://github.com/smcnab1/op-question-mark/blob/master/entities/scenes/hall/sleep.yaml) </details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/lighting/hall/off.yaml">Off</a></b></summary><blockquote>
<b><i>Automation to turn off all hallway lights.</b></i>
</details>

</blockquote></details>

<!-- KITCHEN LIGHTING AUTOMATIONS -->
<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/tree/master/automations/lighting/kitchen">Kitchen üßë‚Äçüç≥ Lighting</a></b></summary><blockquote>

<details><summary><b>Kitchen Motion Automations</b></summary><blockquote>
<b><i>Automation which works with motion sensors to activate and de-activate lighting. Also depends on time of day.</b></i>

![Node-Red Flow](https://i.imgur.com/l8UDEn1.png)

<details><summary>Node-Red Code</summary><blockquote>
[{"id":"68862836.29c7a8","type":"subflow","name":"Lights Motion Control","info":"","category":"home_assistant","in":[{"x":57,"y":162,"wires":[{"id":"92cf1e14.7068"}]}],"out":[{"x":470,"y":375,"wires":[{"id":"38649522.99f89a","port":0}]},{"x":560,"y":390,"wires":[{"id":"38649522.99f89a","port":1}]},{"x":650,"y":75,"wires":[{"id":"2a0d169a.91782a","port":0}]},{"x":890,"y":105,"wires":[{"id":"d5248d86.f7096","port":0}]}],"env":[{"name":"timeOffAfter","type":"num","value":"120"},{"name":"manualCooldown","type":"num","value":"30"},{"name":"brightness","type":"num","value":"100","ui":{"type":"input","opts":{"types":["num","bool","json","bin"]}}},{"name":"transitionOn","type":"num","value":"2"},{"name":"transitionOff","type":"num","value":"2"},{"name":"pause","type":"str","value":"5"},{"name":"controlLights","type":"str","value":""},{"name":"manualLight","type":"bool","value":"false"}],"meta":{},"color":"#52C0F2","icon":"font-awesome/fa-lightbulb-o","status":{"x":1027,"y":157,"wires":[{"id":"effe188b.5340f8","port":0}]}},{"id":"cf76e785.ab1978","type":"change","z":"68862836.29c7a8","name":"motion","rules":[{"t":"set","p":"payload","pt":"msg","to":"motion","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":544,"y":178,"wires":[["d5248d86.f7096"]]},{"id":"d5248d86.f7096","type":"state-machine","z":"68862836.29c7a8","name":"","triggerProperty":"payload","triggerPropertyType":"msg","stateProperty":"payload","statePropertyType":"msg","initialDelay":"","persistOnReload":true,"outputStateChangeOnly":true,"throwException":false,"states":["switch","motion-detected","motion-on","motion-off","off","on"],"transitions":[{"name":"motion","from":"off","to":"motion-detected"},{"name":"motion","from":"motion-off","to":"motion-detected"},{"name":"motion","from":"motion-on","to":"motion-on"},{"name":"off","from":"*","to":"off"},{"name":"on","from":"*","to":"on"},{"name":"switch","from":"off","to":"switch"},{"name":"switch","from":"on","to":"switch"},{"name":"switch","from":"switch","to":"switch"},{"name":"switch","from":"motion-on","to":"switch"},{"name":"motion-on","from":"motion-detected","to":"motion-on"},{"name":"motion-off","from":"motion-on","to":"motion-off"}],"x":741,"y":157,"wires":[["38649522.99f89a","effe188b.5340f8"]]},{"id":"d2742f90.7a1ce","type":"change","z":"68862836.29c7a8","name":"switch","rules":[{"t":"set","p":"payload","pt":"msg","to":"switch","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":541,"y":223,"wires":[["d5248d86.f7096"]]},{"id":"cab8f6da.31e818","type":"change","z":"68862836.29c7a8","name":"stop","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":630,"wires":[["380a05c00a74bf5f"]]},{"id":"ca0b865c.9f9898","type":"inject","z":"68862836.29c7a8","name":"Initial State","props":[{"p":"reset","v":"true","vt":"bool"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"10","topic":"","x":665,"y":570,"wires":[["6210bc08.905bc4","3044ab1b0964f72a"]]},{"id":"faa9cc31.66ec7","type":"link in","z":"68862836.29c7a8","name":"","links":["801822a5.c6d75","e8072572.fffa18"],"x":592,"y":120,"wires":[["d5248d86.f7096"]]},{"id":"801822a5.c6d75","type":"link out","z":"68862836.29c7a8","name":"living room state","links":["faa9cc31.66ec7"],"x":1020,"y":570,"wires":[]},{"id":"38649522.99f89a","type":"switch","z":"68862836.29c7a8","name":"State Action","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"motion-detected","vt":"str"},{"t":"eq","v":"motion-off","vt":"str"},{"t":"eq","v":"motion-on","vt":"str"},{"t":"eq","v":"switch","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":230,"y":465,"wires":[["4c844b6f.159114","a26b8394.bcc5c"],["3dda34d6.1dd5bc"],["7f31ef6f068e5b93"],["cab8f6da.31e818","ba847a7ca44c07c3"]]},{"id":"82902d91.d0dbf","type":"rbe","z":"68862836.29c7a8","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":369,"y":223,"wires":[["d2742f90.7a1ce"]]},{"id":"92cf1e14.7068","type":"switch","z":"68862836.29c7a8","name":"Topic Route","property":"topic","propertyType":"msg","rules":[{"t":"regex","v":"^config\\b","vt":"str","case":false},{"t":"regex","v":"^reset\\b","vt":"str","case":false},{"t":"eq","v":"light_state","vt":"str"},{"t":"cont","v":"sensor.","vt":"str"},{"t":"regex","v":"^(light|switch)\\.","vt":"str","case":false}],"checkall":"true","repair":false,"outputs":5,"x":175,"y":162,"wires":[["2a0d169a.91782a"],["ba8e1c42c48890af"],["d5248d86.f7096"],["d1f38468.a6c768"],["82902d91.d0dbf","4a9e28b2.6d3bf8"]]},{"id":"2a0d169a.91782a","type":"function","z":"68862836.29c7a8","name":"Update Configuration","func":"// Init our Lights state while we're here\nlet lights = flow.get('lights')\n// Is this our start-up initialisation? (If so, reset config!)\nlet init = msg.init || false\nif (!lights)\n  flow.set('lights', { state: { }, ids: [], ids_csv: '' })\n\n// Merge new Payload with existing config and defaults\nlet cfg = Object.assign(\n  // Existing Config\n  init?flow.get('cfg')||{}:{},  // 'cfg.'+id\n  // Updated Config\n  msg.payload)\n\n// Make sure Light IDs are initted.\n// if (!cfg.lights) cfg.lights = []\nif (!cfg.brightness)\n  cfg.brightness = env.get('brightness') || 100\n\nif (!cfg.transitionOn && cfg.transitionOn !== 0)\n  cfg.transitionOn = env.get('transitionOn') || 2\n  \nif (!cfg.transitionOff && cfg.transitionOff !== 0)\n  cfg.transitionOff = env.get('transitionOff') || 2\n\nif (!cfg.lights && env.get('controlLights') && env.get('controlLights').length>0)\n    cfg.lights = env.get('controlLights').split(/\\s*,\\s*/)\n\nflow.set('cfg', cfg)\n\nreturn { topic: 'config', payload: cfg, lights }","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":505,"y":75,"wires":[[]]},{"id":"d1f38468.a6c768","type":"switch","z":"68862836.29c7a8","name":"motion on","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":375,"y":178,"wires":[["cf76e785.ab1978"]]},{"id":"4a9e28b2.6d3bf8","type":"function","z":"68862836.29c7a8","name":"Track Lights","func":"// Keep a record of all the light entity_ids coming in, for later switching\n\nlet lights = flow.get('lights') || { state: { }, ids: [], ids_csv: '' }\n\nlet [all, id] = msg.topic.match(/^light\\.(.*)/)\nlet update = false\n\nif (id) {\n  lights.state[id] = msg.data.new_state\n  if (!lights.ids.includes(id)) {\n    lights.ids.push(id)\n    update = true\n  }\n  lights.ids_csv = lights.ids.join(',')\n}\n\nflow.set('lights', lights)\n\nreturn {update}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":389,"y":268,"wires":[["daf678d0db2af786"]]},{"id":"4c844b6f.159114","type":"function","z":"68862836.29c7a8","name":"Light Cfg","func":"let cfg = flow.get('cfg')|| {}\nlet lights = flow.get('lights') || {}\n// Use Light IDs from Config if defined - otherwise use detected\nlet light_ids = cfg.lights || lights.ids\nlet delay = env.get('pause')*1000\n\n// Prepare config paramters for Light On. This is\n// an Array of Payload Data, one for each light\nlet payload = light_ids.map(id => { return {\n  data: {\n    brightness: Math.floor(cfg.brightness/100*255),\n    transition: cfg.transitionOn,\n    entity_id: 'light.'+id\n  }\n}})\n\nreturn {\n    topic: 'light.'+light_ids.join(','),\n    payload,\n    delay\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":525,"y":330,"wires":[["3cbac613.622432","e49dfffe0583db4e"]]},{"id":"3dda34d6.1dd5bc","type":"function","z":"68862836.29c7a8","name":"Light Cfg","func":"let cfg = flow.get('cfg')|| {}\nlet lights = flow.get('lights') || {}\n// Use Light IDs from Config if defined - otherwise use detected\nlet light_ids = cfg.lights || lights.ids\nlet delay = env.get('pause')*1000\n\n// Prepare config paramters for Light Off. This is\n// an Array of Payload Data, one for each light\nlet payload = light_ids.map(id => { return {\n  data: {\n    transition: cfg.transitionOff,\n    entity_id: 'light.'+id\n  }\n}})\n\nreturn {\n    topic: 'light.'+light_ids.join(','),\n    payload,\n    delay\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":525,"y":435,"wires":[["35ad226.a497bde","b1d245649953149b"]]},{"id":"35088d77.068da2","type":"inject","z":"68862836.29c7a8","name":"Default Configuration","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"init","v":"true","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"config","payload":"{}","payloadType":"json","x":235,"y":75,"wires":[["2a0d169a.91782a"]]},{"id":"949bf90b.fc19e8","type":"api-call-service","z":"68862836.29c7a8","name":"Turn on light","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1045,"y":285,"wires":[[]]},{"id":"a68e2b6.6b0c1d8","type":"api-call-service","z":"68862836.29c7a8","name":"Turn off light","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1045,"y":435,"wires":[[]]},{"id":"6210bc08.905bc4","type":"function","z":"68862836.29c7a8","name":"Check State","func":"// Fetch light state from our \"Track Lights\" data\n// - no need for a HA State node\n\nlet lights = flow.get('lights') || { state: { }, ids: [], ids_csv: '' }\nlet cfg = flow.get('cfg')|| {}\n\n// Return \"on\" if any one light is \"on\"\nreturn {\n    topic: 'light.'+lights.ids_csv,\n    payload: lights.ids.map(id => lights.state[id].state).includes('on') ? 'on' : 'off'\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":910,"y":525,"wires":[["801822a5.c6d75"]]},{"id":"3c89b834.84d1a8","type":"split","z":"68862836.29c7a8","name":"Each Light","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":880,"y":285,"wires":[["949bf90b.fc19e8"]]},{"id":"389eef7d.ef9a","type":"split","z":"68862836.29c7a8","name":"Each Light","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":875,"y":435,"wires":[["a68e2b6.6b0c1d8"]]},{"id":"39541c73.33d464","type":"function","z":"68862836.29c7a8","name":"motion-on","func":"// We use a function here to generate a new clean message\n\nreturn {\n    topic: 'state',\n    payload: 'motion-on'\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":885,"y":330,"wires":[["e8072572.fffa18"]]},{"id":"2368d65a.ed031a","type":"function","z":"68862836.29c7a8","name":"motion-off","func":"// We use a function here to generate a new clean message\n\nreturn {\n    topic: 'state',\n    payload: 'motion-off'\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":900,"y":615,"wires":[["801822a5.c6d75"]]},{"id":"a26b8394.bcc5c","type":"change","z":"68862836.29c7a8","name":"stop","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":480,"wires":[["b1d245649953149b"]]},{"id":"effe188b.5340f8","type":"function","z":"68862836.29c7a8","name":"status","func":"\nmsg.payload = {\n    text: msg.payload, \n    shape: msg.payload.match(/on/) ? 'ring' : 'dot',\n    fill: msg.payload == 'switch' ? 'red' : 'green'\n}\nreturn msg;","outputs":1,"noerr":0,"x":928,"y":157,"wires":[[]]},{"id":"3cbac613.622432","type":"switch","z":"68862836.29c7a8","name":"Manual?","property":"manualLight","propertyType":"env","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":705,"y":285,"wires":[[],["3c89b834.84d1a8"]]},{"id":"35ad226.a497bde","type":"switch","z":"68862836.29c7a8","name":"Manual?","property":"manualLight","propertyType":"env","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":705,"y":435,"wires":[[],["389eef7d.ef9a"]]},{"id":"e8072572.fffa18","type":"link out","z":"68862836.29c7a8","name":"living room state","links":["faa9cc31.66ec7"],"x":990,"y":330,"wires":[]},{"id":"ba8e1c42c48890af","type":"function","z":"68862836.29c7a8","name":"Reset","func":"flow.set('lights', null)\nflow.set('cfg', null)\n\nreturn msg","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":365,"y":135,"wires":[["2a0d169a.91782a"]]},{"id":"daf678d0db2af786","type":"switch","z":"68862836.29c7a8","name":"Updated?","property":"update","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":540,"y":270,"wires":[["2a0d169a.91782a"]]},{"id":"e49dfffe0583db4e","type":"trigger","z":"68862836.29c7a8","name":"pause","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":true,"units":"s","reset":"stop","bytopic":"all","topic":"topic","outputs":1,"x":695,"y":330,"wires":[["39541c73.33d464"]]},{"id":"b1d245649953149b","type":"trigger","z":"68862836.29c7a8","name":"pause","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":true,"units":"s","reset":"stop","bytopic":"all","topic":"topic","outputs":1,"x":695,"y":480,"wires":[["6210bc08.905bc4"]]},{"id":"3044ab1b0964f72a","type":"trigger","z":"68862836.29c7a8","name":"Back to Auto","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":true,"units":"s","reset":"stop","bytopic":"all","topic":"topic","outputs":1,"x":715,"y":525,"wires":[["6210bc08.905bc4"]]},{"id":"ba847a7ca44c07c3","type":"change","z":"68862836.29c7a8","name":"cooldown","rules":[{"t":"set","p":"delay","pt":"msg","to":"$env('manualCooldown')*1000","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":525,"y":525,"wires":[["3044ab1b0964f72a"]]},{"id":"7f31ef6f068e5b93","type":"change","z":"68862836.29c7a8","name":"timeOffAfter","rules":[{"t":"set","p":"delay","pt":"msg","to":"$env('timeOffAfter')*1000","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":455,"y":585,"wires":[["380a05c00a74bf5f"]]},{"id":"380a05c00a74bf5f","type":"trigger","z":"68862836.29c7a8","name":"Turn Off after motion ends","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":true,"units":"s","reset":"stop","bytopic":"all","topic":"topic","outputs":1,"x":685,"y":615,"wires":[["2368d65a.ed031a"]]},{"id":"5925a2ee8761878a","type":"tab","label":"Kitchen","disabled":false,"info":"","env":[]},{"id":"41246c4ab2371aa1","type":"group","z":"5925a2ee8761878a","name":"Kitchen Lighting - Motion Control","style":{"label":true},"nodes":["ba71cc4f57d4c89a","4ed1fdd622c3a862","c27661af82753469","cfc85bb2b3337b65","7fe6c7fcb9b882ff","81c4cb157bb5d74e","d01a6faf42988334","2d71b56498fa6fac","eb02612872271538"],"x":14,"y":19,"w":872,"h":262},{"id":"ba71cc4f57d4c89a","type":"server-state-changed","z":"5925a2ee8761878a","g":"41246c4ab2371aa1","name":"Light Changed - Kitchen","server":"f43d015e.4b29","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":["light.kitchen_leds","light.kitchen_main_lights"],"entityidfiltertype":"list","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":150,"y":100,"wires":[["eb02612872271538"]]},{"id":"4ed1fdd622c3a862","type":"server-state-changed","z":"5925a2ee8761878a","g":"41246c4ab2371aa1","name":"Presence - Kitchen","server":"f43d015e.4b29","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.kitchen_motion_sensor","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":130,"y":165,"wires":[["eb02612872271538"],[]]},{"id":"c27661af82753469","type":"subflow:68862836.29c7a8","z":"5925a2ee8761878a","g":"41246c4ab2371aa1","name":"","env":[{"name":"timeOffAfter","value":"400","type":"num"},{"name":"brightness","value":"","type":"num"},{"name":"manualLight","value":"true","type":"bool"}],"x":540,"y":100,"wires":[["7fe6c7fcb9b882ff"],["2d71b56498fa6fac"],[],[]]},{"id":"cfc85bb2b3337b65","type":"subflow:68862836.29c7a8","z":"5925a2ee8761878a","g":"41246c4ab2371aa1","name":"","env":[{"name":"timeOffAfter","value":"300","type":"num"},{"name":"brightness","value":"","type":"num"},{"name":"manualLight","value":"true","type":"bool"}],"x":540,"y":180,"wires":[["81c4cb157bb5d74e"],["d01a6faf42988334"],[],[]]},{"id":"7fe6c7fcb9b882ff","type":"api-call-service","z":"5925a2ee8761878a","g":"41246c4ab2371aa1","name":"Day Scene ON","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"scene","service":"turn_on","areaId":[],"deviceId":[],"entityId":["scene.kitchen_cooking"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":760,"y":60,"wires":[[]]},{"id":"81c4cb157bb5d74e","type":"api-call-service","z":"5925a2ee8761878a","g":"41246c4ab2371aa1","name":"Night Scene ON","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"scene","service":"turn_on","areaId":[],"deviceId":[],"entityId":["scene.kitchen_normal"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":760,"y":180,"wires":[[]]},{"id":"d01a6faf42988334","type":"api-call-service","z":"5925a2ee8761878a","g":"41246c4ab2371aa1","name":"Kitchen Lights OFF","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.kitchen_leds"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":770,"y":240,"wires":[[]]},{"id":"2d71b56498fa6fac","type":"api-call-service","z":"5925a2ee8761878a","g":"41246c4ab2371aa1","name":"Kitchen Lights OFF","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.kitchen_leds","light.kitchen_main_lights"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":770,"y":120,"wires":[[]]},{"id":"eb02612872271538","type":"time-range-switch","z":"5925a2ee8761878a","g":"41246c4ab2371aa1","name":"Day?","lat":"","lon":"","startTime":"12:30","endTime":"20:00","startOffset":0,"endOffset":0,"x":350,"y":140,"wires":[["c27661af82753469"],["cfc85bb2b3337b65"]]},{"id":"f43d015e.4b29","type":"server","name":"Home Assistant","version":4,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true,"cacheJson":true,"heartbeat":false,"heartbeatInterval":30,"areaSelector":"friendlyName","deviceSelector":"friendlyName","entitySelector":"friendlyName","statusSeparator":"at: ","statusYear":"hidden","statusMonth":"short","statusDay":"numeric","statusHourCycle":"h23","statusTimeFormat":"h:m"}]
</details>

&nbsp;&nbsp;_which uses:_

- [Node-RED Add-On](https://github.com/hassio-addons/addon-node-red)
- [@dortamur's Node-Red Motion Lighting Flow Template](https://github.com/dortamur/ha-node-red-flows) </details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/lighting/kitchen/cooking.yaml">Cooking</a></b></summary><blockquote>
<b><i>Automation to activate kitchen cooking scene during certain times.</b></i>

&nbsp;&nbsp;_which uses:_

- [scene.kitchen_cooking](https://github.com/smcnab1/op-question-mark/blob/master/entities/scenes/kitchen/cooking.yaml) </details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/lighting/kitchen/normal.yaml">Normal</a></b></summary><blockquote>
<b><i>Automation to activate normal kitchen scene.</b></i>

&nbsp;&nbsp;_which uses:_

- [scene.kitchen_normal](https://github.com/smcnab1/op-question-mark/blob/master/entities/scenes/kitchen/normal.yaml) </details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/lighting/kitchen/off.yaml">Off</a></b></summary><blockquote>
<b><i>Automation to turn off all kitchen lights.</b></i>
</details>

</blockquote></details>

<!-- LIVING ROOM LIGHTING AUTOMATIONS -->
<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/tree/master/automations/lighting/living_room">Living Room üõãÔ∏è Lighting</a></b></summary><blockquote>

<details><summary><b>Living Room Motion Automations</b></summary><blockquote>
<b><i>Automation which works with motion sensors to activate and de-activate lighting. Also depends on time of day.</b></i>

![Node-Red Flow](https://i.imgur.com/N2MnvfY.png)

<details><summary>Node-Red Code</summary><blockquote>
[{"id":"68862836.29c7a8","type":"subflow","name":"Lights Motion Control","info":"","category":"home_assistant","in":[{"x":57,"y":162,"wires":[{"id":"92cf1e14.7068"}]}],"out":[{"x":470,"y":375,"wires":[{"id":"38649522.99f89a","port":0}]},{"x":560,"y":390,"wires":[{"id":"38649522.99f89a","port":1}]},{"x":650,"y":75,"wires":[{"id":"2a0d169a.91782a","port":0}]},{"x":890,"y":105,"wires":[{"id":"d5248d86.f7096","port":0}]}],"env":[{"name":"timeOffAfter","type":"num","value":"120"},{"name":"manualCooldown","type":"num","value":"30"},{"name":"brightness","type":"num","value":"100","ui":{"type":"input","opts":{"types":["num","bool","json","bin"]}}},{"name":"transitionOn","type":"num","value":"2"},{"name":"transitionOff","type":"num","value":"2"},{"name":"pause","type":"str","value":"5"},{"name":"controlLights","type":"str","value":""},{"name":"manualLight","type":"bool","value":"false"}],"meta":{},"color":"#52C0F2","icon":"font-awesome/fa-lightbulb-o","status":{"x":1027,"y":157,"wires":[{"id":"effe188b.5340f8","port":0}]}},{"id":"cf76e785.ab1978","type":"change","z":"68862836.29c7a8","name":"motion","rules":[{"t":"set","p":"payload","pt":"msg","to":"motion","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":544,"y":178,"wires":[["d5248d86.f7096"]]},{"id":"d5248d86.f7096","type":"state-machine","z":"68862836.29c7a8","name":"","triggerProperty":"payload","triggerPropertyType":"msg","stateProperty":"payload","statePropertyType":"msg","initialDelay":"","persistOnReload":true,"outputStateChangeOnly":true,"throwException":false,"states":["switch","motion-detected","motion-on","motion-off","off","on"],"transitions":[{"name":"motion","from":"off","to":"motion-detected"},{"name":"motion","from":"motion-off","to":"motion-detected"},{"name":"motion","from":"motion-on","to":"motion-on"},{"name":"off","from":"*","to":"off"},{"name":"on","from":"*","to":"on"},{"name":"switch","from":"off","to":"switch"},{"name":"switch","from":"on","to":"switch"},{"name":"switch","from":"switch","to":"switch"},{"name":"switch","from":"motion-on","to":"switch"},{"name":"motion-on","from":"motion-detected","to":"motion-on"},{"name":"motion-off","from":"motion-on","to":"motion-off"}],"x":741,"y":157,"wires":[["38649522.99f89a","effe188b.5340f8"]]},{"id":"d2742f90.7a1ce","type":"change","z":"68862836.29c7a8","name":"switch","rules":[{"t":"set","p":"payload","pt":"msg","to":"switch","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":541,"y":223,"wires":[["d5248d86.f7096"]]},{"id":"cab8f6da.31e818","type":"change","z":"68862836.29c7a8","name":"stop","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":630,"wires":[["380a05c00a74bf5f"]]},{"id":"ca0b865c.9f9898","type":"inject","z":"68862836.29c7a8","name":"Initial State","props":[{"p":"reset","v":"true","vt":"bool"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"10","topic":"","x":665,"y":570,"wires":[["6210bc08.905bc4","3044ab1b0964f72a"]]},{"id":"faa9cc31.66ec7","type":"link in","z":"68862836.29c7a8","name":"","links":["801822a5.c6d75","e8072572.fffa18"],"x":592,"y":120,"wires":[["d5248d86.f7096"]]},{"id":"801822a5.c6d75","type":"link out","z":"68862836.29c7a8","name":"living room state","links":["faa9cc31.66ec7"],"x":1020,"y":570,"wires":[]},{"id":"38649522.99f89a","type":"switch","z":"68862836.29c7a8","name":"State Action","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"motion-detected","vt":"str"},{"t":"eq","v":"motion-off","vt":"str"},{"t":"eq","v":"motion-on","vt":"str"},{"t":"eq","v":"switch","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":230,"y":465,"wires":[["4c844b6f.159114","a26b8394.bcc5c"],["3dda34d6.1dd5bc"],["7f31ef6f068e5b93"],["cab8f6da.31e818","ba847a7ca44c07c3"]]},{"id":"82902d91.d0dbf","type":"rbe","z":"68862836.29c7a8","name":"","func":"rbe","gap":"","start":"","inout":"out","property":"payload","x":369,"y":223,"wires":[["d2742f90.7a1ce"]]},{"id":"92cf1e14.7068","type":"switch","z":"68862836.29c7a8","name":"Topic Route","property":"topic","propertyType":"msg","rules":[{"t":"regex","v":"^config\\b","vt":"str","case":false},{"t":"regex","v":"^reset\\b","vt":"str","case":false},{"t":"eq","v":"light_state","vt":"str"},{"t":"cont","v":"sensor.","vt":"str"},{"t":"regex","v":"^(light|switch)\\.","vt":"str","case":false}],"checkall":"true","repair":false,"outputs":5,"x":175,"y":162,"wires":[["2a0d169a.91782a"],["ba8e1c42c48890af"],["d5248d86.f7096"],["d1f38468.a6c768"],["82902d91.d0dbf","4a9e28b2.6d3bf8"]]},{"id":"2a0d169a.91782a","type":"function","z":"68862836.29c7a8","name":"Update Configuration","func":"// Init our Lights state while we're here\nlet lights = flow.get('lights')\n// Is this our start-up initialisation? (If so, reset config!)\nlet init = msg.init || false\nif (!lights)\n  flow.set('lights', { state: { }, ids: [], ids_csv: '' })\n\n// Merge new Payload with existing config and defaults\nlet cfg = Object.assign(\n  // Existing Config\n  init?flow.get('cfg')||{}:{},  // 'cfg.'+id\n  // Updated Config\n  msg.payload)\n\n// Make sure Light IDs are initted.\n// if (!cfg.lights) cfg.lights = []\nif (!cfg.brightness)\n  cfg.brightness = env.get('brightness') || 100\n\nif (!cfg.transitionOn && cfg.transitionOn !== 0)\n  cfg.transitionOn = env.get('transitionOn') || 2\n  \nif (!cfg.transitionOff && cfg.transitionOff !== 0)\n  cfg.transitionOff = env.get('transitionOff') || 2\n\nif (!cfg.lights && env.get('controlLights') && env.get('controlLights').length>0)\n    cfg.lights = env.get('controlLights').split(/\\s*,\\s*/)\n\nflow.set('cfg', cfg)\n\nreturn { topic: 'config', payload: cfg, lights }","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":505,"y":75,"wires":[[]]},{"id":"d1f38468.a6c768","type":"switch","z":"68862836.29c7a8","name":"motion on","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":375,"y":178,"wires":[["cf76e785.ab1978"]]},{"id":"4a9e28b2.6d3bf8","type":"function","z":"68862836.29c7a8","name":"Track Lights","func":"// Keep a record of all the light entity_ids coming in, for later switching\n\nlet lights = flow.get('lights') || { state: { }, ids: [], ids_csv: '' }\n\nlet [all, id] = msg.topic.match(/^light\\.(.*)/)\nlet update = false\n\nif (id) {\n  lights.state[id] = msg.data.new_state\n  if (!lights.ids.includes(id)) {\n    lights.ids.push(id)\n    update = true\n  }\n  lights.ids_csv = lights.ids.join(',')\n}\n\nflow.set('lights', lights)\n\nreturn {update}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":389,"y":268,"wires":[["daf678d0db2af786"]]},{"id":"4c844b6f.159114","type":"function","z":"68862836.29c7a8","name":"Light Cfg","func":"let cfg = flow.get('cfg')|| {}\nlet lights = flow.get('lights') || {}\n// Use Light IDs from Config if defined - otherwise use detected\nlet light_ids = cfg.lights || lights.ids\nlet delay = env.get('pause')*1000\n\n// Prepare config paramters for Light On. This is\n// an Array of Payload Data, one for each light\nlet payload = light_ids.map(id => { return {\n  data: {\n    brightness: Math.floor(cfg.brightness/100*255),\n    transition: cfg.transitionOn,\n    entity_id: 'light.'+id\n  }\n}})\n\nreturn {\n    topic: 'light.'+light_ids.join(','),\n    payload,\n    delay\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":525,"y":330,"wires":[["3cbac613.622432","e49dfffe0583db4e"]]},{"id":"3dda34d6.1dd5bc","type":"function","z":"68862836.29c7a8","name":"Light Cfg","func":"let cfg = flow.get('cfg')|| {}\nlet lights = flow.get('lights') || {}\n// Use Light IDs from Config if defined - otherwise use detected\nlet light_ids = cfg.lights || lights.ids\nlet delay = env.get('pause')*1000\n\n// Prepare config paramters for Light Off. This is\n// an Array of Payload Data, one for each light\nlet payload = light_ids.map(id => { return {\n  data: {\n    transition: cfg.transitionOff,\n    entity_id: 'light.'+id\n  }\n}})\n\nreturn {\n    topic: 'light.'+light_ids.join(','),\n    payload,\n    delay\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":525,"y":435,"wires":[["35ad226.a497bde","b1d245649953149b"]]},{"id":"35088d77.068da2","type":"inject","z":"68862836.29c7a8","name":"Default Configuration","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"init","v":"true","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"config","payload":"{}","payloadType":"json","x":235,"y":75,"wires":[["2a0d169a.91782a"]]},{"id":"949bf90b.fc19e8","type":"api-call-service","z":"68862836.29c7a8","name":"Turn on light","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1045,"y":285,"wires":[[]]},{"id":"a68e2b6.6b0c1d8","type":"api-call-service","z":"68862836.29c7a8","name":"Turn off light","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1045,"y":435,"wires":[[]]},{"id":"6210bc08.905bc4","type":"function","z":"68862836.29c7a8","name":"Check State","func":"// Fetch light state from our \"Track Lights\" data\n// - no need for a HA State node\n\nlet lights = flow.get('lights') || { state: { }, ids: [], ids_csv: '' }\nlet cfg = flow.get('cfg')|| {}\n\n// Return \"on\" if any one light is \"on\"\nreturn {\n    topic: 'light.'+lights.ids_csv,\n    payload: lights.ids.map(id => lights.state[id].state).includes('on') ? 'on' : 'off'\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":910,"y":525,"wires":[["801822a5.c6d75"]]},{"id":"3c89b834.84d1a8","type":"split","z":"68862836.29c7a8","name":"Each Light","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":880,"y":285,"wires":[["949bf90b.fc19e8"]]},{"id":"389eef7d.ef9a","type":"split","z":"68862836.29c7a8","name":"Each Light","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":875,"y":435,"wires":[["a68e2b6.6b0c1d8"]]},{"id":"39541c73.33d464","type":"function","z":"68862836.29c7a8","name":"motion-on","func":"// We use a function here to generate a new clean message\n\nreturn {\n    topic: 'state',\n    payload: 'motion-on'\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":885,"y":330,"wires":[["e8072572.fffa18"]]},{"id":"2368d65a.ed031a","type":"function","z":"68862836.29c7a8","name":"motion-off","func":"// We use a function here to generate a new clean message\n\nreturn {\n    topic: 'state',\n    payload: 'motion-off'\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":900,"y":615,"wires":[["801822a5.c6d75"]]},{"id":"a26b8394.bcc5c","type":"change","z":"68862836.29c7a8","name":"stop","rules":[{"t":"set","p":"reset","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":480,"wires":[["b1d245649953149b"]]},{"id":"effe188b.5340f8","type":"function","z":"68862836.29c7a8","name":"status","func":"\nmsg.payload = {\n    text: msg.payload, \n    shape: msg.payload.match(/on/) ? 'ring' : 'dot',\n    fill: msg.payload == 'switch' ? 'red' : 'green'\n}\nreturn msg;","outputs":1,"noerr":0,"x":928,"y":157,"wires":[[]]},{"id":"3cbac613.622432","type":"switch","z":"68862836.29c7a8","name":"Manual?","property":"manualLight","propertyType":"env","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":705,"y":285,"wires":[[],["3c89b834.84d1a8"]]},{"id":"35ad226.a497bde","type":"switch","z":"68862836.29c7a8","name":"Manual?","property":"manualLight","propertyType":"env","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":705,"y":435,"wires":[[],["389eef7d.ef9a"]]},{"id":"e8072572.fffa18","type":"link out","z":"68862836.29c7a8","name":"living room state","links":["faa9cc31.66ec7"],"x":990,"y":330,"wires":[]},{"id":"ba8e1c42c48890af","type":"function","z":"68862836.29c7a8","name":"Reset","func":"flow.set('lights', null)\nflow.set('cfg', null)\n\nreturn msg","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":365,"y":135,"wires":[["2a0d169a.91782a"]]},{"id":"daf678d0db2af786","type":"switch","z":"68862836.29c7a8","name":"Updated?","property":"update","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":540,"y":270,"wires":[["2a0d169a.91782a"]]},{"id":"e49dfffe0583db4e","type":"trigger","z":"68862836.29c7a8","name":"pause","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":true,"units":"s","reset":"stop","bytopic":"all","topic":"topic","outputs":1,"x":695,"y":330,"wires":[["39541c73.33d464"]]},{"id":"b1d245649953149b","type":"trigger","z":"68862836.29c7a8","name":"pause","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":true,"units":"s","reset":"stop","bytopic":"all","topic":"topic","outputs":1,"x":695,"y":480,"wires":[["6210bc08.905bc4"]]},{"id":"3044ab1b0964f72a","type":"trigger","z":"68862836.29c7a8","name":"Back to Auto","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":true,"units":"s","reset":"stop","bytopic":"all","topic":"topic","outputs":1,"x":715,"y":525,"wires":[["6210bc08.905bc4"]]},{"id":"ba847a7ca44c07c3","type":"change","z":"68862836.29c7a8","name":"cooldown","rules":[{"t":"set","p":"delay","pt":"msg","to":"$env('manualCooldown')*1000","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":525,"y":525,"wires":[["3044ab1b0964f72a"]]},{"id":"7f31ef6f068e5b93","type":"change","z":"68862836.29c7a8","name":"timeOffAfter","rules":[{"t":"set","p":"delay","pt":"msg","to":"$env('timeOffAfter')*1000","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":455,"y":585,"wires":[["380a05c00a74bf5f"]]},{"id":"380a05c00a74bf5f","type":"trigger","z":"68862836.29c7a8","name":"Turn Off after motion ends","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"5","extend":true,"overrideDelay":true,"units":"s","reset":"stop","bytopic":"all","topic":"topic","outputs":1,"x":685,"y":615,"wires":[["2368d65a.ed031a"]]},{"id":"e0c421ee2f5c3583","type":"tab","label":"Living Room","disabled":false,"info":"","env":[]},{"id":"fc60c2e22cb6a5b6","type":"group","z":"e0c421ee2f5c3583","name":"Living Room Lighting - Motion Control","style":{"label":true},"nodes":["56f6cba8f2b189a6","2161bd8d13751ab1","d290edb76b1f1a1a","e06050b0c1337d0b","c889feed3908ab39","97faaeaadfd9af3a","9475c3a27378fec3","0e6422737040fceb","eef825106d7c68a6","59bbe0214ace61b2","ebbe0fdf06af722c","807e512198d41211","a9b8d1f6c0bf776b"],"x":14,"y":19,"w":1112,"h":262},{"id":"56f6cba8f2b189a6","type":"server-state-changed","z":"e0c421ee2f5c3583","g":"fc60c2e22cb6a5b6","name":"Light Changed - Living Room","server":"f43d015e.4b29","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":["light.living_room_display_led","light.living_room_dreamview","light.living_room_lamp","light.living_room_lava_lamp","light.living_room_leds","light.living_room_main_light","light.living_room_tv_leds"],"entityidfiltertype":"list","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":160,"y":100,"wires":[["0e6422737040fceb"]]},{"id":"2161bd8d13751ab1","type":"server-state-changed","z":"e0c421ee2f5c3583","g":"fc60c2e22cb6a5b6","name":"Presence - Living Room","server":"f43d015e.4b29","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.living_room_motion","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":140,"y":165,"wires":[["0e6422737040fceb"],[]]},{"id":"d290edb76b1f1a1a","type":"subflow:68862836.29c7a8","z":"e0c421ee2f5c3583","g":"fc60c2e22cb6a5b6","name":"","env":[{"name":"timeOffAfter","value":"400","type":"num"},{"name":"brightness","value":"","type":"num"},{"name":"manualLight","value":"true","type":"bool"}],"x":580,"y":100,"wires":[["ebbe0fdf06af722c"],["807e512198d41211"],[],[]]},{"id":"e06050b0c1337d0b","type":"api-call-service","z":"e0c421ee2f5c3583","g":"fc60c2e22cb6a5b6","name":"Day Scene ON","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"scene","service":"turn_on","areaId":[],"deviceId":[],"entityId":["scene.living_room_day"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":960,"y":60,"wires":[["76a8af99da83469f"]]},{"id":"c889feed3908ab39","type":"api-call-service","z":"e0c421ee2f5c3583","g":"fc60c2e22cb6a5b6","name":"Night Scene ON","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"scene","service":"turn_on","areaId":[],"deviceId":[],"entityId":["scene.living_room_night"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":960,"y":180,"wires":[["76a8af99da83469f"]]},{"id":"97faaeaadfd9af3a","type":"api-call-service","z":"e0c421ee2f5c3583","g":"fc60c2e22cb6a5b6","name":"Living Room Lights OFF","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.living_room_display_led","light.living_room_lava_lamp","light.living_room_leds","light.living_room_main_light","light.living_room_tv_leds"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":990,"y":240,"wires":[["76a8af99da83469f"]]},{"id":"9475c3a27378fec3","type":"api-call-service","z":"e0c421ee2f5c3583","g":"fc60c2e22cb6a5b6","name":"Living Room Lights OFF","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.living_room_display_led","light.living_room_leds","light.living_room_main_light","light.living_room_tv_leds"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":990,"y":120,"wires":[["76a8af99da83469f"]]},{"id":"0e6422737040fceb","type":"time-range-switch","z":"e0c421ee2f5c3583","g":"fc60c2e22cb6a5b6","name":"Day?","lat":"","lon":"","startTime":"09:00","endTime":"18:00","startOffset":0,"endOffset":0,"x":370,"y":140,"wires":[["d290edb76b1f1a1a"],["a9b8d1f6c0bf776b"]]},{"id":"eef825106d7c68a6","type":"api-current-state","z":"e0c421ee2f5c3583","g":"fc60c2e22cb6a5b6","name":"TV On?","server":"f43d015e.4b29","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.living_room_tv","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":780,"y":240,"wires":[[],["97faaeaadfd9af3a"]]},{"id":"59bbe0214ace61b2","type":"api-current-state","z":"e0c421ee2f5c3583","g":"fc60c2e22cb6a5b6","name":"TV On?","server":"f43d015e.4b29","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.living_room_tv","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":780,"y":180,"wires":[[],["c889feed3908ab39"]]},{"id":"ebbe0fdf06af722c","type":"api-current-state","z":"e0c421ee2f5c3583","g":"fc60c2e22cb6a5b6","name":"TV On?","server":"f43d015e.4b29","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.living_room_tv","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":780,"y":60,"wires":[[],["e06050b0c1337d0b"]]},{"id":"807e512198d41211","type":"api-current-state","z":"e0c421ee2f5c3583","g":"fc60c2e22cb6a5b6","name":"TV On?","server":"f43d015e.4b29","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.living_room_tv","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":780,"y":120,"wires":[[],["9475c3a27378fec3"]]},{"id":"a9b8d1f6c0bf776b","type":"subflow:68862836.29c7a8","z":"e0c421ee2f5c3583","g":"fc60c2e22cb6a5b6","name":"","env":[{"name":"timeOffAfter","value":"400","type":"num"},{"name":"brightness","value":"","type":"num"},{"name":"manualLight","value":"true","type":"bool"}],"x":580,"y":180,"wires":[["59bbe0214ace61b2"],["eef825106d7c68a6"],[],[]]},{"id":"76a8af99da83469f","type":"debug","z":"e0c421ee2f5c3583","name":"debug 2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1300,"y":140,"wires":[]},{"id":"f43d015e.4b29","type":"server","name":"Home Assistant","version":4,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true,"cacheJson":true,"heartbeat":false,"heartbeatInterval":30,"areaSelector":"friendlyName","deviceSelector":"friendlyName","entitySelector":"friendlyName","statusSeparator":"at: ","statusYear":"hidden","statusMonth":"short","statusDay":"numeric","statusHourCycle":"h23","statusTimeFormat":"h:m"}]

</details>

&nbsp;&nbsp;_which uses:_

- [Node-RED Add-On](https://github.com/hassio-addons/addon-node-red)
- [@dortamur's Node-Red Motion Lighting Flow Template](https://github.com/dortamur/ha-node-red-flows) </details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/lighting/living_room/day.yaml">Day</a></b></summary><blockquote>
<b><i>Automation to activate living room day time scene.</b></i>

&nbsp;&nbsp;_which uses:_

- [scene.living_room_day](https://github.com/smcnab1/op-question-mark/blob/master/entities/scenes/living_room/day.yaml) </details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/lighting/living_room/night.yaml">Night</a></b></summary><blockquote>
<b><i>Automation to activate living room night time scene.</b></i>

&nbsp;&nbsp;_which uses:_

- [scene.living_room_night](https://github.com/smcnab1/op-question-mark/blob/master/entities/scenes/living_room/night.yaml) </details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/lighting/living_room/movie.yaml">Movie</a></b></summary><blockquote>
<b><i>Automation to activate living room movie scene.</b></i>

&nbsp;&nbsp;_which uses:_

- [scene.living_room_movie](https://github.com/smcnab1/op-question-mark/blob/master/entities/scenes/living_room/movie.yaml) </details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/lighting/living_room/movie_time.yaml">Movie Time</a></b></summary><blockquote>
<b><i>Automation automatically turn on <a name="https://github.com/smcnab1/op-question-mark/blob/master/entities/scenes/living_room/movie.yaml">Movie Scene</a> when TV is turned on to certain apps/channels.</b></i>

&nbsp;&nbsp;_which uses:_

- [scene.living_room_movie](https://github.com/smcnab1/op-question-mark/blob/master/entities/scenes/living_room/movie.yaml)
- [Samsung SmartTV Integration](https://github.com/ollo69/ha-samsungtv-smart) </details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/lighting/living_room/off.yaml">Off</a></b></summary><blockquote>
<b><i>Automation to turn off all living room lights.</b></i>
 </details>

</blockquote></details>

<!-- OFFICE LIGHTING AUTOMATIONS -->
<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/tree/master/automations/lighting/office">Office üñ•Ô∏è Lighting</a></b></summary><blockquote>

<details><summary><b>Office Motion Lighting Automations</b></summary><blockquote>
<b><i>Automation which works with motion sensors and mac system status to activate and de-activate lighting. Also depends on time of day.</b></i>

![Node-Red Flow](https://i.imgur.com/Lx5Qe6t.png)

<details><summary>Node-Red Code</summary><blockquote>
[{"id":"6dc0247c.d7210c","type":"subflow","name":"iOS Actionable Notification","info":"[Click here for latest Documentation](https://github.com/sstratoti/actionable-notifications-subflow-for-ios)\n","category":"home_assistant","in":[{"x":100,"y":80,"wires":[{"id":"6b940f2bfba5188c"}]}],"out":[{"x":1500,"y":280,"wires":[{"id":"90ab222038404541","port":0}]},{"x":1500,"y":340,"wires":[{"id":"90ab222038404541","port":1}]},{"x":1500,"y":400,"wires":[{"id":"90ab222038404541","port":2}]},{"x":1500,"y":460,"wires":[{"id":"90ab222038404541","port":3}]}],"env":[{"name":"group","type":"str","value":"None","ui":{"label":{"en-US":"Group Name"}}},{"name":"tag","type":"str","value":"","ui":{"label":{"en-US":"Tag (for replacing messages - optional)"}}},{"name":"service","type":"str","value":"","ui":{"label":{"en-US":"Notify Service"},"type":"input","opts":{"types":["str","env"]}}},{"name":"title","type":"str","value":"","ui":{"label":{"en-US":"Title"},"type":"input","opts":{"types":["str","env"]}}},{"name":"subtitle","type":"str","value":"","ui":{"label":{"en-US":"Subtitle (optional)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"message","type":"str","value":"","ui":{"label":{"en-US":"Message"},"type":"input","opts":{"types":["str","env"]}}},{"name":"notificationUrl","type":"str","value":"","ui":{"label":{"en-US":"Notification URL (optional)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"customSoundPreInstalled","type":"str","value":"default","ui":{"label":{"en-US":"Pre-installed Custom Sound"},"type":"select","opts":{"opts":[{"l":{"en-US":"default"},"v":"default"},{"l":{"en-US":"No Sound"},"v":"none"},{"l":{"en-US":"US-EN-Alexa-Back-Door-Opened.wav"},"v":"US-EN-Alexa-Back-Door-Opened.wav"},{"l":{"en-US":"US-EN-Alexa-Back-Door-Unlocked.wav"},"v":"US-EN-Alexa-Back-Door-Unlocked.wav"},{"l":{"en-US":"US-EN-Alexa-Basement-Door-Opened.wav"},"v":"US-EN-Alexa-Basement-Door-Opened.wav"},{"l":{"en-US":"US-EN-Alexa-Basement-Door-Unlocked.wav"},"v":"US-EN-Alexa-Basement-Door-Unlocked.wav"},{"l":{"en-US":"US-EN-Alexa-Boyfriend-Is-Arriving.wav"},"v":"US-EN-Alexa-Boyfriend-Is-Arriving.wav"},{"l":{"en-US":"US-EN-Alexa-Daughter-Is-Arriving.wav"},"v":"US-EN-Alexa-Daughter-Is-Arriving.wav"},{"l":{"en-US":"US-EN-Alexa-Front-Door-Opened.wav"},"v":"US-EN-Alexa-Front-Door-Opened.wav"},{"l":{"en-US":"US-EN-Alexa-Front-Door-Unlocked.wav"},"v":"US-EN-Alexa-Front-Door-Unlocked.wav"},{"l":{"en-US":"US-EN-Alexa-Garage-Door-Opened.wav"},"v":"US-EN-Alexa-Garage-Door-Opened.wav"},{"l":{"en-US":"US-EN-Alexa-Girlfriend-Is-Arriving.wav"},"v":"US-EN-Alexa-Girlfriend-Is-Arriving.wav"},{"l":{"en-US":"US-EN-Alexa-Good-Morning.wav"},"v":"US-EN-Alexa-Good-Morning.wav"},{"l":{"en-US":"US-EN-Alexa-Good-Night.wav"},"v":"US-EN-Alexa-Good-Night.wav"},{"l":{"en-US":"US-EN-Alexa-Husband-Is-Arriving.wav"},"v":"US-EN-Alexa-Husband-Is-Arriving.wav"},{"l":{"en-US":"US-EN-Alexa-Mail-Has-Arrived.wav"},"v":"US-EN-Alexa-Mail-Has-Arrived.wav"},{"l":{"en-US":"US-EN-Alexa-Motion-At-Back-Door.wav"},"v":"US-EN-Alexa-Motion-At-Back-Door.wav"},{"l":{"en-US":"US-EN-Alexa-Motion-At-Front-Door.wav"},"v":"US-EN-Alexa-Motion-At-Front-Door.wav"},{"l":{"en-US":"US-EN-Alexa-Motion-Detected-Generic.wav"},"v":"US-EN-Alexa-Motion-Detected-Generic.wav"},{"l":{"en-US":"US-EN-Alexa-Motion-In-Back-Yard.wav"},"v":"US-EN-Alexa-Motion-In-Back-Yard.wav"},{"l":{"en-US":"US-EN-Alexa-Motion-In-Basement.wav"},"v":"US-EN-Alexa-Motion-In-Basement.wav"},{"l":{"en-US":"US-EN-Alexa-Motion-In-Front-Yard.wav"},"v":"US-EN-Alexa-Motion-In-Front-Yard.wav"},{"l":{"en-US":"US-EN-Alexa-Motion-In-Garage.wav"},"v":"US-EN-Alexa-Motion-In-Garage.wav"},{"l":{"en-US":"US-EN-Alexa-Patio-Door-Opened.wav"},"v":"US-EN-Alexa-Patio-Door-Opened.wav"},{"l":{"en-US":"US-EN-Alexa-Patio-Door-Unlocked.wav"},"v":"US-EN-Alexa-Patio-Door-Unlocked.wav"},{"l":{"en-US":"US-EN-Alexa-Smoke-Detected-Generic.wav"},"v":"US-EN-Alexa-Smoke-Detected-Generic.wav"},{"l":{"en-US":"US-EN-Alexa-Smoke-Detected-In-Basement.wav"},"v":"US-EN-Alexa-Smoke-Detected-In-Basement.wav"},{"l":{"en-US":"US-EN-Alexa-Smoke-Detected-In-Garage.wav"},"v":"US-EN-Alexa-Smoke-Detected-In-Garage.wav"},{"l":{"en-US":"US-EN-Alexa-Smoke-Detected-In-Kitchen.wav"},"v":"US-EN-Alexa-Smoke-Detected-In-Kitchen.wav"},{"l":{"en-US":"US-EN-Alexa-Son-Is-Arriving.wav"},"v":"US-EN-Alexa-Son-Is-Arriving.wav"},{"l":{"en-US":"US-EN-Alexa-Water-Detected-Generic.wav"},"v":"US-EN-Alexa-Water-Detected-Generic.wav"},{"l":{"en-US":"US-EN-Alexa-Water-Detected-In-Basement.wav"},"v":"US-EN-Alexa-Water-Detected-In-Basement.wav"},{"l":{"en-US":"US-EN-Alexa-Water-Detected-In-Garage.wav"},"v":"US-EN-Alexa-Water-Detected-In-Garage.wav"},{"l":{"en-US":"US-EN-Alexa-Water-Detected-In-Kitchen.wav"},"v":"US-EN-Alexa-Water-Detected-In-Kitchen.wav"},{"l":{"en-US":"US-EN-Alexa-Welcome-Home.wav"},"v":"US-EN-Alexa-Welcome-Home.wav"},{"l":{"en-US":"US-EN-Alexa-Wife-Is-Arriving.wav"},"v":"US-EN-Alexa-Wife-Is-Arriving.wav"},{"l":{"en-US":"US-EN-Daisy-Back-Door-Motion.wav"},"v":"US-EN-Daisy-Back-Door-Motion.wav"},{"l":{"en-US":"US-EN-Daisy-Back-Door-Open.wav"},"v":"US-EN-Daisy-Back-Door-Open.wav"},{"l":{"en-US":"US-EN-Daisy-Front-Door-Motion.wav"},"v":"US-EN-Daisy-Front-Door-Motion.wav"},{"l":{"en-US":"US-EN-Daisy-Front-Door-Open.wav"},"v":"US-EN-Daisy-Front-Door-Open.wav"},{"l":{"en-US":"US-EN-Daisy-Front-Window-Open.wav"},"v":"US-EN-Daisy-Front-Window-Open.wav"},{"l":{"en-US":"US-EN-Daisy-Garage-Door-Open.wav"},"v":"US-EN-Daisy-Garage-Door-Open.wav"},{"l":{"en-US":"US-EN-Daisy-Guest-Bath-Leak.wav"},"v":"US-EN-Daisy-Guest-Bath-Leak.wav"},{"l":{"en-US":"US-EN-Daisy-Kitchen-Sink-Leak.wav"},"v":"US-EN-Daisy-Kitchen-Sink-Leak.wav"},{"l":{"en-US":"US-EN-Daisy-Kitchen-Window-Open.wav"},"v":"US-EN-Daisy-Kitchen-Window-Open.wav"},{"l":{"en-US":"US-EN-Daisy-Laundry-Room-Leak.wav"},"v":"US-EN-Daisy-Laundry-Room-Leak.wav"},{"l":{"en-US":"US-EN-Daisy-Master-Bath-Leak.wav"},"v":"US-EN-Daisy-Master-Bath-Leak.wav"},{"l":{"en-US":"US-EN-Daisy-Master-Bedroom-Window-Open.wav"},"v":"US-EN-Daisy-Master-Bedroom-Window-Open.wav"},{"l":{"en-US":"US-EN-Daisy-Office-Window-Open.wav"},"v":"US-EN-Daisy-Office-Window-Open.wav"},{"l":{"en-US":"US-EN-Daisy-Refrigerator-Leak.wav"},"v":"US-EN-Daisy-Refrigerator-Leak.wav"},{"l":{"en-US":"US-EN-Daisy-Water-Heater-Leak.wav"},"v":"US-EN-Daisy-Water-Heater-Leak.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Back-Door-Closed.wav"},"v":"US-EN-Morgan-Freeman-Back-Door-Closed.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Back-Door-Locked.wav"},"v":"US-EN-Morgan-Freeman-Back-Door-Locked.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Back-Door-Opened.wav"},"v":"US-EN-Morgan-Freeman-Back-Door-Opened.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Back-Door-Unlocked.wav"},"v":"US-EN-Morgan-Freeman-Back-Door-Unlocked.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Basement-Door-Closed.wav"},"v":"US-EN-Morgan-Freeman-Basement-Door-Closed.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Basement-Door-Locked.wav"},"v":"US-EN-Morgan-Freeman-Basement-Door-Locked.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Basement-Door-Opened.wav"},"v":"US-EN-Morgan-Freeman-Basement-Door-Opened.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Basement-Door-Unlocked.wav"},"v":"US-EN-Morgan-Freeman-Basement-Door-Unlocked.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Boss-Is-Arriving.wav"},"v":"US-EN-Morgan-Freeman-Boss-Is-Arriving.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Boyfriend-Is-Arriving.wav"},"v":"US-EN-Morgan-Freeman-Boyfriend-Is-Arriving.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Cleaning-Supplies-Closet-Opened.wav"},"v":"US-EN-Morgan-Freeman-Cleaning-Supplies-Closet-Opened.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Coworker-Is-Arriving.wav"},"v":"US-EN-Morgan-Freeman-Coworker-Is-Arriving.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Daughter-Is-Arriving.wav"},"v":"US-EN-Morgan-Freeman-Daughter-Is-Arriving.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Friend-Is-Arriving.wav"},"v":"US-EN-Morgan-Freeman-Friend-Is-Arriving.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Front-Door-Closed.wav"},"v":"US-EN-Morgan-Freeman-Front-Door-Closed.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Front-Door-Locked.wav"},"v":"US-EN-Morgan-Freeman-Front-Door-Locked.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Front-Door-Opened.wav"},"v":"US-EN-Morgan-Freeman-Front-Door-Opened.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Front-Door-Unlocked.wav"},"v":"US-EN-Morgan-Freeman-Front-Door-Unlocked.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Garage-Door-Closed.wav"},"v":"US-EN-Morgan-Freeman-Garage-Door-Closed.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Garage-Door-Opened.wav"},"v":"US-EN-Morgan-Freeman-Garage-Door-Opened.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Girlfriend-Is-Arriving.wav"},"v":"US-EN-Morgan-Freeman-Girlfriend-Is-Arriving.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Good-Morning.wav"},"v":"US-EN-Morgan-Freeman-Good-Morning.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Good-Night.wav"},"v":"US-EN-Morgan-Freeman-Good-Night.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Liquor-Cabinet-Opened.wav"},"v":"US-EN-Morgan-Freeman-Liquor-Cabinet-Opened.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Motion-Detected.wav"},"v":"US-EN-Morgan-Freeman-Motion-Detected.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Motion-In-Basement.wav"},"v":"US-EN-Morgan-Freeman-Motion-In-Basement.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Motion-In-Bedroom.wav"},"v":"US-EN-Morgan-Freeman-Motion-In-Bedroom.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Motion-In-Game-Room.wav"},"v":"US-EN-Morgan-Freeman-Motion-In-Game-Room.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Motion-In-Garage.wav"},"v":"US-EN-Morgan-Freeman-Motion-In-Garage.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Motion-In-Kitchen.wav"},"v":"US-EN-Morgan-Freeman-Motion-In-Kitchen.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Motion-In-Living-Room.wav"},"v":"US-EN-Morgan-Freeman-Motion-In-Living-Room.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Motion-In-Theater.wav"},"v":"US-EN-Morgan-Freeman-Motion-In-Theater.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Motion-In-Wine-Cellar.wav"},"v":"US-EN-Morgan-Freeman-Motion-In-Wine-Cellar.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Patio-Door-Closed.wav"},"v":"US-EN-Morgan-Freeman-Patio-Door-Closed.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Patio-Door-Locked.wav"},"v":"US-EN-Morgan-Freeman-Patio-Door-Locked.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Patio-Door-Opened.wav"},"v":"US-EN-Morgan-Freeman-Patio-Door-Opened.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Patio-Door-Unlocked.wav"},"v":"US-EN-Morgan-Freeman-Patio-Door-Unlocked.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Roommate-Is-Arriving.wav"},"v":"US-EN-Morgan-Freeman-Roommate-Is-Arriving.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Searching-For-Car-Keys.wav"},"v":"US-EN-Morgan-Freeman-Searching-For-Car-Keys.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Setting-The-Mood.wav"},"v":"US-EN-Morgan-Freeman-Setting-The-Mood.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Smartthings-Detected-A-Flood.wav"},"v":"US-EN-Morgan-Freeman-Smartthings-Detected-A-Flood.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Smartthings-Detected-Carbon-Monoxide.wav"},"v":"US-EN-Morgan-Freeman-Smartthings-Detected-Carbon-Monoxide.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Smartthings-Detected-Smoke.wav"},"v":"US-EN-Morgan-Freeman-Smartthings-Detected-Smoke.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Smoke-Detected-In-Basement.wav"},"v":"US-EN-Morgan-Freeman-Smoke-Detected-In-Basement.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Smoke-Detected-In-Garage.wav"},"v":"US-EN-Morgan-Freeman-Smoke-Detected-In-Garage.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Smoke-Detected-In-Kitchen.wav"},"v":"US-EN-Morgan-Freeman-Smoke-Detected-In-Kitchen.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Someone-Is-Arriving.wav"},"v":"US-EN-Morgan-Freeman-Someone-Is-Arriving.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Son-Is-Arriving.wav"},"v":"US-EN-Morgan-Freeman-Son-Is-Arriving.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Starting-Movie-Mode.wav"},"v":"US-EN-Morgan-Freeman-Starting-Movie-Mode.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Starting-Party-Mode.wav"},"v":"US-EN-Morgan-Freeman-Starting-Party-Mode.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Starting-Romance-Mode.wav"},"v":"US-EN-Morgan-Freeman-Starting-Romance-Mode.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-Off-All-The-Lights.wav"},"v":"US-EN-Morgan-Freeman-Turning-Off-All-The-Lights.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-Off-The-Air-Conditioner.wav"},"v":"US-EN-Morgan-Freeman-Turning-Off-The-Air-Conditioner.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-Off-The-Bar-Lights.wav"},"v":"US-EN-Morgan-Freeman-Turning-Off-The-Bar-Lights.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-Off-The-Chandelier.wav"},"v":"US-EN-Morgan-Freeman-Turning-Off-The-Chandelier.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-Off-The-Family-Room-Lights.wav"},"v":"US-EN-Morgan-Freeman-Turning-Off-The-Family-Room-Lights.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-Off-The-Hallway-Lights.wav"},"v":"US-EN-Morgan-Freeman-Turning-Off-The-Hallway-Lights.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-Off-The-Kitchen-Light.wav"},"v":"US-EN-Morgan-Freeman-Turning-Off-The-Kitchen-Light.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-Off-The-Light.wav"},"v":"US-EN-Morgan-Freeman-Turning-Off-The-Light.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-Off-The-Lights.wav"},"v":"US-EN-Morgan-Freeman-Turning-Off-The-Lights.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-Off-The-Mood-Lights.wav"},"v":"US-EN-Morgan-Freeman-Turning-Off-The-Mood-Lights.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-Off-The-TV.wav"},"v":"US-EN-Morgan-Freeman-Turning-Off-The-TV.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-On-The-Air-Conditioner.wav"},"v":"US-EN-Morgan-Freeman-Turning-On-The-Air-Conditioner.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-On-The-Bar-Lights.wav"},"v":"US-EN-Morgan-Freeman-Turning-On-The-Bar-Lights.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-On-The-Chandelier.wav"},"v":"US-EN-Morgan-Freeman-Turning-On-The-Chandelier.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-On-The-Family-Room-Lights.wav"},"v":"US-EN-Morgan-Freeman-Turning-On-The-Family-Room-Lights.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-On-The-Hallway-Lights.wav"},"v":"US-EN-Morgan-Freeman-Turning-On-The-Hallway-Lights.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-On-The-Kitchen-Light.wav"},"v":"US-EN-Morgan-Freeman-Turning-On-The-Kitchen-Light.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-On-The-Light.wav"},"v":"US-EN-Morgan-Freeman-Turning-On-The-Light.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-On-The-Lights.wav"},"v":"US-EN-Morgan-Freeman-Turning-On-The-Lights.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-On-The-Mood-Lights.wav"},"v":"US-EN-Morgan-Freeman-Turning-On-The-Mood-Lights.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-On-The-TV.wav"},"v":"US-EN-Morgan-Freeman-Turning-On-The-TV.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Vacate-The-Premises.wav"},"v":"US-EN-Morgan-Freeman-Vacate-The-Premises.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Water-Detected-In-Basement.wav"},"v":"US-EN-Morgan-Freeman-Water-Detected-In-Basement.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Water-Detected-In-Garage.wav"},"v":"US-EN-Morgan-Freeman-Water-Detected-In-Garage.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Water-Detected-In-Kitchen.wav"},"v":"US-EN-Morgan-Freeman-Water-Detected-In-Kitchen.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Welcome-Home.wav"},"v":"US-EN-Morgan-Freeman-Welcome-Home.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Wife-Is-Arriving.wav"},"v":"US-EN-Morgan-Freeman-Wife-Is-Arriving.wav"}]}}},{"name":"customSound","type":"str","value":"","ui":{"label":{"en-US":"Custom Sound (Optional - will override pre-installed selection)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"isCriticalNotification","type":"bool","value":"false","ui":{"label":{"en-US":"Critical Notification?"},"type":"input","opts":{"types":["bool"]}}},{"name":"interruptionLevel","type":"str","value":"active","ui":{"label":{"en-US":"Interruption Level"},"type":"select","opts":{"opts":[{"l":{"en-US":"Passive (iOS 15+)"},"v":"passive"},{"l":{"en-US":"Active (Default)"},"v":"active"},{"l":{"en-US":"Time Sensitive (iOS 15+)"},"v":"time-sensitive"},{"l":{"en-US":"Critical"},"v":"critical"}]}}},{"name":"userInfo","type":"bool","value":"false","ui":{"label":{"en-US":"Populate User Information"},"type":"checkbox"}},{"name":"isClearNotificationsOnAction","type":"bool","value":"false","ui":{"label":{"en-US":"Clear notifications on Action Received?"},"type":"checkbox"}},{"name":"action1Title","type":"str","value":"","ui":{"label":{"en-US":"Action 1 Title"},"type":"input","opts":{"types":["str"]}}},{"name":"action1Uri","type":"str","value":"","ui":{"label":{"en-US":"Action 1 URL (optional)"},"type":"input","opts":{"types":["str"]}}},{"name":"action1ActivationMode","type":"str","value":"background","ui":{"label":{"en-US":"Action 1 Activation Mode"},"type":"select","opts":{"opts":[{"l":{"en-US":"Background"},"v":"background"},{"l":{"en-US":"Foreground"},"v":"foreground"}]}}},{"name":"action1AuthenticationRequired","type":"bool","value":"false","ui":{"label":{"en-US":"Action 1 App Authentication Required?"},"type":"checkbox"}},{"name":"action1Destructive","type":"bool","value":"false","ui":{"label":{"en-US":"Action 1 Destructive?"},"type":"checkbox"}},{"name":"action1Behavior","type":"str","value":"default","ui":{"label":{"en-US":"Action 1 Behavior"},"type":"select","opts":{"opts":[{"l":{"en-US":"Default"},"v":"default"},{"l":{"en-US":"Text Input"},"v":"textInput"}]}}},{"name":"action1TextInputButtonTitle","type":"str","value":"","ui":{"label":{"en-US":"Action 1 Text Input Button Title (Required if behavior is Text Input)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"action1TextInputPlaceHolder","type":"str","value":"","ui":{"label":{"en-US":"Action 1 Text Input Placeholder (Optional - only if behavior is Text Input)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"action1Icon","type":"str","value":"","ui":{"label":{"en-US":"Action 1 Icon (Optional)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"action2Title","type":"str","value":"","ui":{"label":{"en-US":"Action 2 Title"},"type":"input","opts":{"types":["str"]}}},{"name":"action2Uri","type":"str","value":"","ui":{"label":{"en-US":"Action 2 URL (optional)"},"type":"input","opts":{"types":["str"]}}},{"name":"action2ActivationMode","type":"str","value":"background","ui":{"label":{"en-US":"Action 2 Activation Mode"},"type":"select","opts":{"opts":[{"l":{"en-US":"Background"},"v":"background"},{"l":{"en-US":"Foreground"},"v":"foreground"}]}}},{"name":"action2AuthenticationRequired","type":"bool","value":"false","ui":{"label":{"en-US":"Action 2 App Authentication Required?"},"type":"checkbox"}},{"name":"action2Destructive","type":"bool","value":"false","ui":{"label":{"en-US":"Action 2 Destructive?"},"type":"checkbox"}},{"name":"action2Behavior","type":"str","value":"default","ui":{"label":{"en-US":"Action 2 Behavior"},"type":"select","opts":{"opts":[{"l":{"en-US":"Default"},"v":"default"},{"l":{"en-US":"Text Input"},"v":"textInput"}]}}},{"name":"action2TextInputButtonTitle","type":"str","value":"","ui":{"label":{"en-US":"Action 2 Text Input Button Title (Required if behavior is Text Input)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"action2TextInputPlaceHolder","type":"str","value":"","ui":{"label":{"en-US":"Action 2 Text Input Placeholder (Optional - only if behavior is Text Input)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"action2Icon","type":"str","value":"","ui":{"label":{"en-US":"Action 2 Icon (Optional)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"action3Title","type":"str","value":"","ui":{"label":{"en-US":"Action 3 Title"},"type":"input","opts":{"types":["str"]}}},{"name":"action3Uri","type":"str","value":"","ui":{"label":{"en-US":"Action 3 URL (optional)"},"type":"input","opts":{"types":["str"]}}},{"name":"action3ActivationMode","type":"str","value":"background","ui":{"label":{"en-US":"Action 3 Activation Mode"},"type":"select","opts":{"opts":[{"l":{"en-US":"Background"},"v":"background"},{"l":{"en-US":"Foreground"},"v":"foreground"}]}}},{"name":"action3AuthenticationRequired","type":"bool","value":"false","ui":{"label":{"en-US":"Action 3 App Authentication Required?"},"type":"checkbox"}},{"name":"action3Destructive","type":"bool","value":"false","ui":{"label":{"en-US":"Action 3 Destructive?"},"type":"checkbox"}},{"name":"action3Behavior","type":"str","value":"default","ui":{"label":{"en-US":"Action 3 Behavior"},"type":"select","opts":{"opts":[{"l":{"en-US":"Default"},"v":"default"},{"l":{"en-US":"Text Input"},"v":"textInput"}]}}},{"name":"action3TextInputButtonTitle","type":"str","value":"","ui":{"label":{"en-US":"Action 3 Text Input Button Title (Required if behavior is Text Input)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"action3TextInputPlaceHolder","type":"str","value":"","ui":{"label":{"en-US":"Action 3 Text Input Placeholder (Optional - only if behavior is Text Input)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"action3Icon","type":"str","value":"","ui":{"label":{"en-US":"Action 3 Icon (Optional)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"action4Title","type":"str","value":"","ui":{"label":{"en-US":"Action 4 Title"},"type":"input","opts":{"types":["str"]}}},{"name":"action4Uri","type":"str","value":"","ui":{"label":{"en-US":"Action 4 URL (optional)"},"type":"input","opts":{"types":["str"]}}},{"name":"action4ActivationMode","type":"str","value":"background","ui":{"label":{"en-US":"Action 4 Activation Mode"},"type":"select","opts":{"opts":[{"l":{"en-US":"Background"},"v":"background"},{"l":{"en-US":"Foreground"},"v":"foreground"}]}}},{"name":"action4AuthenticationRequired","type":"bool","value":"false","ui":{"label":{"en-US":"Action 4 App Authentication Required?"},"type":"checkbox"}},{"name":"action4Destructive","type":"bool","value":"false","ui":{"label":{"en-US":"Action 4 Destructive?"},"type":"checkbox"}},{"name":"action4Behavior","type":"str","value":"default","ui":{"label":{"en-US":"Action 4 Behavior"},"type":"select","opts":{"opts":[{"l":{"en-US":"Default"},"v":"default"},{"l":{"en-US":"Text Input"},"v":"textInput"}]}}},{"name":"action4TextInputButtonTitle","type":"str","value":"","ui":{"label":{"en-US":"Action 4 Text Input Button Title (Required if behavior is Text Input)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"action4TextInputPlaceHolder","type":"str","value":"","ui":{"label":{"en-US":"Action 4 Text Input Placeholder (Optional - only if behavior is Text Input)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"action4Icon","type":"str","value":"","ui":{"label":{"en-US":"Action 4 Icon (Optional)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"latitudeFirst","type":"num","value":"","ui":{"label":{"en-US":"Latitude for Pin 1"},"type":"input","opts":{"types":["num","env"]}}},{"name":"longitudeFirst","type":"num","value":"","ui":{"label":{"en-US":"Longitude for Pin 1"},"type":"input","opts":{"types":["num","env"]}}},{"name":"latitudeSecond","type":"num","value":"","ui":{"label":{"en-US":"Latitude for Pin 2"},"type":"input","opts":{"types":["num","env"]}}},{"name":"longitudeSecond","type":"num","value":"","ui":{"label":{"en-US":"Longitude for Pin 2"},"type":"input","opts":{"types":["num","env"]}}},{"name":"showLineBetweenPoints","type":"bool","value":"false","ui":{"label":{"en-US":"Show a line between points?"},"type":"input","opts":{"types":["bool","env"]}}},{"name":"showCompass","type":"bool","value":"false","ui":{"label":{"en-US":"Show a compass on the map?"},"type":"input","opts":{"types":["bool","env"]}}},{"name":"showPointsOfInterest","type":"bool","value":"false","ui":{"label":{"en-US":"Show points of interest?"},"type":"input","opts":{"types":["bool","env"]}}},{"name":"showScale","type":"bool","value":"false","ui":{"label":{"en-US":"Show scale information on the map?"},"type":"input","opts":{"types":["bool","env"]}}},{"name":"showTraffic","type":"bool","value":"false","ui":{"label":{"en-US":"Show Traffic?"},"type":"input","opts":{"types":["bool","env"]}}},{"name":"showUserLocation","type":"bool","value":"false","ui":{"label":{"en-US":"Show User Location?"},"type":"input","opts":{"types":["bool","env"]}}},{"name":"cameraEntity","type":"str","value":"","ui":{"label":{"en-US":"Camera Entity"},"type":"input","opts":{"types":["str","env"]}}},{"name":"imagePath","type":"str","value":"","ui":{"label":{"en-US":"Image Path (10MB limit)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"videoPath","type":"str","value":"","ui":{"label":{"en-US":"Video Path (50MB limit)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"audioPath","type":"str","value":"","ui":{"label":{"en-US":"Audio Path (5MB limit)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"contentUrl","type":"str","value":"","ui":{"label":{"en-US":"Content URL (overrides image/video/audio)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"lazyLoading","type":"bool","value":"false","ui":{"label":{"en-US":"Load Media in Notification Lazily?"},"type":"input","opts":{"types":["bool","env"]}}},{"name":"hideThumbnail","type":"bool","value":"false","ui":{"label":{"en-US":"Hide thumbnail?"},"type":"input","opts":{"types":["bool","env"]}}}],"meta":{},"color":"#C7E9C0","outputLabels":["Action 1","Action 2","Action 3","Cleared"],"icon":"font-awesome/fa-mobile-phone","status":{"x":220,"y":320,"wires":[{"id":"f3d74762ed30ae54","port":0}]}},{"id":"3586791854cfef41","type":"function","z":"6dc0247c.d7210c","name":"create service call","func":"msg._originalPayload = msg.payload;\nlet flow_msg_variables = {\n  tag: '',\n  service: '',\n  message: msg,\n  date_created: Date.now()\n}\n\nvar xTitle = \"\";\nvar xSubtitle = \"\";\nvar xMessage = \"\";\nvar xServices = \"\";\nvar xTag = \"\";\nvar xUrl = \"\";\nvar xCameraEntity = \"\";\nvar xInterruptionLevel = \"\";\n\n// overrides\nif (typeof msg.notificationOverride !== 'undefined' && msg.notificationOverride !== null) {\n    if (typeof msg.notificationOverride.title !== 'undefined' && msg.notificationOverride.title !=='' && msg.notificationOverride.title !== null){\n        xTitle = msg.notificationOverride.title;\n    } else {\n        xTitle = env.get('title');\n    }\n    if (typeof msg.notificationOverride.subtitle !== 'undefined' && msg.notificationOverride.subtitle !==''  && msg.notificationOverride.subtitle !== null){\n        xSubtitle = msg.notificationOverride.subtitle;\n    } else {\n        xSubtitle = env.get('subtitle');\n    }\n    if (typeof msg.notificationOverride.message !== 'undefined' && msg.notificationOverride.message !=='' &&  msg.notificationOverride.message !== null){\n        xMessage = msg.notificationOverride.message;\n    } else {\n        xMessage = env.get('message');\n    }\n    if (typeof msg.notificationOverride.url !== 'undefined' && msg.notificationOverride.url !=='' &&  msg.notificationOverride.url !== null){\n        xUrl = msg.notificationOverride.url;\n    } else {\n        xUrl = env.get('notificationUrl');\n    }\n    if (typeof msg.notificationOverride.services !== 'undefined' && msg.notificationOverride.services !=='' && msg.notificationOverride.services !== null){\n        xServices = msg.notificationOverride.services;\n    } else {\n        xServices = env.get('service');\n    }\n    if (typeof msg.notificationOverride.cameraEntity !== 'undefined' && msg.notificationOverride.cameraEntity !=='' && msg.notificationOverride.cameraEntity !== null){\n        xCameraEntity = msg.notificationOverride.cameraEntity;\n    } else {\n        xCameraEntity = env.get('cameraEntity');\n    }\n    \n    if (typeof msg.notificationOverride.interruptionLevel !== 'undefined' && msg.notificationOverride.interruptionLevel !=='' && msg.notificationOverride.interruptionLevel !== null){\n        xInterruptionLevel = msg.notificationOverride.interruptionLevel;\n    } else {\n        xInterruptionLevel = env.get('interruptionLevel');\n    }\n    \n    flow_msg_variables.service=xServices;\n    if (typeof msg.notificationOverride.tag !== 'undefined' && msg.notificationOverride.tag !=='' && msg.notificationOverride.tag !== null){\n        xTag = msg.notificationOverride.tag.replace(/[^\\w\\s]/gi, '').replace(/\\s+/g,'_').toUpperCase();\n    } else {\n        if (env.get('tag') !== '') {\n            xTag = `${env.get('tag').replace(/[^\\w\\s]/gi, '').replace(/\\s+/g,'_').toUpperCase()}`;\n        } else {\n            // need to still set this to something in case clear_notification is sent.\n            xTag = `${env.get('title').replace(/[^\\w\\s]/gi, '').replace(/\\s+/g,'_').toUpperCase()}_${flow.get('random')}`;\n        } \n    }\n//support multiple tags per flow\n  flow_msg_variables.tag=xTag;\n} else {\n    // If no override is sent in...\n    if (env.get('tag') !== '') {\n        xTag = `${env.get('tag').replace(/[^\\w\\s]/gi, '').replace(/\\s+/g,'_').toUpperCase()}`;\n    } else {\n        // need to still set this to something in case clear_notification is sent.\n        xTag = `${env.get('title').replace(/[^\\w\\s]/gi, '').replace(/\\s+/g,'_').toUpperCase()}_${flow.get('random')}`;\n    } \n    //support multiple tags per flow\n    //  flow.set('tag',xTag);\n    flow_msg_variables.tag=xTag;\n    \n    xServices = env.get('service');\n    flow_msg_variables.service=xServices;\n\n    xTitle = env.get('title');\n    xSubtitle = env.get('subtitle');\n    xMessage = env.get('message');\n    xUrl = env.get('notificationUrl');\n    xCameraEntity = env.get('cameraEntity');\n    xInterruptionLevel = env.get('interruptionLevel');\n}\n\nlet all_flow_messages= flow.get('flow_messages');\nif (!all_flow_messages){\n  all_flow_messages=[];\n}\nlet new_flow_messages=[];\nfor(var i=0;i<all_flow_messages.length;i++){//copy (and reset) the messages array\n  if ((all_flow_messages[i].tag==flow_msg_variables.tag)&&(all_flow_messages[i].service==flow_msg_variables.service)){\n    continue;//don't copy this message\n  }else{\n    if (Date.now()-all_flow_messages[i].date_created<86400000){//only copy messages less than 24h old\n      new_flow_messages.push(all_flow_messages[i]);\n    }\n  }\n}\nnew_flow_messages.push(flow_msg_variables);\nflow.set('flow_messages',new_flow_messages);\n\nconst services = xServices;\nif(!services) {\n    node.status({\n        text: 'no services defined',\n        shape: 'ring',\n        fill: 'red'\n    });\n    return;    \n} else if (services == \"NOONE\"){\n    node.status({\n        text: 'No one to send to',\n        shape: 'ring',\n        fill: 'yellow'\n    });\n    return;\n}\n\n\n\n// create actions\nconst actions = [];\n[1,2,3,4].forEach(i => {\n    const name = `action${i}`\n    if (env.get(`${name}Title`) !== ''){\n        const action = env.get(`${name}Title`).replace(/[^\\w\\s]/gi, '').replace(/\\s+/g,'_').toUpperCase();\n        const title = env.get(`${name}Title`);\n        const activationMode = env.get(`${name}ActivationMode`);  \n        \n        const uri = env.get(`${name}Uri`);\n        const textInputButtonTitle = env.get(`${name}TextInputButtonTitle`);\n        const textInputPlaceholder = env.get(`${name}TextInputPlaceHolder`);\n        const authenticationRequired = env.get(`${name}AuthenticationRequired`);\n        const destructive = env.get(`${name}Destructive`);\n        const behavior = env.get(`${name}Behavior`);\n        const icon = env.get(`${name}Icon`);\n        \n        const actionObject = {};\n        actionObject.action = action;\n        actionObject.title = title;\n        actionObject.activationMode = activationMode;\n        \n        if (uri != \"\") actionObject.uri = uri;\n        if (textInputButtonTitle != \"\") actionObject.textInputButtonTitle = textInputButtonTitle;\n        if (textInputPlaceholder != \"\") actionObject.textInputPlaceholder = textInputPlaceholder;\n        if (authenticationRequired != \"\") actionObject.authenticationRequired = authenticationRequired;\n        if (destructive != \"\") actionObject.destructive = destructive;\n        if (behavior != \"\") actionObject.behavior = behavior;\n        if (icon != \"\") actionObject.icon = icon;\n        \n        actions.push(actionObject);\n    }\n});\n\n// create msg object\n\nmsg.payload = {\n        domain: 'notify',\n        data: {\n            title: xTitle,\n            message: xMessage,\n            data: {\n                push: {},\n                tag: xTag\n            }\n        }\n    };\n\nif (actions.length > 0) {\n    msg.payload.data.data.action_data = {tag: xTag};\n    msg.payload.data.data.actions = actions;\n    \n}\n\n\n// notification url\nif (xUrl !== \"\") {\n    msg.payload.data.data.url = {};\n    msg.payload.data.data.url = xUrl;\n}\n\n// subtitle\nif (xSubtitle !== '') {\n    msg.payload.data.data.subtitle = xSubtitle;\n}\n\n// sound information\nmsg.payload.data.data.push.sound = {};\nif (env.get('customSound').length > 0){\n    msg.payload.data.data.push.sound.name = env.get('customSound');\n} else if (env.get('customSoundPreInstalled').length > 0) {\n  if(env.get('customSoundPreInstalled')=='none'){\n    msg.payload.data.data.push.sound = 'none';\n  }else{\n    msg.payload.data.data.push.sound.name = env.get('customSoundPreInstalled');\n  }\n} else {\n    msg.payload.data.data.push.sound.name = 'default';\n}\n\nif (env.get('isCriticalNotification')) {\n    msg.payload.data.data.push.sound.critical = 1;\n    msg.payload.data.data.push.sound.volume = 1.0;\n    msg.payload.data.data.push[\"interruption-level\"] = 'critical';\n} else {\n    // interruption level\n    if (xInterruptionLevel !== '') {\n        msg.payload.data.data.push[\"interruption-level\"] = xInterruptionLevel;\n        if (xInterruptionLevel == 'critical'){\n            msg.payload.data.data.push.sound.critical = 1;\n            msg.payload.data.data.push.sound.volume = 1.0;\n        }\n    }\n}\n\n \n\n// overrides interruption level\nif (env.get('isCriticalNotification') == true) {\n    \n}\n\n// group thread id\nif (env.get('group') !== '') {\n    msg.payload.data.data.group = env.get('group');\n}\n\n// Map Information\nif (env.get('latitudeFirst') !== 0 && env.get('longitudeFirst') !== 0){\n    msg.payload.data.data.action_data.latitude = env.get('latitudeFirst');\n    msg.payload.data.data.action_data.longitude = env.get('longitudeFirst');\n    if (env.get('latitudeSecond') !== 0 && env.get('longitudeSecond') !== 0){\n        msg.payload.data.data.action_data.second_latitude = env.get('latitudeSecond');\n        msg.payload.data.data.action_data.second_longitude = env.get('longitudeSecond');\n        // add in all the extras, which default to false.\n        msg.payload.data.data.action_data.shows_line_between_points = env.get('showLineBetweenPoints');\n        msg.payload.data.data.action_data.shows_compass = env.get('showCompass');\n        msg.payload.data.data.action_data.shows_points_of_interest = env.get('showPointsOfInterest');\n        msg.payload.data.data.action_data.shows_scale = env.get('showScale');\n        msg.payload.data.data.action_data.shows_traffic = env.get('showTraffic');\n        msg.payload.data.data.action_data.shows_user_location = env.get('showUserLocation');\n    }\n}\n// camera information\nif (xCameraEntity !== '') {\n    msg.payload.data.data.entity_id = xCameraEntity;\n}\n// media information\nif (env.get('contentUrl') !== '') {\n\n} else {\n    if (env.get('imagePath') !== '') {\n        msg.payload.data.data.image = env.get('imagePath');\n    }\n    if (env.get('videoPath') !== '') {\n        msg.payload.data.data.video = env.get('videoPath');\n    }\n    if (env.get('audioPath') !== '') {\n        msg.payload.data.data.audio = env.get('audioPath');\n    }\n}\nif (env.get('contentUrl') !== '' || env.get('imagePath') !== '' || env.get('videoPath') !== '' || env.get('audioPath') !== '') {\n    if (env.get('lazyLoading')) {\n        msg.payload.data.data.lazy = env.get('lazyLoading');\n    }\n    if (env.get('hideThumbnail')) {\n        msg.payload.data.data.attachment = {};\n        msg.payload.data.data.attachment['hide-thumbnail'] = env.get('hideThumbnail');\n    }\n}\n\nservices.trim().split(/,\\s*/).forEach(service => {\n    if(!service) return;\n    msg.payload.service = service;\n    node.send(msg);\n});\n\nnode.done();","outputs":1,"noerr":0,"initialize":"flow.set('random',Math.random().toString(36).replace(/[^a-z]+/g, '').substr(0, 5).toUpperCase());","finalize":"","libs":[],"x":430,"y":80,"wires":[["84115d3979a0b0b6"]]},{"id":"90ab222038404541","type":"switch","z":"6dc0247c.d7210c","name":"which action?","property":"responseIndex","propertyType":"flow","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"},{"t":"eq","v":"3","vt":"num"},{"t":"eq","v":"4","vt":"num"}],"checkall":"true","repair":false,"outputs":4,"x":1280,"y":380,"wires":[[],[],[],[]]},{"id":"f3d74762ed30ae54","type":"status","z":"6dc0247c.d7210c","name":"","scope":["3586791854cfef41","b1e2e20511543565","fcf9f9c27469a607","6fdf5748e207aa7e"],"x":100,"y":320,"wires":[[]]},{"id":"b1e2e20511543565","type":"function","z":"6dc0247c.d7210c","name":"build message","func":"const latestMessage = flow.get('latestMessage');\nconst event = msg.payload.event;\n\nlatestMessage.payload = latestMessage._originalPayload;\nlatestMessage.eventData = msg.payload;\ndelete latestMessage._originalPayload;\n\nif(env.get('userInfo')) {\n    const userData = msg.userData.find(u => u.id === msg.payload.context.user_id);\n    latestMessage.userData = userData;\n}\n\nconst index = [1,2,3,4].find(i => env.get(`action${i}Title`).replace(/[^\\w\\s]/gi, '').replace(/\\s+/g,'_').toUpperCase() === event.actionName);\nflow.set(\"responseIndex\",index);\nnode.status({\n    text: `${env.get(`action${index}Title`).replace(/[^\\w\\s]/gi, '').replace(/\\s+/g,'_').toUpperCase()} at: ${getPrettyDate()}`,\n    shape: 'dot',\n    fill: 'green'\n});\n\nreturn latestMessage;\n\n\nfunction getPrettyDate() {\n    return new Date().toLocaleDateString('en-US', {\n        month: 'short',\n        day: 'numeric',\n        hour12: false,\n        hour: 'numeric',\n        minute: 'numeric',\n    });\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1080,"y":380,"wires":[["90ab222038404541"]]},{"id":"7bc5c379b10a2fbf","type":"ha-api","z":"6dc0247c.d7210c","name":"get user info","server":"f43d015e.4b29","version":1,"debugenabled":false,"protocol":"websocket","method":"get","path":"","data":"{\"type\": \"config/auth/list\"}","dataType":"json","responseType":"json","outputProperties":[{"property":"userData","propertyType":"msg","value":"","valueType":"results"}],"x":950,"y":320,"wires":[["b1e2e20511543565"]]},{"id":"c25a82298fbaad78","type":"switch","z":"6dc0247c.d7210c","name":"fetch user info?","property":"userInfo","propertyType":"env","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":800,"y":380,"wires":[["7bc5c379b10a2fbf"],["b1e2e20511543565"]]},{"id":"b738bc2e474ec4a5","type":"server-events","z":"6dc0247c.d7210c","name":"ios.notification_action_fired","server":"f43d015e.4b29","version":1,"event_type":"ios.notification_action_fired","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"},{"property":"event_type","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"}],"x":164,"y":256,"wires":[["86b12904f73a0329"]]},{"id":"fcf9f9c27469a607","type":"api-call-service","z":"6dc0247c.d7210c","name":"Send Notifications","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"notify","service":"","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"callServiceData","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":830,"y":80,"wires":[[]]},{"id":"6fdf5748e207aa7e","type":"function","z":"6dc0247c.d7210c","name":"create CLEAR service call","func":"msg._originalPayload = msg.payload;\nvar tag_to_clear = \"\";\nvar services = \"\";\nvar clearAll = false;\nif (typeof msg.notificationOverride !== 'undefined') {\n    if (typeof msg.notificationOverride.clear !== 'undefined' && msg.notificationOverride.clear !== null && msg.notificationOverride.clear) {\n        clearAll = true;\n    }\n    if (typeof msg.notificationOverride.services !== 'undefined' && msg.notificationOverride.services !== null && msg.notificationOverride.services){\n        services = msg.notificationOverride.services;\n    }\n    if (typeof msg.notificationOverride.tag !== 'undefined' && msg.notificationOverride.tag !== null && msg.notificationOverride.tag){\n        tag_to_clear = msg.notificationOverride.tag.replace(/[^\\w\\s]/gi, '').replace(/\\s+/g,'_').toUpperCase();//formatting tags as sent to the phone before\n    }\n}\n\nif (tag_to_clear==\"\"){//no specific tag sent, clear the last message.\n  var all_flow_messages= flow.get('flow_messages');\n  if(all_flow_messages) {\n    var last_message= all_flow_messages.pop();\n    if (last_message){//on nodeRED restart\n      tag_to_clear= last_message.tag;\n      services = last_message.service;//override service to the one used in last message sent\n      flow.set('flow_messages',all_flow_messages);//clear the message from memory\n    }\n  }\n}\n\nif(services==\"\") {\n    node.status({\n        text: 'no services defined',\n        shape: 'ring',\n        fill: 'red'\n    });\n    return;    \n}\n\nif(tag_to_clear==\"\") {\n  node.status({\n    text: 'no messages to delete',\n    shape: 'ring',\n    fill: 'red'\n  });\n  return;  \n}\n\n// create ios msg object\n\nmsg.payload = {\n        domain: 'notify',\n        data: {\n            message: \"clear_notification\",\n            data: {\n                tag: tag_to_clear\n            }\n        }\n    };\n\nfunction getPrettyDate() {\n    return new Date().toLocaleDateString('en-US', {\n        month: 'short',\n        day: 'numeric',\n        hour12: false,\n        hour: 'numeric',\n        minute: 'numeric',\n    });\n}\n\nif (clearAll){\n    delete msg.notificationOverride;\n}\n    \nvar xCountCleared = 0;\nservices.trim().split(/,\\s*/).forEach(service => {\n    if(!service) return;\n    // only clear on devices that didn't send the event.\n    if (clearAll){\n        msg.payload.service = service;\n        node.send(msg);\n        xCountCleared++;\n    } else if (!service.includes(msg._originalPayload.event.sourceDeviceID)){\n        msg.payload.service = service;\n        node.send(msg);\n        xCountCleared++;\n    }\n});\nif (xCountCleared > 0) {\n    node.status({\n        text: `${xCountCleared} messages cleared at: ${getPrettyDate()}`,\n        shape: 'dot',\n        fill: 'blue'\n    });\n} else {\n    node.status({\n        text: `No messages cleared: ${getPrettyDate()}`,\n        shape: 'dot',\n        fill: 'red'\n    });\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":750,"y":220,"wires":[["05b8370d35105d3c"]]},{"id":"a69ed312811b3a6d","type":"switch","z":"6dc0247c.d7210c","name":"Clear Notification on Action?","property":"isClearNotificationsOnAction","propertyType":"env","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":460,"y":320,"wires":[["6fdf5748e207aa7e","227a6ab8de989095"],["c25a82298fbaad78"]]},{"id":"e229e2d8efb85d22","type":"api-call-service","z":"6dc0247c.d7210c","name":"Clear Notifications","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"notify","service":"","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"callServiceData","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1190,"y":140,"wires":[[]]},{"id":"227a6ab8de989095","type":"delay","z":"6dc0247c.d7210c","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":720,"y":320,"wires":[["c25a82298fbaad78"]]},{"id":"6b940f2bfba5188c","type":"switch","z":"6dc0247c.d7210c","name":"clear?","property":"notificationOverride.clear","propertyType":"msg","rules":[{"t":"istype","v":"undefined","vt":"undefined"},{"t":"null"},{"t":"false"},{"t":"true"}],"checkall":"false","repair":false,"outputs":4,"x":210,"y":80,"wires":[["3586791854cfef41"],["3586791854cfef41"],["3586791854cfef41"],["6fdf5748e207aa7e"]]},{"id":"05b8370d35105d3c","type":"delay","z":"6dc0247c.d7210c","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":970,"y":160,"wires":[["e229e2d8efb85d22"]]},{"id":"84115d3979a0b0b6","type":"delay","z":"6dc0247c.d7210c","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":630,"y":80,"wires":[["fcf9f9c27469a607"]]},{"id":"86b12904f73a0329","type":"function","z":"6dc0247c.d7210c","name":"belongs here?","func":"let msg_tag=msg.payload.event.action_data.tag;\nlet all_flow_messages= flow.get('flow_messages');\nif(all_flow_messages){\n    for (var i=0;i<all_flow_messages.length;i++){\n        if (all_flow_messages[i].tag.trim()==msg_tag.trim()){\n            flow.set('latestMessage',all_flow_messages[i].message);\n            return [msg,null];\n        }\n    }\n}\nreturn [null,msg];\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":400,"y":260,"wires":[["a69ed312811b3a6d"],[]]},{"id":"0c8b275e7a34a25c","type":"tab","label":"Office","disabled":false,"info":"","env":[]},{"id":"cfa2b5528df1706e","type":"group","z":"0c8b275e7a34a25c","name":"Office Lighting - Xbox Control","style":{"label":true},"nodes":["865b763260b2e656","1a5eb1854aee1bc9","53a4c9a8dd06e4cd","1875a0907cefbee9","d917ba0864630d2f","2261c3a7f4611001","d0855e19f896afe2","ac5131fbd36abbf7"],"x":14,"y":239,"w":852,"h":142},{"id":"b698f877eb646013","type":"group","z":"0c8b275e7a34a25c","name":"Office Lighting - Mac Control","style":{"label":true},"nodes":["63936f8756ca0048","3aa1e1fd5edd79db","4c65e1a366bcc553","feec78aa8e783197","966f5608fc29c504","1fed51c35e7f4b43","d067440ecd22dd3c","abbd4ecafe20c316"],"x":14,"y":19,"w":732,"h":202},{"id":"76df181a3cc2f2fc","type":"group","z":"0c8b275e7a34a25c","name":"Office Lighting - Meeting Control","style":{"label":true},"nodes":["19066ee6e6da335a","824364bea194606b","9f7094f7af59e95f","6207327b28e05dcd","53edba07177a1d3f","894c2646c144064a","4586b621b7692fef","5e9d3a41a63a5db4","73c665fd127a2b29","de24f97454d497fb","4d664383a521c324","31f941d4bba4734f","b1668861914488f6"],"x":14,"y":399,"w":1232,"h":377},{"id":"63936f8756ca0048","type":"server-state-changed","z":"0c8b275e7a34a25c","g":"b698f877eb646013","name":"Mac On?","server":"f43d015e.4b29","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sam_s_mac_mini_active","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":100,"y":120,"wires":[["3aa1e1fd5edd79db"],["1fed51c35e7f4b43"]]},{"id":"3aa1e1fd5edd79db","type":"api-current-state","z":"0c8b275e7a34a25c","g":"b698f877eb646013","name":"Xbox On?","server":"f43d015e.4b29","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.xbox_status","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":260,"y":100,"wires":[[],["4c65e1a366bcc553","feec78aa8e783197"]]},{"id":"4c65e1a366bcc553","type":"api-current-state","z":"0c8b275e7a34a25c","g":"b698f877eb646013","name":"In Meeting?","server":"f43d015e.4b29","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.sam_s_mac_mini_camera_in_use","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":490,"y":120,"wires":[[],["966f5608fc29c504"]]},{"id":"feec78aa8e783197","type":"api-current-state","z":"0c8b275e7a34a25c","g":"b698f877eb646013","name":"In Meeting?","server":"f43d015e.4b29","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.sam_s_mac_mini_active_audio_input","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":490,"y":60,"wires":[[],["966f5608fc29c504"]]},{"id":"966f5608fc29c504","type":"api-call-service","z":"0c8b275e7a34a25c","g":"b698f877eb646013","name":"Office On","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"scene","service":"turn_on","areaId":[],"deviceId":[],"entityId":["scene.office_bright"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":660,"y":80,"wires":[[]]},{"id":"1fed51c35e7f4b43","type":"delay","z":"0c8b275e7a34a25c","g":"b698f877eb646013","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":260,"y":160,"wires":[["d067440ecd22dd3c"]]},{"id":"d067440ecd22dd3c","type":"api-current-state","z":"0c8b275e7a34a25c","g":"b698f877eb646013","name":"Mac On?","server":"f43d015e.4b29","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.sam_s_mac_mini_active","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":440,"y":180,"wires":[["1fed51c35e7f4b43"],["abbd4ecafe20c316"]]},{"id":"abbd4ecafe20c316","type":"api-call-service","z":"0c8b275e7a34a25c","g":"b698f877eb646013","name":"Office Off","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.office_leds"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":660,"y":140,"wires":[[]]},{"id":"865b763260b2e656","type":"server-state-changed","z":"0c8b275e7a34a25c","g":"cfa2b5528df1706e","name":"Xbox On?","server":"f43d015e.4b29","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.xbox_status","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":100,"y":280,"wires":[["1a5eb1854aee1bc9"],[]]},{"id":"1a5eb1854aee1bc9","type":"api-call-service","z":"0c8b275e7a34a25c","g":"cfa2b5528df1706e","name":"Capture Scene","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"scene","service":"create","areaId":[],"deviceId":[],"entityId":[],"data":"{\"scene_id\":\"pregame\",\"snapshot_entities\":\"light.office_leds\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":280,"y":280,"wires":[["53a4c9a8dd06e4cd"]]},{"id":"53a4c9a8dd06e4cd","type":"api-call-service","z":"0c8b275e7a34a25c","g":"cfa2b5528df1706e","name":"Game Scene","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"scene","service":"turn_on","areaId":[],"deviceId":[],"entityId":["scene.office_gaming"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":470,"y":280,"wires":[[]]},{"id":"1875a0907cefbee9","type":"server-state-changed","z":"0c8b275e7a34a25c","g":"cfa2b5528df1706e","name":"Xbox Off?","server":"f43d015e.4b29","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.xbox_status","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":100,"y":340,"wires":[["d917ba0864630d2f"],[]]},{"id":"d917ba0864630d2f","type":"api-call-service","z":"0c8b275e7a34a25c","g":"cfa2b5528df1706e","name":"Return Scene","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"scene","service":"turn_on","areaId":[],"deviceId":[],"entityId":["scene.pregame"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":280,"y":340,"wires":[["d0855e19f896afe2"]]},{"id":"2261c3a7f4611001","type":"api-current-state","z":"0c8b275e7a34a25c","g":"cfa2b5528df1706e","name":"Mac On?","server":"f43d015e.4b29","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.sam_s_mac_mini_active","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":620,"y":340,"wires":[["1fed51c35e7f4b43"],["ac5131fbd36abbf7"]]},{"id":"d0855e19f896afe2","type":"delay","z":"0c8b275e7a34a25c","g":"cfa2b5528df1706e","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":460,"y":340,"wires":[["2261c3a7f4611001"]]},{"id":"ac5131fbd36abbf7","type":"api-call-service","z":"0c8b275e7a34a25c","g":"cfa2b5528df1706e","name":"Office Off","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.office_leds"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":780,"y":340,"wires":[[]]},{"id":"19066ee6e6da335a","type":"server-state-changed","z":"0c8b275e7a34a25c","g":"76df181a3cc2f2fc","name":"In Meeting?","server":"f43d015e.4b29","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.sam_s_mac_mini_active_audio_input","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":110,"y":440,"wires":[["9f7094f7af59e95f"],[]]},{"id":"824364bea194606b","type":"server-state-changed","z":"0c8b275e7a34a25c","g":"76df181a3cc2f2fc","name":"In Meeting?","server":"f43d015e.4b29","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.sam_s_mac_mini_active_camera","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":110,"y":500,"wires":[["9f7094f7af59e95f"],[]]},{"id":"9f7094f7af59e95f","type":"api-call-service","z":"0c8b275e7a34a25c","g":"76df181a3cc2f2fc","name":"Capture Scene","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"scene","service":"create","areaId":[],"deviceId":[],"entityId":[],"data":"{\"scene_id\":\"premeeting\",\"snapshot_entities\":\"light.office_leds\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":300,"y":460,"wires":[["6207327b28e05dcd"]]},{"id":"6207327b28e05dcd","type":"api-call-service","z":"0c8b275e7a34a25c","g":"76df181a3cc2f2fc","name":"Meeting Scene","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"scene","service":"turn_on","areaId":[],"deviceId":[],"entityId":["scene.office_meeting"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":500,"y":460,"wires":[["73c665fd127a2b29"]]},{"id":"53edba07177a1d3f","type":"server-state-changed","z":"0c8b275e7a34a25c","g":"76df181a3cc2f2fc","name":"Meeting Finished?","server":"f43d015e.4b29","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.sam_s_mac_mini_active_audio_input","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"5","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":130,"y":560,"wires":[["5e9d3a41a63a5db4"],[]]},{"id":"894c2646c144064a","type":"server-state-changed","z":"0c8b275e7a34a25c","g":"76df181a3cc2f2fc","name":"Meeting Finished?","server":"f43d015e.4b29","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.sam_s_mac_mini_active_camera","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"5","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":130,"y":620,"wires":[["5e9d3a41a63a5db4"],[]]},{"id":"4586b621b7692fef","type":"api-call-service","z":"0c8b275e7a34a25c","g":"76df181a3cc2f2fc","name":"Return Scene","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"scene","service":"turn_on","areaId":[],"deviceId":[],"entityId":["scene.premeeting"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":500,"y":560,"wires":[["d0855e19f896afe2"]]},{"id":"5e9d3a41a63a5db4","type":"api-current-state","z":"0c8b275e7a34a25c","g":"76df181a3cc2f2fc","name":"Mac On?","server":"f43d015e.4b29","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.sam_s_mac_mini_active","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":320,"y":560,"wires":[["4586b621b7692fef"],["d0855e19f896afe2"]]},{"id":"73c665fd127a2b29","type":"api-current-state","z":"0c8b275e7a34a25c","g":"76df181a3cc2f2fc","name":"Leah Out?","server":"f43d015e.4b29","version":3,"outputs":2,"halt_if":"away","halt_if_type":"str","halt_if_compare":"is","entity_id":"person.leah","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":690,"y":460,"wires":[["de24f97454d497fb"],[]]},{"id":"de24f97454d497fb","type":"subflow:6dc0247c.d7210c","z":"0c8b275e7a34a25c","g":"76df181a3cc2f2fc","name":"","env":[{"name":"group","value":"","type":"str"},{"name":"service","value":"mobile_app_leah_s_iphone","type":"str"},{"name":"title","value":"Sam is in a Meeting","type":"str"},{"name":"message","value":"Shhhhhhhhhhhhhhhhh","type":"str"},{"name":"notificationUrl","value":"/calendar","type":"str"},{"name":"isClearNotificationsOnAction","type":"bool","value":"true"},{"name":"action1Title","value":"Check Calendar","type":"str"},{"name":"action1Uri","value":"/calendar","type":"str"},{"name":"action2Title","value":"Let me know when finished","type":"str"}],"x":480,"y":720,"wires":[[],["4d664383a521c324"],[],[]]},{"id":"4d664383a521c324","type":"ha-wait-until","z":"0c8b275e7a34a25c","g":"76df181a3cc2f2fc","name":"Meeting Finished?","server":"f43d015e.4b29","version":1,"outputs":1,"entityId":"sensor.sam_s_mac_mini_active_camera","entityIdFilterType":"exact","property":"state","comparator":"is","value":"off","valueType":"str","timeout":"0","timeoutType":"num","timeoutUnits":"minutes","entityLocation":"data","entityLocationType":"none","checkCurrentState":true,"blockInputOverrides":true,"x":730,"y":720,"wires":[["31f941d4bba4734f"]]},{"id":"31f941d4bba4734f","type":"ha-wait-until","z":"0c8b275e7a34a25c","g":"76df181a3cc2f2fc","name":"Meeting Finished?","server":"f43d015e.4b29","version":1,"outputs":1,"entityId":"binary_sensor.sam_s_mac_mini_audio_input_in_use","entityIdFilterType":"exact","property":"state","comparator":"is","value":"off","valueType":"str","timeout":"0","timeoutType":"num","timeoutUnits":"minutes","entityLocation":"data","entityLocationType":"none","checkCurrentState":true,"blockInputOverrides":true,"x":930,"y":720,"wires":[["b1668861914488f6"]]},{"id":"b1668861914488f6","type":"api-call-service","z":"0c8b275e7a34a25c","g":"76df181a3cc2f2fc","name":"Notify Finished","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"notify","service":"mobile_app_leah_s_iphone","areaId":[],"deviceId":[],"entityId":[],"data":"{\"message\":\"He's Finished\",\"title\":\"Meeting is Finished\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1140,"y":720,"wires":[[]]},{"id":"f43d015e.4b29","type":"server","name":"Home Assistant","version":4,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true,"cacheJson":true,"heartbeat":false,"heartbeatInterval":30,"areaSelector":"friendlyName","deviceSelector":"friendlyName","entitySelector":"friendlyName","statusSeparator":"at: ","statusYear":"hidden","statusMonth":"short","statusDay":"numeric","statusHourCycle":"h23","statusTimeFormat":"h:m"}]
</details>

&nbsp;&nbsp;_which uses:_

- [Node-RED Add-On](https://github.com/hassio-addons/addon-node-red)
- [@dortamur's Node-Red Motion Lighting Flow Template](https://github.com/dortamur/ha-node-red-flows) 

</details></details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/lighting/office/bright.yaml">Bright</a></b></summary><blockquote>
<b><i>Automation to activate bright office scene.</b></i>

&nbsp;&nbsp;_which uses:_

- [scene.office_bright](https://github.com/smcnab1/op-question-mark/blob/master/entities/scenes/office/bright.yaml) </details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/lighting/office/dull.yaml">Dull</a></b></summary><blockquote>
<b><i>Automation to activate dull office scene.</b></i>

&nbsp;&nbsp;_which uses:_

- [scene.office_dull](https://github.com/smcnab1/op-question-mark/blob/master/entities/scenes/office/dull.yaml) </details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/lighting/office/gaming.yaml">Gaming</a></b></summary><blockquote>
<b><i>Automation to activate gaming scene when xbox turned on.</b></i>

![Node-Red Flow](https://i.imgur.com/mEJb7J4.png)

<details><summary>Node-Red Code</summary><blockquote>
[{"id":"cfa2b5528df1706e","type":"group","z":"0c8b275e7a34a25c","name":"Office Lighting - Xbox Control","style":{"label":true},"nodes":["865b763260b2e656","1a5eb1854aee1bc9","53a4c9a8dd06e4cd","1875a0907cefbee9","d917ba0864630d2f","2261c3a7f4611001","d0855e19f896afe2","ac5131fbd36abbf7"],"x":14,"y":239,"w":852,"h":142},{"id":"865b763260b2e656","type":"server-state-changed","z":"0c8b275e7a34a25c","g":"cfa2b5528df1706e","name":"Xbox On?","server":"f43d015e.4b29","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.xbox_status","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":100,"y":280,"wires":[["1a5eb1854aee1bc9"],[]]},{"id":"1a5eb1854aee1bc9","type":"api-call-service","z":"0c8b275e7a34a25c","g":"cfa2b5528df1706e","name":"Capture Scene","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"scene","service":"create","areaId":[],"deviceId":[],"entityId":[],"data":"{\"scene_id\":\"pregame\",\"snapshot_entities\":\"light.office_leds\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":280,"y":280,"wires":[["53a4c9a8dd06e4cd"]]},{"id":"53a4c9a8dd06e4cd","type":"api-call-service","z":"0c8b275e7a34a25c","g":"cfa2b5528df1706e","name":"Game Scene","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"scene","service":"turn_on","areaId":[],"deviceId":[],"entityId":["scene.office_gaming"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":470,"y":280,"wires":[[]]},{"id":"1875a0907cefbee9","type":"server-state-changed","z":"0c8b275e7a34a25c","g":"cfa2b5528df1706e","name":"Xbox Off?","server":"f43d015e.4b29","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.xbox_status","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":100,"y":340,"wires":[["d917ba0864630d2f"],[]]},{"id":"d917ba0864630d2f","type":"api-call-service","z":"0c8b275e7a34a25c","g":"cfa2b5528df1706e","name":"Return Scene","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"scene","service":"turn_on","areaId":[],"deviceId":[],"entityId":["scene.pregame"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":280,"y":340,"wires":[["d0855e19f896afe2"]]},{"id":"2261c3a7f4611001","type":"api-current-state","z":"0c8b275e7a34a25c","g":"cfa2b5528df1706e","name":"Mac On?","server":"f43d015e.4b29","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.sam_s_mac_mini_active","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":620,"y":340,"wires":[["1fed51c35e7f4b43"],["ac5131fbd36abbf7"]]},{"id":"d0855e19f896afe2","type":"delay","z":"0c8b275e7a34a25c","g":"cfa2b5528df1706e","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":460,"y":340,"wires":[["2261c3a7f4611001"]]},{"id":"ac5131fbd36abbf7","type":"api-call-service","z":"0c8b275e7a34a25c","g":"cfa2b5528df1706e","name":"Office Off","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.office_leds"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":780,"y":340,"wires":[[]]},{"id":"f43d015e.4b29","type":"server","name":"Home Assistant","version":4,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true,"cacheJson":true,"heartbeat":false,"heartbeatInterval":30,"areaSelector":"friendlyName","deviceSelector":"friendlyName","entitySelector":"friendlyName","statusSeparator":"at: ","statusYear":"hidden","statusMonth":"short","statusDay":"numeric","statusHourCycle":"h23","statusTimeFormat":"h:m"}]
  </details>
  
&nbsp;&nbsp;_which uses:_

- [Node-RED Add-On](https://github.com/hassio-addons/addon-node-red)
- [scene.office_gaming](https://github.com/smcnab1/op-question-mark/blob/master/entities/scenes/office/gaming.yaml) </details>
  
  
<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/lighting/office/lamp.yaml">Lamp</a></b></summary><blockquote>
<b><i>Automation to activate bright office scene with desk lamp.</b></i>

&nbsp;&nbsp;_which uses:_

- [scene.office_lamp](https://github.com/smcnab1/op-question-mark/blob/master/entities/scenes/office/lamp.yaml) </details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/lighting/office/desk_lamp_tag.yaml">Desk Lamp Tag</a></b></summary><blockquote>
<b><i>NFC Tag used to easily turn on the desk lamp.</b></i>

&nbsp;&nbsp;_which uses:_

- [scene.office_lamp](https://github.com/smcnab1/op-question-mark/blob/master/entities/scenes/office/lamp.yaml)
- [HA NFC Tag Integration](https://www.home-assistant.io/blog/2020/09/15/home-assistant-tags/) </details>

<details><summary><b>Meeting</b></summary><blockquote>
<b><i>Automation to activate meeting scene so wife knows on meeting when camera or audio input activated on mac.</b></i>

![Node-Red Flow](https://i.imgur.com/Blz2hH5.png)

<details><summary>Node-Red Code</summary><blockquote>
[{"id":"76df181a3cc2f2fc","type":"group","z":"0c8b275e7a34a25c","name":"Office Lighting - Meeting Control","style":{"label":true},"nodes":["19066ee6e6da335a","824364bea194606b","9f7094f7af59e95f","6207327b28e05dcd","53edba07177a1d3f","894c2646c144064a","4586b621b7692fef","5e9d3a41a63a5db4","73c665fd127a2b29","de24f97454d497fb","4d664383a521c324","31f941d4bba4734f","b1668861914488f6"],"x":14,"y":399,"w":1232,"h":377},{"id":"6dc0247c.d7210c","type":"subflow","name":"iOS Actionable Notification","info":"[Click here for latest Documentation](https://github.com/sstratoti/actionable-notifications-subflow-for-ios)\n","category":"home_assistant","in":[{"x":100,"y":80,"wires":[{"id":"6b940f2bfba5188c"}]}],"out":[{"x":1500,"y":280,"wires":[{"id":"90ab222038404541","port":0}]},{"x":1500,"y":340,"wires":[{"id":"90ab222038404541","port":1}]},{"x":1500,"y":400,"wires":[{"id":"90ab222038404541","port":2}]},{"x":1500,"y":460,"wires":[{"id":"90ab222038404541","port":3}]}],"env":[{"name":"group","type":"str","value":"None","ui":{"label":{"en-US":"Group Name"}}},{"name":"tag","type":"str","value":"","ui":{"label":{"en-US":"Tag (for replacing messages - optional)"}}},{"name":"service","type":"str","value":"","ui":{"label":{"en-US":"Notify Service"},"type":"input","opts":{"types":["str","env"]}}},{"name":"title","type":"str","value":"","ui":{"label":{"en-US":"Title"},"type":"input","opts":{"types":["str","env"]}}},{"name":"subtitle","type":"str","value":"","ui":{"label":{"en-US":"Subtitle (optional)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"message","type":"str","value":"","ui":{"label":{"en-US":"Message"},"type":"input","opts":{"types":["str","env"]}}},{"name":"notificationUrl","type":"str","value":"","ui":{"label":{"en-US":"Notification URL (optional)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"customSoundPreInstalled","type":"str","value":"default","ui":{"label":{"en-US":"Pre-installed Custom Sound"},"type":"select","opts":{"opts":[{"l":{"en-US":"default"},"v":"default"},{"l":{"en-US":"No Sound"},"v":"none"},{"l":{"en-US":"US-EN-Alexa-Back-Door-Opened.wav"},"v":"US-EN-Alexa-Back-Door-Opened.wav"},{"l":{"en-US":"US-EN-Alexa-Back-Door-Unlocked.wav"},"v":"US-EN-Alexa-Back-Door-Unlocked.wav"},{"l":{"en-US":"US-EN-Alexa-Basement-Door-Opened.wav"},"v":"US-EN-Alexa-Basement-Door-Opened.wav"},{"l":{"en-US":"US-EN-Alexa-Basement-Door-Unlocked.wav"},"v":"US-EN-Alexa-Basement-Door-Unlocked.wav"},{"l":{"en-US":"US-EN-Alexa-Boyfriend-Is-Arriving.wav"},"v":"US-EN-Alexa-Boyfriend-Is-Arriving.wav"},{"l":{"en-US":"US-EN-Alexa-Daughter-Is-Arriving.wav"},"v":"US-EN-Alexa-Daughter-Is-Arriving.wav"},{"l":{"en-US":"US-EN-Alexa-Front-Door-Opened.wav"},"v":"US-EN-Alexa-Front-Door-Opened.wav"},{"l":{"en-US":"US-EN-Alexa-Front-Door-Unlocked.wav"},"v":"US-EN-Alexa-Front-Door-Unlocked.wav"},{"l":{"en-US":"US-EN-Alexa-Garage-Door-Opened.wav"},"v":"US-EN-Alexa-Garage-Door-Opened.wav"},{"l":{"en-US":"US-EN-Alexa-Girlfriend-Is-Arriving.wav"},"v":"US-EN-Alexa-Girlfriend-Is-Arriving.wav"},{"l":{"en-US":"US-EN-Alexa-Good-Morning.wav"},"v":"US-EN-Alexa-Good-Morning.wav"},{"l":{"en-US":"US-EN-Alexa-Good-Night.wav"},"v":"US-EN-Alexa-Good-Night.wav"},{"l":{"en-US":"US-EN-Alexa-Husband-Is-Arriving.wav"},"v":"US-EN-Alexa-Husband-Is-Arriving.wav"},{"l":{"en-US":"US-EN-Alexa-Mail-Has-Arrived.wav"},"v":"US-EN-Alexa-Mail-Has-Arrived.wav"},{"l":{"en-US":"US-EN-Alexa-Motion-At-Back-Door.wav"},"v":"US-EN-Alexa-Motion-At-Back-Door.wav"},{"l":{"en-US":"US-EN-Alexa-Motion-At-Front-Door.wav"},"v":"US-EN-Alexa-Motion-At-Front-Door.wav"},{"l":{"en-US":"US-EN-Alexa-Motion-Detected-Generic.wav"},"v":"US-EN-Alexa-Motion-Detected-Generic.wav"},{"l":{"en-US":"US-EN-Alexa-Motion-In-Back-Yard.wav"},"v":"US-EN-Alexa-Motion-In-Back-Yard.wav"},{"l":{"en-US":"US-EN-Alexa-Motion-In-Basement.wav"},"v":"US-EN-Alexa-Motion-In-Basement.wav"},{"l":{"en-US":"US-EN-Alexa-Motion-In-Front-Yard.wav"},"v":"US-EN-Alexa-Motion-In-Front-Yard.wav"},{"l":{"en-US":"US-EN-Alexa-Motion-In-Garage.wav"},"v":"US-EN-Alexa-Motion-In-Garage.wav"},{"l":{"en-US":"US-EN-Alexa-Patio-Door-Opened.wav"},"v":"US-EN-Alexa-Patio-Door-Opened.wav"},{"l":{"en-US":"US-EN-Alexa-Patio-Door-Unlocked.wav"},"v":"US-EN-Alexa-Patio-Door-Unlocked.wav"},{"l":{"en-US":"US-EN-Alexa-Smoke-Detected-Generic.wav"},"v":"US-EN-Alexa-Smoke-Detected-Generic.wav"},{"l":{"en-US":"US-EN-Alexa-Smoke-Detected-In-Basement.wav"},"v":"US-EN-Alexa-Smoke-Detected-In-Basement.wav"},{"l":{"en-US":"US-EN-Alexa-Smoke-Detected-In-Garage.wav"},"v":"US-EN-Alexa-Smoke-Detected-In-Garage.wav"},{"l":{"en-US":"US-EN-Alexa-Smoke-Detected-In-Kitchen.wav"},"v":"US-EN-Alexa-Smoke-Detected-In-Kitchen.wav"},{"l":{"en-US":"US-EN-Alexa-Son-Is-Arriving.wav"},"v":"US-EN-Alexa-Son-Is-Arriving.wav"},{"l":{"en-US":"US-EN-Alexa-Water-Detected-Generic.wav"},"v":"US-EN-Alexa-Water-Detected-Generic.wav"},{"l":{"en-US":"US-EN-Alexa-Water-Detected-In-Basement.wav"},"v":"US-EN-Alexa-Water-Detected-In-Basement.wav"},{"l":{"en-US":"US-EN-Alexa-Water-Detected-In-Garage.wav"},"v":"US-EN-Alexa-Water-Detected-In-Garage.wav"},{"l":{"en-US":"US-EN-Alexa-Water-Detected-In-Kitchen.wav"},"v":"US-EN-Alexa-Water-Detected-In-Kitchen.wav"},{"l":{"en-US":"US-EN-Alexa-Welcome-Home.wav"},"v":"US-EN-Alexa-Welcome-Home.wav"},{"l":{"en-US":"US-EN-Alexa-Wife-Is-Arriving.wav"},"v":"US-EN-Alexa-Wife-Is-Arriving.wav"},{"l":{"en-US":"US-EN-Daisy-Back-Door-Motion.wav"},"v":"US-EN-Daisy-Back-Door-Motion.wav"},{"l":{"en-US":"US-EN-Daisy-Back-Door-Open.wav"},"v":"US-EN-Daisy-Back-Door-Open.wav"},{"l":{"en-US":"US-EN-Daisy-Front-Door-Motion.wav"},"v":"US-EN-Daisy-Front-Door-Motion.wav"},{"l":{"en-US":"US-EN-Daisy-Front-Door-Open.wav"},"v":"US-EN-Daisy-Front-Door-Open.wav"},{"l":{"en-US":"US-EN-Daisy-Front-Window-Open.wav"},"v":"US-EN-Daisy-Front-Window-Open.wav"},{"l":{"en-US":"US-EN-Daisy-Garage-Door-Open.wav"},"v":"US-EN-Daisy-Garage-Door-Open.wav"},{"l":{"en-US":"US-EN-Daisy-Guest-Bath-Leak.wav"},"v":"US-EN-Daisy-Guest-Bath-Leak.wav"},{"l":{"en-US":"US-EN-Daisy-Kitchen-Sink-Leak.wav"},"v":"US-EN-Daisy-Kitchen-Sink-Leak.wav"},{"l":{"en-US":"US-EN-Daisy-Kitchen-Window-Open.wav"},"v":"US-EN-Daisy-Kitchen-Window-Open.wav"},{"l":{"en-US":"US-EN-Daisy-Laundry-Room-Leak.wav"},"v":"US-EN-Daisy-Laundry-Room-Leak.wav"},{"l":{"en-US":"US-EN-Daisy-Master-Bath-Leak.wav"},"v":"US-EN-Daisy-Master-Bath-Leak.wav"},{"l":{"en-US":"US-EN-Daisy-Master-Bedroom-Window-Open.wav"},"v":"US-EN-Daisy-Master-Bedroom-Window-Open.wav"},{"l":{"en-US":"US-EN-Daisy-Office-Window-Open.wav"},"v":"US-EN-Daisy-Office-Window-Open.wav"},{"l":{"en-US":"US-EN-Daisy-Refrigerator-Leak.wav"},"v":"US-EN-Daisy-Refrigerator-Leak.wav"},{"l":{"en-US":"US-EN-Daisy-Water-Heater-Leak.wav"},"v":"US-EN-Daisy-Water-Heater-Leak.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Back-Door-Closed.wav"},"v":"US-EN-Morgan-Freeman-Back-Door-Closed.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Back-Door-Locked.wav"},"v":"US-EN-Morgan-Freeman-Back-Door-Locked.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Back-Door-Opened.wav"},"v":"US-EN-Morgan-Freeman-Back-Door-Opened.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Back-Door-Unlocked.wav"},"v":"US-EN-Morgan-Freeman-Back-Door-Unlocked.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Basement-Door-Closed.wav"},"v":"US-EN-Morgan-Freeman-Basement-Door-Closed.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Basement-Door-Locked.wav"},"v":"US-EN-Morgan-Freeman-Basement-Door-Locked.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Basement-Door-Opened.wav"},"v":"US-EN-Morgan-Freeman-Basement-Door-Opened.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Basement-Door-Unlocked.wav"},"v":"US-EN-Morgan-Freeman-Basement-Door-Unlocked.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Boss-Is-Arriving.wav"},"v":"US-EN-Morgan-Freeman-Boss-Is-Arriving.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Boyfriend-Is-Arriving.wav"},"v":"US-EN-Morgan-Freeman-Boyfriend-Is-Arriving.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Cleaning-Supplies-Closet-Opened.wav"},"v":"US-EN-Morgan-Freeman-Cleaning-Supplies-Closet-Opened.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Coworker-Is-Arriving.wav"},"v":"US-EN-Morgan-Freeman-Coworker-Is-Arriving.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Daughter-Is-Arriving.wav"},"v":"US-EN-Morgan-Freeman-Daughter-Is-Arriving.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Friend-Is-Arriving.wav"},"v":"US-EN-Morgan-Freeman-Friend-Is-Arriving.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Front-Door-Closed.wav"},"v":"US-EN-Morgan-Freeman-Front-Door-Closed.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Front-Door-Locked.wav"},"v":"US-EN-Morgan-Freeman-Front-Door-Locked.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Front-Door-Opened.wav"},"v":"US-EN-Morgan-Freeman-Front-Door-Opened.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Front-Door-Unlocked.wav"},"v":"US-EN-Morgan-Freeman-Front-Door-Unlocked.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Garage-Door-Closed.wav"},"v":"US-EN-Morgan-Freeman-Garage-Door-Closed.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Garage-Door-Opened.wav"},"v":"US-EN-Morgan-Freeman-Garage-Door-Opened.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Girlfriend-Is-Arriving.wav"},"v":"US-EN-Morgan-Freeman-Girlfriend-Is-Arriving.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Good-Morning.wav"},"v":"US-EN-Morgan-Freeman-Good-Morning.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Good-Night.wav"},"v":"US-EN-Morgan-Freeman-Good-Night.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Liquor-Cabinet-Opened.wav"},"v":"US-EN-Morgan-Freeman-Liquor-Cabinet-Opened.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Motion-Detected.wav"},"v":"US-EN-Morgan-Freeman-Motion-Detected.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Motion-In-Basement.wav"},"v":"US-EN-Morgan-Freeman-Motion-In-Basement.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Motion-In-Bedroom.wav"},"v":"US-EN-Morgan-Freeman-Motion-In-Bedroom.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Motion-In-Game-Room.wav"},"v":"US-EN-Morgan-Freeman-Motion-In-Game-Room.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Motion-In-Garage.wav"},"v":"US-EN-Morgan-Freeman-Motion-In-Garage.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Motion-In-Kitchen.wav"},"v":"US-EN-Morgan-Freeman-Motion-In-Kitchen.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Motion-In-Living-Room.wav"},"v":"US-EN-Morgan-Freeman-Motion-In-Living-Room.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Motion-In-Theater.wav"},"v":"US-EN-Morgan-Freeman-Motion-In-Theater.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Motion-In-Wine-Cellar.wav"},"v":"US-EN-Morgan-Freeman-Motion-In-Wine-Cellar.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Patio-Door-Closed.wav"},"v":"US-EN-Morgan-Freeman-Patio-Door-Closed.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Patio-Door-Locked.wav"},"v":"US-EN-Morgan-Freeman-Patio-Door-Locked.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Patio-Door-Opened.wav"},"v":"US-EN-Morgan-Freeman-Patio-Door-Opened.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Patio-Door-Unlocked.wav"},"v":"US-EN-Morgan-Freeman-Patio-Door-Unlocked.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Roommate-Is-Arriving.wav"},"v":"US-EN-Morgan-Freeman-Roommate-Is-Arriving.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Searching-For-Car-Keys.wav"},"v":"US-EN-Morgan-Freeman-Searching-For-Car-Keys.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Setting-The-Mood.wav"},"v":"US-EN-Morgan-Freeman-Setting-The-Mood.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Smartthings-Detected-A-Flood.wav"},"v":"US-EN-Morgan-Freeman-Smartthings-Detected-A-Flood.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Smartthings-Detected-Carbon-Monoxide.wav"},"v":"US-EN-Morgan-Freeman-Smartthings-Detected-Carbon-Monoxide.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Smartthings-Detected-Smoke.wav"},"v":"US-EN-Morgan-Freeman-Smartthings-Detected-Smoke.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Smoke-Detected-In-Basement.wav"},"v":"US-EN-Morgan-Freeman-Smoke-Detected-In-Basement.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Smoke-Detected-In-Garage.wav"},"v":"US-EN-Morgan-Freeman-Smoke-Detected-In-Garage.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Smoke-Detected-In-Kitchen.wav"},"v":"US-EN-Morgan-Freeman-Smoke-Detected-In-Kitchen.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Someone-Is-Arriving.wav"},"v":"US-EN-Morgan-Freeman-Someone-Is-Arriving.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Son-Is-Arriving.wav"},"v":"US-EN-Morgan-Freeman-Son-Is-Arriving.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Starting-Movie-Mode.wav"},"v":"US-EN-Morgan-Freeman-Starting-Movie-Mode.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Starting-Party-Mode.wav"},"v":"US-EN-Morgan-Freeman-Starting-Party-Mode.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Starting-Romance-Mode.wav"},"v":"US-EN-Morgan-Freeman-Starting-Romance-Mode.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-Off-All-The-Lights.wav"},"v":"US-EN-Morgan-Freeman-Turning-Off-All-The-Lights.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-Off-The-Air-Conditioner.wav"},"v":"US-EN-Morgan-Freeman-Turning-Off-The-Air-Conditioner.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-Off-The-Bar-Lights.wav"},"v":"US-EN-Morgan-Freeman-Turning-Off-The-Bar-Lights.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-Off-The-Chandelier.wav"},"v":"US-EN-Morgan-Freeman-Turning-Off-The-Chandelier.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-Off-The-Family-Room-Lights.wav"},"v":"US-EN-Morgan-Freeman-Turning-Off-The-Family-Room-Lights.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-Off-The-Hallway-Lights.wav"},"v":"US-EN-Morgan-Freeman-Turning-Off-The-Hallway-Lights.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-Off-The-Kitchen-Light.wav"},"v":"US-EN-Morgan-Freeman-Turning-Off-The-Kitchen-Light.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-Off-The-Light.wav"},"v":"US-EN-Morgan-Freeman-Turning-Off-The-Light.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-Off-The-Lights.wav"},"v":"US-EN-Morgan-Freeman-Turning-Off-The-Lights.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-Off-The-Mood-Lights.wav"},"v":"US-EN-Morgan-Freeman-Turning-Off-The-Mood-Lights.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-Off-The-TV.wav"},"v":"US-EN-Morgan-Freeman-Turning-Off-The-TV.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-On-The-Air-Conditioner.wav"},"v":"US-EN-Morgan-Freeman-Turning-On-The-Air-Conditioner.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-On-The-Bar-Lights.wav"},"v":"US-EN-Morgan-Freeman-Turning-On-The-Bar-Lights.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-On-The-Chandelier.wav"},"v":"US-EN-Morgan-Freeman-Turning-On-The-Chandelier.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-On-The-Family-Room-Lights.wav"},"v":"US-EN-Morgan-Freeman-Turning-On-The-Family-Room-Lights.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-On-The-Hallway-Lights.wav"},"v":"US-EN-Morgan-Freeman-Turning-On-The-Hallway-Lights.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-On-The-Kitchen-Light.wav"},"v":"US-EN-Morgan-Freeman-Turning-On-The-Kitchen-Light.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-On-The-Light.wav"},"v":"US-EN-Morgan-Freeman-Turning-On-The-Light.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-On-The-Lights.wav"},"v":"US-EN-Morgan-Freeman-Turning-On-The-Lights.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-On-The-Mood-Lights.wav"},"v":"US-EN-Morgan-Freeman-Turning-On-The-Mood-Lights.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Turning-On-The-TV.wav"},"v":"US-EN-Morgan-Freeman-Turning-On-The-TV.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Vacate-The-Premises.wav"},"v":"US-EN-Morgan-Freeman-Vacate-The-Premises.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Water-Detected-In-Basement.wav"},"v":"US-EN-Morgan-Freeman-Water-Detected-In-Basement.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Water-Detected-In-Garage.wav"},"v":"US-EN-Morgan-Freeman-Water-Detected-In-Garage.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Water-Detected-In-Kitchen.wav"},"v":"US-EN-Morgan-Freeman-Water-Detected-In-Kitchen.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Welcome-Home.wav"},"v":"US-EN-Morgan-Freeman-Welcome-Home.wav"},{"l":{"en-US":"US-EN-Morgan-Freeman-Wife-Is-Arriving.wav"},"v":"US-EN-Morgan-Freeman-Wife-Is-Arriving.wav"}]}}},{"name":"customSound","type":"str","value":"","ui":{"label":{"en-US":"Custom Sound (Optional - will override pre-installed selection)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"isCriticalNotification","type":"bool","value":"false","ui":{"label":{"en-US":"Critical Notification?"},"type":"input","opts":{"types":["bool"]}}},{"name":"interruptionLevel","type":"str","value":"active","ui":{"label":{"en-US":"Interruption Level"},"type":"select","opts":{"opts":[{"l":{"en-US":"Passive (iOS 15+)"},"v":"passive"},{"l":{"en-US":"Active (Default)"},"v":"active"},{"l":{"en-US":"Time Sensitive (iOS 15+)"},"v":"time-sensitive"},{"l":{"en-US":"Critical"},"v":"critical"}]}}},{"name":"userInfo","type":"bool","value":"false","ui":{"label":{"en-US":"Populate User Information"},"type":"checkbox"}},{"name":"isClearNotificationsOnAction","type":"bool","value":"false","ui":{"label":{"en-US":"Clear notifications on Action Received?"},"type":"checkbox"}},{"name":"action1Title","type":"str","value":"","ui":{"label":{"en-US":"Action 1 Title"},"type":"input","opts":{"types":["str"]}}},{"name":"action1Uri","type":"str","value":"","ui":{"label":{"en-US":"Action 1 URL (optional)"},"type":"input","opts":{"types":["str"]}}},{"name":"action1ActivationMode","type":"str","value":"background","ui":{"label":{"en-US":"Action 1 Activation Mode"},"type":"select","opts":{"opts":[{"l":{"en-US":"Background"},"v":"background"},{"l":{"en-US":"Foreground"},"v":"foreground"}]}}},{"name":"action1AuthenticationRequired","type":"bool","value":"false","ui":{"label":{"en-US":"Action 1 App Authentication Required?"},"type":"checkbox"}},{"name":"action1Destructive","type":"bool","value":"false","ui":{"label":{"en-US":"Action 1 Destructive?"},"type":"checkbox"}},{"name":"action1Behavior","type":"str","value":"default","ui":{"label":{"en-US":"Action 1 Behavior"},"type":"select","opts":{"opts":[{"l":{"en-US":"Default"},"v":"default"},{"l":{"en-US":"Text Input"},"v":"textInput"}]}}},{"name":"action1TextInputButtonTitle","type":"str","value":"","ui":{"label":{"en-US":"Action 1 Text Input Button Title (Required if behavior is Text Input)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"action1TextInputPlaceHolder","type":"str","value":"","ui":{"label":{"en-US":"Action 1 Text Input Placeholder (Optional - only if behavior is Text Input)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"action1Icon","type":"str","value":"","ui":{"label":{"en-US":"Action 1 Icon (Optional)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"action2Title","type":"str","value":"","ui":{"label":{"en-US":"Action 2 Title"},"type":"input","opts":{"types":["str"]}}},{"name":"action2Uri","type":"str","value":"","ui":{"label":{"en-US":"Action 2 URL (optional)"},"type":"input","opts":{"types":["str"]}}},{"name":"action2ActivationMode","type":"str","value":"background","ui":{"label":{"en-US":"Action 2 Activation Mode"},"type":"select","opts":{"opts":[{"l":{"en-US":"Background"},"v":"background"},{"l":{"en-US":"Foreground"},"v":"foreground"}]}}},{"name":"action2AuthenticationRequired","type":"bool","value":"false","ui":{"label":{"en-US":"Action 2 App Authentication Required?"},"type":"checkbox"}},{"name":"action2Destructive","type":"bool","value":"false","ui":{"label":{"en-US":"Action 2 Destructive?"},"type":"checkbox"}},{"name":"action2Behavior","type":"str","value":"default","ui":{"label":{"en-US":"Action 2 Behavior"},"type":"select","opts":{"opts":[{"l":{"en-US":"Default"},"v":"default"},{"l":{"en-US":"Text Input"},"v":"textInput"}]}}},{"name":"action2TextInputButtonTitle","type":"str","value":"","ui":{"label":{"en-US":"Action 2 Text Input Button Title (Required if behavior is Text Input)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"action2TextInputPlaceHolder","type":"str","value":"","ui":{"label":{"en-US":"Action 2 Text Input Placeholder (Optional - only if behavior is Text Input)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"action2Icon","type":"str","value":"","ui":{"label":{"en-US":"Action 2 Icon (Optional)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"action3Title","type":"str","value":"","ui":{"label":{"en-US":"Action 3 Title"},"type":"input","opts":{"types":["str"]}}},{"name":"action3Uri","type":"str","value":"","ui":{"label":{"en-US":"Action 3 URL (optional)"},"type":"input","opts":{"types":["str"]}}},{"name":"action3ActivationMode","type":"str","value":"background","ui":{"label":{"en-US":"Action 3 Activation Mode"},"type":"select","opts":{"opts":[{"l":{"en-US":"Background"},"v":"background"},{"l":{"en-US":"Foreground"},"v":"foreground"}]}}},{"name":"action3AuthenticationRequired","type":"bool","value":"false","ui":{"label":{"en-US":"Action 3 App Authentication Required?"},"type":"checkbox"}},{"name":"action3Destructive","type":"bool","value":"false","ui":{"label":{"en-US":"Action 3 Destructive?"},"type":"checkbox"}},{"name":"action3Behavior","type":"str","value":"default","ui":{"label":{"en-US":"Action 3 Behavior"},"type":"select","opts":{"opts":[{"l":{"en-US":"Default"},"v":"default"},{"l":{"en-US":"Text Input"},"v":"textInput"}]}}},{"name":"action3TextInputButtonTitle","type":"str","value":"","ui":{"label":{"en-US":"Action 3 Text Input Button Title (Required if behavior is Text Input)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"action3TextInputPlaceHolder","type":"str","value":"","ui":{"label":{"en-US":"Action 3 Text Input Placeholder (Optional - only if behavior is Text Input)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"action3Icon","type":"str","value":"","ui":{"label":{"en-US":"Action 3 Icon (Optional)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"action4Title","type":"str","value":"","ui":{"label":{"en-US":"Action 4 Title"},"type":"input","opts":{"types":["str"]}}},{"name":"action4Uri","type":"str","value":"","ui":{"label":{"en-US":"Action 4 URL (optional)"},"type":"input","opts":{"types":["str"]}}},{"name":"action4ActivationMode","type":"str","value":"background","ui":{"label":{"en-US":"Action 4 Activation Mode"},"type":"select","opts":{"opts":[{"l":{"en-US":"Background"},"v":"background"},{"l":{"en-US":"Foreground"},"v":"foreground"}]}}},{"name":"action4AuthenticationRequired","type":"bool","value":"false","ui":{"label":{"en-US":"Action 4 App Authentication Required?"},"type":"checkbox"}},{"name":"action4Destructive","type":"bool","value":"false","ui":{"label":{"en-US":"Action 4 Destructive?"},"type":"checkbox"}},{"name":"action4Behavior","type":"str","value":"default","ui":{"label":{"en-US":"Action 4 Behavior"},"type":"select","opts":{"opts":[{"l":{"en-US":"Default"},"v":"default"},{"l":{"en-US":"Text Input"},"v":"textInput"}]}}},{"name":"action4TextInputButtonTitle","type":"str","value":"","ui":{"label":{"en-US":"Action 4 Text Input Button Title (Required if behavior is Text Input)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"action4TextInputPlaceHolder","type":"str","value":"","ui":{"label":{"en-US":"Action 4 Text Input Placeholder (Optional - only if behavior is Text Input)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"action4Icon","type":"str","value":"","ui":{"label":{"en-US":"Action 4 Icon (Optional)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"latitudeFirst","type":"num","value":"","ui":{"label":{"en-US":"Latitude for Pin 1"},"type":"input","opts":{"types":["num","env"]}}},{"name":"longitudeFirst","type":"num","value":"","ui":{"label":{"en-US":"Longitude for Pin 1"},"type":"input","opts":{"types":["num","env"]}}},{"name":"latitudeSecond","type":"num","value":"","ui":{"label":{"en-US":"Latitude for Pin 2"},"type":"input","opts":{"types":["num","env"]}}},{"name":"longitudeSecond","type":"num","value":"","ui":{"label":{"en-US":"Longitude for Pin 2"},"type":"input","opts":{"types":["num","env"]}}},{"name":"showLineBetweenPoints","type":"bool","value":"false","ui":{"label":{"en-US":"Show a line between points?"},"type":"input","opts":{"types":["bool","env"]}}},{"name":"showCompass","type":"bool","value":"false","ui":{"label":{"en-US":"Show a compass on the map?"},"type":"input","opts":{"types":["bool","env"]}}},{"name":"showPointsOfInterest","type":"bool","value":"false","ui":{"label":{"en-US":"Show points of interest?"},"type":"input","opts":{"types":["bool","env"]}}},{"name":"showScale","type":"bool","value":"false","ui":{"label":{"en-US":"Show scale information on the map?"},"type":"input","opts":{"types":["bool","env"]}}},{"name":"showTraffic","type":"bool","value":"false","ui":{"label":{"en-US":"Show Traffic?"},"type":"input","opts":{"types":["bool","env"]}}},{"name":"showUserLocation","type":"bool","value":"false","ui":{"label":{"en-US":"Show User Location?"},"type":"input","opts":{"types":["bool","env"]}}},{"name":"cameraEntity","type":"str","value":"","ui":{"label":{"en-US":"Camera Entity"},"type":"input","opts":{"types":["str","env"]}}},{"name":"imagePath","type":"str","value":"","ui":{"label":{"en-US":"Image Path (10MB limit)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"videoPath","type":"str","value":"","ui":{"label":{"en-US":"Video Path (50MB limit)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"audioPath","type":"str","value":"","ui":{"label":{"en-US":"Audio Path (5MB limit)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"contentUrl","type":"str","value":"","ui":{"label":{"en-US":"Content URL (overrides image/video/audio)"},"type":"input","opts":{"types":["str","env"]}}},{"name":"lazyLoading","type":"bool","value":"false","ui":{"label":{"en-US":"Load Media in Notification Lazily?"},"type":"input","opts":{"types":["bool","env"]}}},{"name":"hideThumbnail","type":"bool","value":"false","ui":{"label":{"en-US":"Hide thumbnail?"},"type":"input","opts":{"types":["bool","env"]}}}],"meta":{},"color":"#C7E9C0","outputLabels":["Action 1","Action 2","Action 3","Cleared"],"icon":"font-awesome/fa-mobile-phone","status":{"x":220,"y":320,"wires":[{"id":"f3d74762ed30ae54","port":0}]}},{"id":"3586791854cfef41","type":"function","z":"6dc0247c.d7210c","name":"create service call","func":"msg._originalPayload = msg.payload;\nlet flow_msg_variables = {\n  tag: '',\n  service: '',\n  message: msg,\n  date_created: Date.now()\n}\n\nvar xTitle = \"\";\nvar xSubtitle = \"\";\nvar xMessage = \"\";\nvar xServices = \"\";\nvar xTag = \"\";\nvar xUrl = \"\";\nvar xCameraEntity = \"\";\nvar xInterruptionLevel = \"\";\n\n// overrides\nif (typeof msg.notificationOverride !== 'undefined' && msg.notificationOverride !== null) {\n    if (typeof msg.notificationOverride.title !== 'undefined' && msg.notificationOverride.title !=='' && msg.notificationOverride.title !== null){\n        xTitle = msg.notificationOverride.title;\n    } else {\n        xTitle = env.get('title');\n    }\n    if (typeof msg.notificationOverride.subtitle !== 'undefined' && msg.notificationOverride.subtitle !==''  && msg.notificationOverride.subtitle !== null){\n        xSubtitle = msg.notificationOverride.subtitle;\n    } else {\n        xSubtitle = env.get('subtitle');\n    }\n    if (typeof msg.notificationOverride.message !== 'undefined' && msg.notificationOverride.message !=='' &&  msg.notificationOverride.message !== null){\n        xMessage = msg.notificationOverride.message;\n    } else {\n        xMessage = env.get('message');\n    }\n    if (typeof msg.notificationOverride.url !== 'undefined' && msg.notificationOverride.url !=='' &&  msg.notificationOverride.url !== null){\n        xUrl = msg.notificationOverride.url;\n    } else {\n        xUrl = env.get('notificationUrl');\n    }\n    if (typeof msg.notificationOverride.services !== 'undefined' && msg.notificationOverride.services !=='' && msg.notificationOverride.services !== null){\n        xServices = msg.notificationOverride.services;\n    } else {\n        xServices = env.get('service');\n    }\n    if (typeof msg.notificationOverride.cameraEntity !== 'undefined' && msg.notificationOverride.cameraEntity !=='' && msg.notificationOverride.cameraEntity !== null){\n        xCameraEntity = msg.notificationOverride.cameraEntity;\n    } else {\n        xCameraEntity = env.get('cameraEntity');\n    }\n    \n    if (typeof msg.notificationOverride.interruptionLevel !== 'undefined' && msg.notificationOverride.interruptionLevel !=='' && msg.notificationOverride.interruptionLevel !== null){\n        xInterruptionLevel = msg.notificationOverride.interruptionLevel;\n    } else {\n        xInterruptionLevel = env.get('interruptionLevel');\n    }\n    \n    flow_msg_variables.service=xServices;\n    if (typeof msg.notificationOverride.tag !== 'undefined' && msg.notificationOverride.tag !=='' && msg.notificationOverride.tag !== null){\n        xTag = msg.notificationOverride.tag.replace(/[^\\w\\s]/gi, '').replace(/\\s+/g,'_').toUpperCase();\n    } else {\n        if (env.get('tag') !== '') {\n            xTag = `${env.get('tag').replace(/[^\\w\\s]/gi, '').replace(/\\s+/g,'_').toUpperCase()}`;\n        } else {\n            // need to still set this to something in case clear_notification is sent.\n            xTag = `${env.get('title').replace(/[^\\w\\s]/gi, '').replace(/\\s+/g,'_').toUpperCase()}_${flow.get('random')}`;\n        } \n    }\n//support multiple tags per flow\n  flow_msg_variables.tag=xTag;\n} else {\n    // If no override is sent in...\n    if (env.get('tag') !== '') {\n        xTag = `${env.get('tag').replace(/[^\\w\\s]/gi, '').replace(/\\s+/g,'_').toUpperCase()}`;\n    } else {\n        // need to still set this to something in case clear_notification is sent.\n        xTag = `${env.get('title').replace(/[^\\w\\s]/gi, '').replace(/\\s+/g,'_').toUpperCase()}_${flow.get('random')}`;\n    } \n    //support multiple tags per flow\n    //  flow.set('tag',xTag);\n    flow_msg_variables.tag=xTag;\n    \n    xServices = env.get('service');\n    flow_msg_variables.service=xServices;\n\n    xTitle = env.get('title');\n    xSubtitle = env.get('subtitle');\n    xMessage = env.get('message');\n    xUrl = env.get('notificationUrl');\n    xCameraEntity = env.get('cameraEntity');\n    xInterruptionLevel = env.get('interruptionLevel');\n}\n\nlet all_flow_messages= flow.get('flow_messages');\nif (!all_flow_messages){\n  all_flow_messages=[];\n}\nlet new_flow_messages=[];\nfor(var i=0;i<all_flow_messages.length;i++){//copy (and reset) the messages array\n  if ((all_flow_messages[i].tag==flow_msg_variables.tag)&&(all_flow_messages[i].service==flow_msg_variables.service)){\n    continue;//don't copy this message\n  }else{\n    if (Date.now()-all_flow_messages[i].date_created<86400000){//only copy messages less than 24h old\n      new_flow_messages.push(all_flow_messages[i]);\n    }\n  }\n}\nnew_flow_messages.push(flow_msg_variables);\nflow.set('flow_messages',new_flow_messages);\n\nconst services = xServices;\nif(!services) {\n    node.status({\n        text: 'no services defined',\n        shape: 'ring',\n        fill: 'red'\n    });\n    return;    \n} else if (services == \"NOONE\"){\n    node.status({\n        text: 'No one to send to',\n        shape: 'ring',\n        fill: 'yellow'\n    });\n    return;\n}\n\n\n\n// create actions\nconst actions = [];\n[1,2,3,4].forEach(i => {\n    const name = `action${i}`\n    if (env.get(`${name}Title`) !== ''){\n        const action = env.get(`${name}Title`).replace(/[^\\w\\s]/gi, '').replace(/\\s+/g,'_').toUpperCase();\n        const title = env.get(`${name}Title`);\n        const activationMode = env.get(`${name}ActivationMode`);  \n        \n        const uri = env.get(`${name}Uri`);\n        const textInputButtonTitle = env.get(`${name}TextInputButtonTitle`);\n        const textInputPlaceholder = env.get(`${name}TextInputPlaceHolder`);\n        const authenticationRequired = env.get(`${name}AuthenticationRequired`);\n        const destructive = env.get(`${name}Destructive`);\n        const behavior = env.get(`${name}Behavior`);\n        const icon = env.get(`${name}Icon`);\n        \n        const actionObject = {};\n        actionObject.action = action;\n        actionObject.title = title;\n        actionObject.activationMode = activationMode;\n        \n        if (uri != \"\") actionObject.uri = uri;\n        if (textInputButtonTitle != \"\") actionObject.textInputButtonTitle = textInputButtonTitle;\n        if (textInputPlaceholder != \"\") actionObject.textInputPlaceholder = textInputPlaceholder;\n        if (authenticationRequired != \"\") actionObject.authenticationRequired = authenticationRequired;\n        if (destructive != \"\") actionObject.destructive = destructive;\n        if (behavior != \"\") actionObject.behavior = behavior;\n        if (icon != \"\") actionObject.icon = icon;\n        \n        actions.push(actionObject);\n    }\n});\n\n// create msg object\n\nmsg.payload = {\n        domain: 'notify',\n        data: {\n            title: xTitle,\n            message: xMessage,\n            data: {\n                push: {},\n                tag: xTag\n            }\n        }\n    };\n\nif (actions.length > 0) {\n    msg.payload.data.data.action_data = {tag: xTag};\n    msg.payload.data.data.actions = actions;\n    \n}\n\n\n// notification url\nif (xUrl !== \"\") {\n    msg.payload.data.data.url = {};\n    msg.payload.data.data.url = xUrl;\n}\n\n// subtitle\nif (xSubtitle !== '') {\n    msg.payload.data.data.subtitle = xSubtitle;\n}\n\n// sound information\nmsg.payload.data.data.push.sound = {};\nif (env.get('customSound').length > 0){\n    msg.payload.data.data.push.sound.name = env.get('customSound');\n} else if (env.get('customSoundPreInstalled').length > 0) {\n  if(env.get('customSoundPreInstalled')=='none'){\n    msg.payload.data.data.push.sound = 'none';\n  }else{\n    msg.payload.data.data.push.sound.name = env.get('customSoundPreInstalled');\n  }\n} else {\n    msg.payload.data.data.push.sound.name = 'default';\n}\n\nif (env.get('isCriticalNotification')) {\n    msg.payload.data.data.push.sound.critical = 1;\n    msg.payload.data.data.push.sound.volume = 1.0;\n    msg.payload.data.data.push[\"interruption-level\"] = 'critical';\n} else {\n    // interruption level\n    if (xInterruptionLevel !== '') {\n        msg.payload.data.data.push[\"interruption-level\"] = xInterruptionLevel;\n        if (xInterruptionLevel == 'critical'){\n            msg.payload.data.data.push.sound.critical = 1;\n            msg.payload.data.data.push.sound.volume = 1.0;\n        }\n    }\n}\n\n \n\n// overrides interruption level\nif (env.get('isCriticalNotification') == true) {\n    \n}\n\n// group thread id\nif (env.get('group') !== '') {\n    msg.payload.data.data.group = env.get('group');\n}\n\n// Map Information\nif (env.get('latitudeFirst') !== 0 && env.get('longitudeFirst') !== 0){\n    msg.payload.data.data.action_data.latitude = env.get('latitudeFirst');\n    msg.payload.data.data.action_data.longitude = env.get('longitudeFirst');\n    if (env.get('latitudeSecond') !== 0 && env.get('longitudeSecond') !== 0){\n        msg.payload.data.data.action_data.second_latitude = env.get('latitudeSecond');\n        msg.payload.data.data.action_data.second_longitude = env.get('longitudeSecond');\n        // add in all the extras, which default to false.\n        msg.payload.data.data.action_data.shows_line_between_points = env.get('showLineBetweenPoints');\n        msg.payload.data.data.action_data.shows_compass = env.get('showCompass');\n        msg.payload.data.data.action_data.shows_points_of_interest = env.get('showPointsOfInterest');\n        msg.payload.data.data.action_data.shows_scale = env.get('showScale');\n        msg.payload.data.data.action_data.shows_traffic = env.get('showTraffic');\n        msg.payload.data.data.action_data.shows_user_location = env.get('showUserLocation');\n    }\n}\n// camera information\nif (xCameraEntity !== '') {\n    msg.payload.data.data.entity_id = xCameraEntity;\n}\n// media information\nif (env.get('contentUrl') !== '') {\n\n} else {\n    if (env.get('imagePath') !== '') {\n        msg.payload.data.data.image = env.get('imagePath');\n    }\n    if (env.get('videoPath') !== '') {\n        msg.payload.data.data.video = env.get('videoPath');\n    }\n    if (env.get('audioPath') !== '') {\n        msg.payload.data.data.audio = env.get('audioPath');\n    }\n}\nif (env.get('contentUrl') !== '' || env.get('imagePath') !== '' || env.get('videoPath') !== '' || env.get('audioPath') !== '') {\n    if (env.get('lazyLoading')) {\n        msg.payload.data.data.lazy = env.get('lazyLoading');\n    }\n    if (env.get('hideThumbnail')) {\n        msg.payload.data.data.attachment = {};\n        msg.payload.data.data.attachment['hide-thumbnail'] = env.get('hideThumbnail');\n    }\n}\n\nservices.trim().split(/,\\s*/).forEach(service => {\n    if(!service) return;\n    msg.payload.service = service;\n    node.send(msg);\n});\n\nnode.done();","outputs":1,"noerr":0,"initialize":"flow.set('random',Math.random().toString(36).replace(/[^a-z]+/g, '').substr(0, 5).toUpperCase());","finalize":"","libs":[],"x":430,"y":80,"wires":[["84115d3979a0b0b6"]]},{"id":"90ab222038404541","type":"switch","z":"6dc0247c.d7210c","name":"which action?","property":"responseIndex","propertyType":"flow","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"},{"t":"eq","v":"3","vt":"num"},{"t":"eq","v":"4","vt":"num"}],"checkall":"true","repair":false,"outputs":4,"x":1280,"y":380,"wires":[[],[],[],[]]},{"id":"f3d74762ed30ae54","type":"status","z":"6dc0247c.d7210c","name":"","scope":["3586791854cfef41","b1e2e20511543565","fcf9f9c27469a607","6fdf5748e207aa7e"],"x":100,"y":320,"wires":[[]]},{"id":"b1e2e20511543565","type":"function","z":"6dc0247c.d7210c","name":"build message","func":"const latestMessage = flow.get('latestMessage');\nconst event = msg.payload.event;\n\nlatestMessage.payload = latestMessage._originalPayload;\nlatestMessage.eventData = msg.payload;\ndelete latestMessage._originalPayload;\n\nif(env.get('userInfo')) {\n    const userData = msg.userData.find(u => u.id === msg.payload.context.user_id);\n    latestMessage.userData = userData;\n}\n\nconst index = [1,2,3,4].find(i => env.get(`action${i}Title`).replace(/[^\\w\\s]/gi, '').replace(/\\s+/g,'_').toUpperCase() === event.actionName);\nflow.set(\"responseIndex\",index);\nnode.status({\n    text: `${env.get(`action${index}Title`).replace(/[^\\w\\s]/gi, '').replace(/\\s+/g,'_').toUpperCase()} at: ${getPrettyDate()}`,\n    shape: 'dot',\n    fill: 'green'\n});\n\nreturn latestMessage;\n\n\nfunction getPrettyDate() {\n    return new Date().toLocaleDateString('en-US', {\n        month: 'short',\n        day: 'numeric',\n        hour12: false,\n        hour: 'numeric',\n        minute: 'numeric',\n    });\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1080,"y":380,"wires":[["90ab222038404541"]]},{"id":"7bc5c379b10a2fbf","type":"ha-api","z":"6dc0247c.d7210c","name":"get user info","server":"f43d015e.4b29","version":1,"debugenabled":false,"protocol":"websocket","method":"get","path":"","data":"{\"type\": \"config/auth/list\"}","dataType":"json","responseType":"json","outputProperties":[{"property":"userData","propertyType":"msg","value":"","valueType":"results"}],"x":950,"y":320,"wires":[["b1e2e20511543565"]]},{"id":"c25a82298fbaad78","type":"switch","z":"6dc0247c.d7210c","name":"fetch user info?","property":"userInfo","propertyType":"env","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":800,"y":380,"wires":[["7bc5c379b10a2fbf"],["b1e2e20511543565"]]},{"id":"b738bc2e474ec4a5","type":"server-events","z":"6dc0247c.d7210c","name":"ios.notification_action_fired","server":"f43d015e.4b29","version":1,"event_type":"ios.notification_action_fired","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"},{"property":"event_type","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"}],"x":164,"y":256,"wires":[["86b12904f73a0329"]]},{"id":"fcf9f9c27469a607","type":"api-call-service","z":"6dc0247c.d7210c","name":"Send Notifications","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"notify","service":"","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"callServiceData","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":830,"y":80,"wires":[[]]},{"id":"6fdf5748e207aa7e","type":"function","z":"6dc0247c.d7210c","name":"create CLEAR service call","func":"msg._originalPayload = msg.payload;\nvar tag_to_clear = \"\";\nvar services = \"\";\nvar clearAll = false;\nif (typeof msg.notificationOverride !== 'undefined') {\n    if (typeof msg.notificationOverride.clear !== 'undefined' && msg.notificationOverride.clear !== null && msg.notificationOverride.clear) {\n        clearAll = true;\n    }\n    if (typeof msg.notificationOverride.services !== 'undefined' && msg.notificationOverride.services !== null && msg.notificationOverride.services){\n        services = msg.notificationOverride.services;\n    }\n    if (typeof msg.notificationOverride.tag !== 'undefined' && msg.notificationOverride.tag !== null && msg.notificationOverride.tag){\n        tag_to_clear = msg.notificationOverride.tag.replace(/[^\\w\\s]/gi, '').replace(/\\s+/g,'_').toUpperCase();//formatting tags as sent to the phone before\n    }\n}\n\nif (tag_to_clear==\"\"){//no specific tag sent, clear the last message.\n  var all_flow_messages= flow.get('flow_messages');\n  if(all_flow_messages) {\n    var last_message= all_flow_messages.pop();\n    if (last_message){//on nodeRED restart\n      tag_to_clear= last_message.tag;\n      services = last_message.service;//override service to the one used in last message sent\n      flow.set('flow_messages',all_flow_messages);//clear the message from memory\n    }\n  }\n}\n\nif(services==\"\") {\n    node.status({\n        text: 'no services defined',\n        shape: 'ring',\n        fill: 'red'\n    });\n    return;    \n}\n\nif(tag_to_clear==\"\") {\n  node.status({\n    text: 'no messages to delete',\n    shape: 'ring',\n    fill: 'red'\n  });\n  return;  \n}\n\n// create ios msg object\n\nmsg.payload = {\n        domain: 'notify',\n        data: {\n            message: \"clear_notification\",\n            data: {\n                tag: tag_to_clear\n            }\n        }\n    };\n\nfunction getPrettyDate() {\n    return new Date().toLocaleDateString('en-US', {\n        month: 'short',\n        day: 'numeric',\n        hour12: false,\n        hour: 'numeric',\n        minute: 'numeric',\n    });\n}\n\nif (clearAll){\n    delete msg.notificationOverride;\n}\n    \nvar xCountCleared = 0;\nservices.trim().split(/,\\s*/).forEach(service => {\n    if(!service) return;\n    // only clear on devices that didn't send the event.\n    if (clearAll){\n        msg.payload.service = service;\n        node.send(msg);\n        xCountCleared++;\n    } else if (!service.includes(msg._originalPayload.event.sourceDeviceID)){\n        msg.payload.service = service;\n        node.send(msg);\n        xCountCleared++;\n    }\n});\nif (xCountCleared > 0) {\n    node.status({\n        text: `${xCountCleared} messages cleared at: ${getPrettyDate()}`,\n        shape: 'dot',\n        fill: 'blue'\n    });\n} else {\n    node.status({\n        text: `No messages cleared: ${getPrettyDate()}`,\n        shape: 'dot',\n        fill: 'red'\n    });\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":750,"y":220,"wires":[["05b8370d35105d3c"]]},{"id":"a69ed312811b3a6d","type":"switch","z":"6dc0247c.d7210c","name":"Clear Notification on Action?","property":"isClearNotificationsOnAction","propertyType":"env","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":460,"y":320,"wires":[["6fdf5748e207aa7e","227a6ab8de989095"],["c25a82298fbaad78"]]},{"id":"e229e2d8efb85d22","type":"api-call-service","z":"6dc0247c.d7210c","name":"Clear Notifications","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"notify","service":"","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"callServiceData","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1190,"y":140,"wires":[[]]},{"id":"227a6ab8de989095","type":"delay","z":"6dc0247c.d7210c","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":720,"y":320,"wires":[["c25a82298fbaad78"]]},{"id":"6b940f2bfba5188c","type":"switch","z":"6dc0247c.d7210c","name":"clear?","property":"notificationOverride.clear","propertyType":"msg","rules":[{"t":"istype","v":"undefined","vt":"undefined"},{"t":"null"},{"t":"false"},{"t":"true"}],"checkall":"false","repair":false,"outputs":4,"x":210,"y":80,"wires":[["3586791854cfef41"],["3586791854cfef41"],["3586791854cfef41"],["6fdf5748e207aa7e"]]},{"id":"05b8370d35105d3c","type":"delay","z":"6dc0247c.d7210c","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":970,"y":160,"wires":[["e229e2d8efb85d22"]]},{"id":"84115d3979a0b0b6","type":"delay","z":"6dc0247c.d7210c","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":630,"y":80,"wires":[["fcf9f9c27469a607"]]},{"id":"86b12904f73a0329","type":"function","z":"6dc0247c.d7210c","name":"belongs here?","func":"let msg_tag=msg.payload.event.action_data.tag;\nlet all_flow_messages= flow.get('flow_messages');\nif(all_flow_messages){\n    for (var i=0;i<all_flow_messages.length;i++){\n        if (all_flow_messages[i].tag.trim()==msg_tag.trim()){\n            flow.set('latestMessage',all_flow_messages[i].message);\n            return [msg,null];\n        }\n    }\n}\nreturn [null,msg];\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":400,"y":260,"wires":[["a69ed312811b3a6d"],[]]},{"id":"19066ee6e6da335a","type":"server-state-changed","z":"0c8b275e7a34a25c","g":"76df181a3cc2f2fc","name":"In Meeting?","server":"f43d015e.4b29","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.sam_s_mac_mini_active_audio_input","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":110,"y":440,"wires":[["9f7094f7af59e95f"],[]]},{"id":"824364bea194606b","type":"server-state-changed","z":"0c8b275e7a34a25c","g":"76df181a3cc2f2fc","name":"In Meeting?","server":"f43d015e.4b29","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.sam_s_mac_mini_active_camera","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":110,"y":500,"wires":[["9f7094f7af59e95f"],[]]},{"id":"9f7094f7af59e95f","type":"api-call-service","z":"0c8b275e7a34a25c","g":"76df181a3cc2f2fc","name":"Capture Scene","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"scene","service":"create","areaId":[],"deviceId":[],"entityId":[],"data":"{\"scene_id\":\"premeeting\",\"snapshot_entities\":\"light.office_leds\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":300,"y":460,"wires":[["6207327b28e05dcd"]]},{"id":"6207327b28e05dcd","type":"api-call-service","z":"0c8b275e7a34a25c","g":"76df181a3cc2f2fc","name":"Meeting Scene","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"scene","service":"turn_on","areaId":[],"deviceId":[],"entityId":["scene.office_meeting"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":500,"y":460,"wires":[["73c665fd127a2b29"]]},{"id":"53edba07177a1d3f","type":"server-state-changed","z":"0c8b275e7a34a25c","g":"76df181a3cc2f2fc","name":"Meeting Finished?","server":"f43d015e.4b29","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.sam_s_mac_mini_active_audio_input","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"5","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":130,"y":560,"wires":[["5e9d3a41a63a5db4"],[]]},{"id":"894c2646c144064a","type":"server-state-changed","z":"0c8b275e7a34a25c","g":"76df181a3cc2f2fc","name":"Meeting Finished?","server":"f43d015e.4b29","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.sam_s_mac_mini_active_camera","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"5","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":130,"y":620,"wires":[["5e9d3a41a63a5db4"],[]]},{"id":"4586b621b7692fef","type":"api-call-service","z":"0c8b275e7a34a25c","g":"76df181a3cc2f2fc","name":"Return Scene","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"scene","service":"turn_on","areaId":[],"deviceId":[],"entityId":["scene.premeeting"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":500,"y":560,"wires":[["d0855e19f896afe2"]]},{"id":"5e9d3a41a63a5db4","type":"api-current-state","z":"0c8b275e7a34a25c","g":"76df181a3cc2f2fc","name":"Mac On?","server":"f43d015e.4b29","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.sam_s_mac_mini_active","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":320,"y":560,"wires":[["4586b621b7692fef"],["d0855e19f896afe2"]]},{"id":"73c665fd127a2b29","type":"api-current-state","z":"0c8b275e7a34a25c","g":"76df181a3cc2f2fc","name":"Leah Out?","server":"f43d015e.4b29","version":3,"outputs":2,"halt_if":"away","halt_if_type":"str","halt_if_compare":"is","entity_id":"person.leah","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":690,"y":460,"wires":[["de24f97454d497fb"],[]]},{"id":"de24f97454d497fb","type":"subflow:6dc0247c.d7210c","z":"0c8b275e7a34a25c","g":"76df181a3cc2f2fc","name":"","env":[{"name":"group","value":"","type":"str"},{"name":"service","value":"mobile_app_leah_s_iphone","type":"str"},{"name":"title","value":"Sam is in a Meeting","type":"str"},{"name":"message","value":"Shhhhhhhhhhhhhhhhh","type":"str"},{"name":"notificationUrl","value":"/calendar","type":"str"},{"name":"isClearNotificationsOnAction","type":"bool","value":"true"},{"name":"action1Title","value":"Check Calendar","type":"str"},{"name":"action1Uri","value":"/calendar","type":"str"},{"name":"action2Title","value":"Let me know when finished","type":"str"}],"x":480,"y":720,"wires":[[],["4d664383a521c324"],[],[]]},{"id":"4d664383a521c324","type":"ha-wait-until","z":"0c8b275e7a34a25c","g":"76df181a3cc2f2fc","name":"Meeting Finished?","server":"f43d015e.4b29","version":1,"outputs":1,"entityId":"sensor.sam_s_mac_mini_active_camera","entityIdFilterType":"exact","property":"state","comparator":"is","value":"off","valueType":"str","timeout":"0","timeoutType":"num","timeoutUnits":"minutes","entityLocation":"data","entityLocationType":"none","checkCurrentState":true,"blockInputOverrides":true,"x":730,"y":720,"wires":[["31f941d4bba4734f"]]},{"id":"31f941d4bba4734f","type":"ha-wait-until","z":"0c8b275e7a34a25c","g":"76df181a3cc2f2fc","name":"Meeting Finished?","server":"f43d015e.4b29","version":1,"outputs":1,"entityId":"binary_sensor.sam_s_mac_mini_audio_input_in_use","entityIdFilterType":"exact","property":"state","comparator":"is","value":"off","valueType":"str","timeout":"0","timeoutType":"num","timeoutUnits":"minutes","entityLocation":"data","entityLocationType":"none","checkCurrentState":true,"blockInputOverrides":true,"x":930,"y":720,"wires":[["b1668861914488f6"]]},{"id":"b1668861914488f6","type":"api-call-service","z":"0c8b275e7a34a25c","g":"76df181a3cc2f2fc","name":"Notify Finished","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"notify","service":"mobile_app_leah_s_iphone","areaId":[],"deviceId":[],"entityId":[],"data":"{\"message\":\"He's Finished\",\"title\":\"Meeting is Finished\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1140,"y":720,"wires":[[]]},{"id":"f43d015e.4b29","type":"server","name":"Home Assistant","version":4,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true,"cacheJson":true,"heartbeat":false,"heartbeatInterval":30,"areaSelector":"friendlyName","deviceSelector":"friendlyName","entitySelector":"friendlyName","statusSeparator":"at: ","statusYear":"hidden","statusMonth":"short","statusDay":"numeric","statusHourCycle":"h23","statusTimeFormat":"h:m"}]
</details>

&nbsp;&nbsp;_which uses:_

- [Node-RED Add-On](https://github.com/hassio-addons/addon-node-red)

  </details></details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/lighting/office/off.yaml">Off</a></b></summary><blockquote>
<b><i>Automation to turn off all office lights.</b></i>

</blockquote></details></details>

<!-- PARTY LIGHTING AUTOMATIONS -->
  
<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/tree/master/automations/lighting/party">Party üéâ Lighting</a></b></summary><blockquote>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/lighting/party/on.yaml">Party On</a></b></summary><blockquote>
<b><i>Automation to activate party mode which alternates lighting using a script.</b></i>

&nbsp;&nbsp;_which uses:_

- [input_boolean.party](https://github.com/smcnab1/op-question-mark/blob/master/entities/input_boolean/party.yaml)
- [script.party_on](https://github.com/smcnab1/op-question-mark/blob/master/entities/scripts/party_on.yaml)
- [script.party_lighting](https://github.com/smcnab1/op-question-mark/blob/master/entities/scripts/party_lighting.yaml)</details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/lighting/party/off.yaml">Party Off</a></b></summary><blockquote>
<b><i>Automation to de-activate party mode.</b></i>

&nbsp;&nbsp;_which uses:_

- [input_boolean.party](https://github.com/smcnab1/op-question-mark/blob/master/entities/input_boolean/party.yaml)
- [script.party_off](https://github.com/smcnab1/op-question-mark/blob/master/entities/scripts/party_off.yaml)
- [script.party_lighting](https://github.com/smcnab1/op-question-mark/blob/master/entities/scripts/party_lighting.yaml)</details>

</blockquote></details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/lighting/tag_lights_off.yaml">Tag All Off</a></b></summary><blockquote>
<b><i>Automation to turn all lights off using NFC Tags next to our bed.</b></i>

&nbsp;&nbsp;_which uses:_

- [HA NFC Tag Integration](https://www.home-assistant.io/blog/2020/09/15/home-assistant-tags/) </details>
</blockquote></details>

<!-- TRANSPORT AUTOMATIONS -->
  <a name="transport"></a>
  
<details><summary><b><a href="https://github.com/smcnab1/op-question-mark/tree/master/automations/transport">Transport üöåüöù Automations (7 automations)</a></b></summary><blockquote>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/transport/car_wash_notify.yaml">Car Wash Notify</a></b></summary>
<b><i>Using the car wash input boolean to predict upcoming weather to see if it is worth washing my car or not. Then providing options as to either book car wash at home or show me navigation to nearest car wash.</b></i>

&nbsp;&nbsp;_which uses:_

- [binary_sensor.car_wash](https://github.com/smcnab1/op-question-mark/blob/master/entities/binary_sensor/car_wash.yaml)
- [HA Actionable Notifications](https://companion.home-assistant.io/docs/notifications/actionable-notifications/)
- [Car Wash Binary Sensor Integration (HACS)](https://github.com/Limych/ha-car_wash) </details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/transport/citymapper_notify_leah_random.yaml">Citymapper Notify Wife (Random)</a></b></summary>
<b><i>Automation triggered by dashboard pushing actionable notification to wifes phone to input end location from current location on the <a href="https://citymapper.com/?lang=en">Citymapper Mobile App.</a></b></i>

&nbsp;&nbsp;_which uses:_

- [Citymapper URL API](https://citymapper.com/tools/1053/launch-citymapper-for-directions)
- [HA Actionable Notifications](https://companion.home-assistant.io/docs/notifications/actionable-notifications/)
- [Home Assistant Dashboard](https://github.com/smcnab1/op-question-mark/tree/master/ui_lovelace_minimalist/dashboard/adaptive-dash/views-tablet)</details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/transport/citymapper_notify_leah_work.yaml">Citymapper Notify Wife (Work)</a></b></summary>
<b><i>Automation triggered by dashboard pushing actionable notification to wifes phone to work which auto populates directions from current location on the <a href="https://citymapper.com/?lang=en">Citymapper Mobile App.</a></b></i>

&nbsp;&nbsp;_which uses:_

- [Citymapper URL API](https://citymapper.com/tools/1053/launch-citymapper-for-directions)
- [HA Actionable Notifications](https://companion.home-assistant.io/docs/notifications/actionable-notifications/)
- [Home Assistant Dashboard](https://github.com/smcnab1/op-question-mark/tree/master/ui_lovelace_minimalist/dashboard/adaptive-dash/views-tablet)</details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/transport/citymapper_notify_sam_random.yaml">Citymapper Notify Sam (Random)</a></b></summary>
<b><i>Automation triggered by dashboard pushing actionable notification to my phone to input end location from current location on the <a href="https://citymapper.com/?lang=en">Citymapper Mobile App.</a></b></i>

&nbsp;&nbsp;_which uses:_

- [Citymapper URL API](https://citymapper.com/tools/1053/launch-citymapper-for-directions)
- [HA Actionable Notifications](https://companion.home-assistant.io/docs/notifications/actionable-notifications/)
- [Home Assistant Dashboard](https://github.com/smcnab1/op-question-mark/tree/master/ui_lovelace_minimalist/dashboard/adaptive-dash/views-tablet)</details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/transport/waze_camden.yaml">Waze to Work x2</a></b></summary>
<b><i>2x automations triggered by dashboard pushing actionable notification to my phone that automatically navigates to two work locations with the <a href="https://www.waze.com/en-GB/live-map/">Waze Mobile App.</a></b></i>

&nbsp;&nbsp;_which uses:_

- [Waze URL API](https://developers.google.com/waze/deeplinks)
- [HA Actionable Notifications](https://companion.home-assistant.io/docs/notifications/actionable-notifications/)
- [Home Assistant Dashboard](https://github.com/smcnab1/op-question-mark/tree/master/ui_lovelace_minimalist/dashboard/adaptive-dash/views-tablet) </details>

</blockquote></details>

<!-- HA-SYSTEM AUTOMATIONS -->
  <a name="hasystem"></a>
<details><summary><b><a href="https://github.com/smcnab1/op-question-mark/tree/master/automations/ha_system">HA-System ‚è∞üñ•Ô∏è Automations (6 automations)</a></b></summary><blockquote>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/ha_system/fan_control.yaml">Server Cabinet Fan Control</a></b></summary>
<b><i>Controls server cabinet temperature using temperature sensor and USB fans in Sonoff USB plugs</b></i>

    </details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/ha_system/git_auto_update.yaml">Git Auto Update</a></b></summary>
<b><i>Script that automatically updates github at 23:23:23 everyday to keep repo up-to-date.</b></i>

&nbsp;&nbsp;_which uses:_

- [ha_gitpush.sh](***)</details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/ha_system/restart_complete_notify.yaml">Restart Complete Notify</a></b></summary>
<b><i>Automation which sends notification to my mac and google hubs through TTS to alert us that system restart has been complete and now back up. Gives the wife a heads up that things are now working and gives me actionable notification to open HA from notification on PC.</b></i>

&nbsp;&nbsp;_which uses:_

- [Nabu-Casa TTS Cloud](https://www.nabucasa.com/config/tts/)
- [HA Actionable Notifications](https://companion.home-assistant.io/docs/notifications/actionable-notifications/)
</details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/ha_system/shutdown_pre_notify.yaml">Pre-Shutdown Notify</a></b></summary>
<b><i>Automation which sends notification to my mac, wifes phone and google hubs through TTS to alert us that system is restarting. Gives the wife a heads up that things won't work for a few minutes.</b></i>

&nbsp;&nbsp;_which uses:_

- [Nabu-Casa TTS Cloud](https://www.nabucasa.com/config/tts/)
- [HA Actionable Notifications](https://companion.home-assistant.io/docs/notifications/actionable-notifications/) </details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/ha_system/update_notify.yaml">System Updates Notify</a></b></summary>
<b><i>Provides notifications for all system notifications including HACS and Add-Ons. Sensors are also pushed to the HA Dashboard.</b></i>

&nbsp;&nbsp;_which uses:_

- [HA Supervisor Update Sensors](https://www.home-assistant.io/integrations/hassio)
- [HA Actionable Notifications](https://companion.home-assistant.io/docs/notifications/actionable-notifications/)
- [Home Assistant Dashboard](https://github.com/smcnab1/op-question-mark/tree/master/ui_lovelace_minimalist/dashboard/adaptive-dash/views-tablet)
- [Update Notifications Blueprint](https://github.com/smcnab1/op-question-mark/blob/master/blueprints/automation/mdegat01/update_notifications.yaml) </details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/ha_system/tablet_charging.yaml">Tablet Charging</a></b></summary>
<b><i>Automation to trigger dashboard tablet's charging schedule. When battery level gets below 40%, charging begins. When above 90%, charging stops.</b></i>

&nbsp;&nbsp;_which uses:_

- [Fully Kiosk Browswer Integration](https://github.com/cgarwood/homeassistant-fullykiosk)
- [Wall Panel Battery Blueprint](https://github.com/smcnab1/op-question-mark/blob/master/blueprints/automation/seamus65/wallpanel-battery-management.yaml)</details>

</blockquote></details>

<!-- MEDIA AUTOMATIONS -->
  <a name="media"></a>
<details><summary><b><a href="https://github.com/smcnab1/op-question-mark/tree/master/automations/media">Media üîäüì∫ Automations (5 automations)</a></b></summary><blockquote>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/media/tv_controller_notify.yaml">TV Control Notify</a></b></summary>
<b><i>Automation which sends actionable notification to open Smartthings Remote App to control TV when switched on.</b></i>

&nbsp;&nbsp;_which uses:_

- [HA Actionable Notifications](https://companion.home-assistant.io/docs/notifications/actionable-notifications/)
- [Samsung SmartTV Integration](https://github.com/ollo69/ha-samsungtv-smart) </details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/media/sam_night_notification.yaml">Night Reminder</a></b></summary>
<b><i>Automation which triggers at 21:30 to remind me to get off my PC if I am still on it. Using flashing red lights, TTS & Actionable Notification through my PC.</b></i>

&nbsp;&nbsp;_which uses:_

- [Nabu-Casa TTS Cloud](https://www.nabucasa.com/config/tts/)
- [HA Actionable Notifications](https://companion.home-assistant.io/docs/notifications/actionable-notifications/)</details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/media/hurry_up_sam_notify.yaml">XBOX Hurry Up Notify</a></b></summary>
<b><i>Automation which sends notification to wifes phone when I turn on my XBOX and she is home. Uses actionable notifications to trigger a hurry up <a href="https://github.com/smcnab1/op-question-mark/blob/master/automations/media/hurry_up_sam_actions.yaml">automation.</a></b></i>

&nbsp;&nbsp;_which uses:_

- [Nabu-Casa TTS Cloud](https://www.nabucasa.com/config/tts/)
- [HA Actionable Notifications](https://companion.home-assistant.io/docs/notifications/actionable-notifications/)
- [HA XBOX Integration](https://www.home-assistant.io/integrations/xbox/)
</details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/media/hurry_up_sam_actions.yaml">XBOX Hurry Up Actions</a></b></summary>
<b><i>Automation which is triggered by the wife through actionable notification. Flashes lights in office red and plays TTS through google home telling me to hurry up. Also sends me a notification on PC on other monitor.</b></i>

&nbsp;&nbsp;_which uses:_

- [Nabu-Casa TTS Cloud](https://www.nabucasa.com/config/tts/)
- [HA Actionable Notifications](https://companion.home-assistant.io/docs/notifications/actionable-notifications/)
- [HA XBOX Integration](https://www.home-assistant.io/integrations/xbox/) </details>
  
<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/media/volume_auto_set.yaml">Auto Volume Set</a></b></summary>
<b><i>Automation requested by the wife to automatically set the volume of all google home's so that we can listen to music when sleeping at a pre-set volume.</b></i> </details>

</blockquote></details>

<!-- TTS AUTOMATIONS -->
<a name="tts"></a>
<details><summary><b><a href="https://github.com/smcnab1/op-question-mark/tree/master/automations/tts">TTS üîäüì± Automations (4 automations)</a></b></summary><blockquote>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/tts/leah_morning_briefing.yaml">Wife Morning Briefing</a></b></summary>
<b><i>Automation which sends TTS morning briefing for wife when she gets up for work. Provides update on weather and travel time. Then plays relaxing music from Spotify.</b></i>

&nbsp;&nbsp;_which uses:_

- [Nabu-Casa TTS Cloud](https://www.nabucasa.com/config/tts/)
- [Spotify Integration](https://www.home-assistant.io/integrations/spotify/) </details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/tts/input_push_bedroom.yaml">TTS Input Bedroom</a></b></summary>
<b><i>Automation that sends input from HA Dashboard to Google Hub Mini's as TTS Message.</b></i>

&nbsp;&nbsp;_which uses:_

- [Nabu-Casa TTS Cloud](https://www.nabucasa.com/config/tts/)
- [Home Assistant Dashboard](https://github.com/smcnab1/op-question-mark/tree/master/ui_lovelace_minimalist/dashboard/adaptive-dash/views-tablet)</details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/tts/input_push_living_room.yaml">TTS Input Living Room</a></b></summary>
<b><i>Automation that sends input from HA Dashboard to Google Hub Mini's as TTS Message.</b></i>

&nbsp;&nbsp;_which uses:_

- [Nabu-Casa TTS Cloud](https://www.nabucasa.com/config/tts/)
- [Home Assistant Dashboard](https://github.com/smcnab1/op-question-mark/tree/master/ui_lovelace_minimalist/dashboard/adaptive-dash/views-tablet)</details>

<details><summary><b><a name="https://github.com/smcnab1/op-question-mark/blob/master/automations/tts/welcome_home_message.yaml">TTS Welcome Home Message</a></b></summary>
<b><i>Automation which triggers TTS Briefing when arriving back at home. Pulls person who arrives home into the automation for personalised message.</b></i>

&nbsp;&nbsp;_which uses:_

- [Nabu-Casa TTS Cloud](https://www.nabucasa.com/config/tts/)
- [HA Actionable Notifications](https://companion.home-assistant.io/docs/notifications/actionable-notifications/) </details>

</blockquote></details>

<!-- SLEEPING AUTOMATIONS -->
  <a name="sleep"></a>
<details><summary><b>Sleeping üõèÔ∏èüì° Automations (1 automations)</b></summary><blockquote>

<details><summary><b>Sleeping Toggle Management</b></summary><blockquote>
<b><i>Automation which works with presense sensors, pressure sensors and location to identify when we are sleeping to use in automations etc.</b></i>

![Node-Red Flow](https://i.imgur.com/rNESDko.png)

<details><summary>Node-Red Code</summary><blockquote>
[{"id":"6e0637a92024e97a","type":"group","z":"cdd59c9d83846168","name":"Bed Sensor Control","style":{"label":true},"nodes":["594b179734804509","8a8acaa98d476bff","546da122fe24161c","934f749c9cf008ef","a8146ffcf68f5f5e","a3969041aa39c0ca","14d952390185890f","3fe19f20e16b2ad9","c0fd77c0c1859d2e","c7565947a8c99983","7810e1359aaade77","584434e5093fe849"],"x":14,"y":19,"w":812,"h":202},{"id":"594b179734804509","type":"server-state-changed","z":"cdd59c9d83846168","g":"6e0637a92024e97a","name":"Sam in Bed","server":"f43d015e.4b29","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.bed_sensor_sam","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":110,"y":80,"wires":[["546da122fe24161c"],["a3969041aa39c0ca"]]},{"id":"8a8acaa98d476bff","type":"server-state-changed","z":"cdd59c9d83846168","g":"6e0637a92024e97a","name":"Leah in Bed","server":"f43d015e.4b29","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.bed_sensor_leah","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":110,"y":160,"wires":[["934f749c9cf008ef"],["a8146ffcf68f5f5e"]]},{"id":"546da122fe24161c","type":"api-call-service","z":"cdd59c9d83846168","g":"6e0637a92024e97a","name":"Sam is in Bed","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.sam_sleeping"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":300,"y":60,"wires":[["14d952390185890f"]]},{"id":"934f749c9cf008ef","type":"api-call-service","z":"cdd59c9d83846168","g":"6e0637a92024e97a","name":"Leah is in bed","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.leah_sleeping"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":300,"y":140,"wires":[["3fe19f20e16b2ad9"]]},{"id":"a8146ffcf68f5f5e","type":"api-call-service","z":"cdd59c9d83846168","g":"6e0637a92024e97a","name":"Leah out of Bed","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.leah_sleeping"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":300,"y":180,"wires":[["584434e5093fe849"]]},{"id":"a3969041aa39c0ca","type":"api-call-service","z":"cdd59c9d83846168","g":"6e0637a92024e97a","name":"Sam out of Bed","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.sam_sleeping"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":300,"y":100,"wires":[["7810e1359aaade77"]]},{"id":"14d952390185890f","type":"api-current-state","z":"cdd59c9d83846168","g":"6e0637a92024e97a","name":"Leah in Bed?","server":"f43d015e.4b29","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.leah_sleeping","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":490,"y":60,"wires":[["c0fd77c0c1859d2e"],[]]},{"id":"3fe19f20e16b2ad9","type":"api-current-state","z":"cdd59c9d83846168","g":"6e0637a92024e97a","name":"Sam in Bed?","server":"f43d015e.4b29","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.sam_sleeping","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":490,"y":140,"wires":[["c0fd77c0c1859d2e"],[]]},{"id":"c0fd77c0c1859d2e","type":"api-call-service","z":"cdd59c9d83846168","g":"6e0637a92024e97a","name":"Both in Bed","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.all_sleeping"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":710,"y":80,"wires":[[]]},{"id":"c7565947a8c99983","type":"api-call-service","z":"cdd59c9d83846168","g":"6e0637a92024e97a","name":"Both out of Bed","server":"f43d015e.4b29","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.all_sleeping"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":720,"y":160,"wires":[[]]},{"id":"7810e1359aaade77","type":"api-current-state","z":"cdd59c9d83846168","g":"6e0637a92024e97a","name":"Leah in Bed?","server":"f43d015e.4b29","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.leah_sleeping","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":490,"y":100,"wires":[[],["c7565947a8c99983"]]},{"id":"584434e5093fe849","type":"api-current-state","z":"cdd59c9d83846168","g":"6e0637a92024e97a","name":"Sam in Bed?","server":"f43d015e.4b29","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.sam_sleeping","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":"0","forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":490,"y":180,"wires":[[],["c7565947a8c99983"]]},{"id":"f43d015e.4b29","type":"server","name":"Home Assistant","version":4,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true,"cacheJson":true,"heartbeat":false,"heartbeatInterval":30,"areaSelector":"friendlyName","deviceSelector":"friendlyName","entitySelector":"friendlyName","statusSeparator":"at: ","statusYear":"hidden","statusMonth":"short","statusDay":"numeric","statusHourCycle":"h23","statusTimeFormat":"h:m"}]
</details>

&nbsp;&nbsp;_which uses:_

- [ESPresense Integration](https://espresense.com/home_assistant)
- [ESPHome Add-On](https://github.com/esphome/esphome)
</details>
</blockquote></details>

<p align="right">(<a href="#readme-top">back to top</a>)</p>

<!-- MARKDOWN LINKS & IMAGES -->

[contributors-shield]: https://img.shields.io/github/contributors/smcnab1/op-question-mark.svg?style=for-the-badge
[contributors-url]: https://github.com/smcnab1/op-question-mark/graphs/contributors
[forks-shield]: https://img.shields.io/github/forks/smcnab1/op-question-mark.svg?style=for-the-badge
[forks-url]: https://github.com/smcnab1/op-question-mark/network/members
[stars-shield]: https://img.shields.io/github/stars/smcnab1/op-question-mark.svg?style=for-the-badge
[stars-url]: https://github.com/smcnab1/op-question-mark/stargazers
[issues-shield]: https://img.shields.io/github/issues/smcnab1/op-question-mark.svg?style=for-the-badge
[issues-url]: https://github.com/smcnab1/op-question-mark/issues
[license-shield]: https://img.shields.io/github/license/smcnab1/op-question-mark.svg?style=for-the-badge
[license-url]: https://github.com/smcnab1/op-question-mark/blob/master/LICENSE.md
[linkedin-shield]: https://img.shields.io/badge/-LinkedIn-black.svg?style=for-the-badge&logo=linkedin&colorB=555
[linkedin-url]: https://www.linkedin.com/in/sammcnab/
[product-screenshot]: images/screenshot.png
[email-badge]: https://img.shields.io/badge/Gmail-D14836?style=for-the-badge&logo=gmail&logoColor=white
[email-url]: mailto:sammcnab.email@gmail.com
[signal-badge]: https://img.shields.io/badge/Signal-%23039BE5.svg?&style=for-the-badge&logo=Signal&logoColor=white
[signal-url]: https://signal.me/#p/+447513595678
[telegram-badge]: https://img.shields.io/badge/Telegram-2CA5E0?style=for-the-badge&logo=telegram&logoColor=white
[telegram-url]: https://t.me/sam_mcnab
[git-badge]: https://img.shields.io/badge/GitHub-100000?style=for-the-badge&logo=github&logoColor=white
[git-url]: https://github.com/smcnab1
[kofi-badge]: https://ko-fi.com/img/githubbutton_sm.svg
[kofi-url]: https://ko-fi.com/sammcnab1
