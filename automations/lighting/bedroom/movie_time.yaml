#  _            _                                          _       _   _
# | |__  ___ __| |_ _ ___  ___ _ __    ___   _ __  _____ _(_)___  | |_(_)_ __  ___
# | '_ \/ -_) _` | '_/ _ \/ _ \ '  \  |___| | '  \/ _ \ V / / -_) |  _| | '  \/ -_)
# |_.__/\___\__,_|_| \___/\___/_|_|_|       |_|_|_\___/\_/|_\___|  \__|_|_|_|_\___|
#
#--FROM https://github.com/smcnab1/op-question-mark

alias: Lighting Bedroom Movie Time
description: >-
  Automation automatically turn on Movie Scene when TV is turned on to certain
  apps/channels.
trigger:
  - platform: state
    entity_id:
      - media_player.bedroom_tv
    to: playing
condition: []
action:
  - service: scene.create
    data:
      scene_id: prebedmovie
      snapshot_entities:
        - light.bedroom_main_light
        - light.bedroom_leds
        - light.bedside_lamps
        - light.bedroom_fairy_lights
  - service: automation.trigger
    data:
      skip_condition: false
    target:
      entity_id: automation.lighting_bedroom_movie
  - wait_for_trigger:
      - platform: device
        device_id: 222b8d47a5b3ba080ee5e8d36235080a
        domain: media_player
        entity_id: media_player.bedroom_tv
        type: turned_off
    continue_on_timeout: false
  - if:
      - condition: or
        conditions:
          - condition: state
            entity_id: input_boolean.all_sleeping
            state: "on"
          - condition: state
            entity_id: input_boolean.leah_sleeping
            state: "on"
          - condition: state
            entity_id: input_boolean.sam_sleeping
            state: "on"
    then:
      - service: automation.trigger
        data:
          skip_condition: false
        target:
          entity_id: automation.lighting_living_room_off
    else:
      - service: scene.turn_on
        data:
          transition: 20
        target:
          entity_id: scene.prebedmovie
mode: single
